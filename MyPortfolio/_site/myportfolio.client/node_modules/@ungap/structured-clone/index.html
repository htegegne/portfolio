<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>structuredClone polyfill | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="structuredClone polyfill" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/@ungap/structured-clone/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/@ungap/structured-clone/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="structuredClone polyfill" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"structuredClone polyfill","url":"http://localhost:4000/myportfolio.client/node_modules/@ungap/structured-clone/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=00c08f3bd19ad2390c706d50e4f8968f8b47944c">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="structuredclone-polyfill">structuredClone polyfill</h1>

<p><a href="https://www.npmjs.com/package/@ungap/structured-clone"><img src="https://img.shields.io/npm/dm/@ungap/structured-clone.svg" alt="Downloads" /></a> <a href="https://github.com/ungap/structured-clone/actions"><img src="https://github.com/ungap/structured-clone/actions/workflows/node.js.yml/badge.svg" alt="build status" /></a> <a href="https://coveralls.io/github/ungap/structured-clone?branch=main"><img src="https://coveralls.io/repos/github/ungap/structured-clone/badge.svg?branch=main" alt="Coverage Status" /></a></p>

<p>An env agnostic serializer and deserializer with recursion ability and types beyond <em>JSON</em> from the <em>HTML</em> standard itself.</p>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#supported_types">Supported Types</a>
    <ul>
      <li><em>not supported yet</em>: Blob, File, FileList, ImageBitmap, ImageData, and ArrayBuffer, but typed arrays are supported without major issues, but u/int8, u/int16, and u/int32 are the only safely suppored (right now).</li>
      <li><em>not possible to implement</em>: the <code class="language-plaintext highlighter-rouge">{transfer: []}</code> option can be passed but it’s completely ignored.</li>
    </ul>
  </li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/structuredClone">MDN Documentation</a></li>
  <li><a href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeinternal">Serializer</a></li>
  <li><a href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize">Deserializer</a></li>
</ul>

<p>Serialized values can be safely stringified as <em>JSON</em> too, and deserialization resurrect all values, even recursive, or more complex than what <em>JSON</em> allows.</p>

<h3 id="examples">Examples</h3>

<p>Check the <a href="./test/index.js">100% test coverage</a> to know even more.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// as default export</span>
<span class="k">import</span> <span class="nx">structuredClone</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@ungap/structured-clone</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">cloned</span> <span class="o">=</span> <span class="nx">structuredClone</span><span class="p">({</span><span class="na">any</span><span class="p">:</span> <span class="dl">'</span><span class="s1">serializable</span><span class="dl">'</span><span class="p">});</span>

<span class="c1">// as independent serializer/deserializer</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">serialize</span><span class="p">,</span> <span class="nx">deserialize</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@ungap/structured-clone</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// the result can be stringified as JSON without issues</span>
<span class="c1">// even if there is recursive data, bigint values,</span>
<span class="c1">// typed arrays, and so on</span>
<span class="kd">const</span> <span class="nx">serialized</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">({</span><span class="na">any</span><span class="p">:</span> <span class="dl">'</span><span class="s1">serializable</span><span class="dl">'</span><span class="p">});</span>

<span class="c1">// the result will be a replica of the original object</span>
<span class="kd">const</span> <span class="nx">deserialized</span> <span class="o">=</span> <span class="nx">deserialize</span><span class="p">(</span><span class="nx">serialized</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="global-polyfill">Global Polyfill</h4>
<p>Note: Only monkey patch the global if needed. This polyfill works just fine as an explicit import: <code class="language-plaintext highlighter-rouge">import structuredClone from "@ungap/structured-clone"</code></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Attach the polyfill as a Global function</span>
<span class="k">import</span> <span class="nx">structuredClone</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@ungap/structured-clone</span><span class="dl">"</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="dl">"</span><span class="s2">structuredClone</span><span class="dl">"</span> <span class="k">in</span> <span class="nx">globalThis</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">globalThis</span><span class="p">.</span><span class="nx">structuredClone</span> <span class="o">=</span> <span class="nx">structuredClone</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Or don't monkey patch</span>
<span class="k">import</span> <span class="nx">structuredClone</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@ungap/structured-clone</span><span class="dl">"</span>
<span class="c1">// Just use it in the file</span>
<span class="nx">structuredClone</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Note</strong>: Do not attach this module’s default export directly to the global scope, whithout a conditional guard to detect a native implementation. In environments where there is a native global implementation of <code class="language-plaintext highlighter-rouge">structuredClone()</code> already, assignment to the global object will result in an infinite loop when <code class="language-plaintext highlighter-rouge">globalThis.structuredClone()</code> is called. See the example above for a safe way to provide the polyfill globally in your project.</p>

<h3 id="extra-features">Extra Features</h3>

<p>There is no middle-ground between the structured clone algorithm and JSON:</p>

<ul>
  <li>JSON is more relaxed about incompatible values: it just ignores these</li>
  <li>Structured clone is inflexible regarding incompatible values, yet it makes specialized instances impossible to reconstruct, plus it doesn’t offer any helper, such as <code class="language-plaintext highlighter-rouge">toJSON()</code>, to make serialization possible, or better, with specific cases</li>
</ul>

<p>This module specialized <code class="language-plaintext highlighter-rouge">serialize</code> export offers, within the optional extra argument, a <strong>lossy</strong> property to avoid throwing when incompatible types are found down the road (function, symbol, …), so that it is possible to send with less worrying about thrown errors.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// as default export</span>
<span class="k">import</span> <span class="nx">structuredClone</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@ungap/structured-clone</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">cloned</span> <span class="o">=</span> <span class="nx">structuredClone</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">method</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// ignored, won't be cloned</span>
    <span class="p">},</span>
    <span class="na">special</span><span class="p">:</span> <span class="nb">Symbol</span><span class="p">(</span><span class="dl">'</span><span class="s1">also ignored</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="c1">// avoid throwing</span>
    <span class="na">lossy</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="c1">// avoid throwing *and* looks for toJSON</span>
    <span class="na">json</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p>The behavior is the same found in <em>JSON</em> when it comes to <em>Array</em>, so that unsupported values will result as <code class="language-plaintext highlighter-rouge">null</code> placeholders instead.</p>

<h4 id="tojson">toJSON</h4>

<p>If <code class="language-plaintext highlighter-rouge">lossy</code> option is not enough, <code class="language-plaintext highlighter-rouge">json</code> will actually enforce <code class="language-plaintext highlighter-rouge">lossy</code> and also check for <code class="language-plaintext highlighter-rouge">toJSON</code> method when objects are parsed.</p>

<p>Alternative, the <code class="language-plaintext highlighter-rouge">json</code> exports combines all features:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">stringify</span><span class="p">,</span> <span class="nx">parse</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@ungap/structured-clone/json</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">parse</span><span class="p">(</span><span class="nx">stringify</span><span class="p">({</span><span class="na">any</span><span class="p">:</span> <span class="dl">'</span><span class="s1">serializable</span><span class="dl">'</span><span class="p">}));</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
