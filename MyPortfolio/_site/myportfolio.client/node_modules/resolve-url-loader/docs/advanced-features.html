<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Advanced Features | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Advanced Features" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/resolve-url-loader/docs/advanced-features.html" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/resolve-url-loader/docs/advanced-features.html" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Advanced Features" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Advanced Features","url":"http://localhost:4000/myportfolio.client/node_modules/resolve-url-loader/docs/advanced-features.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=059dd2210d8f0fb8d42af0cbb5c1b29e59b98886">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="advanced-features">Advanced Features</h1>

<p>All the advanced features of this loader involve customising the <code class="language-plaintext highlighter-rouge">join</code> option.</p>

<p>Jump to the <strong>‚Äúhow to‚Äù</strong> section -</p>
<ul>
  <li><a href="#how-to-change-precedence-of-source-locations">How to: change precedence of source locations</a></li>
  <li><a href="#how-to-fallback-to-a-theme-or-other-global-directory">How to: fallback to a theme or other global directory</a></li>
  <li><a href="#how-to-fallback-to-some-other-asset-file">How to: fallback to some other asset file</a></li>
  <li><a href="#how-to-perform-a-file-system-search-for-an-asset">How to: perform a file-system search for an asset</a></li>
</ul>

<h2 id="what-is-the-join-function">What is the ‚Äújoin‚Äù function?</h2>

<p>The ‚Äújoin‚Äù function determines how CSS URIs are combined with one of the possible base paths the algorithm has identified.</p>

<p>‚ö†Ô∏è <strong>IMPORTANT</strong> - First read how the <a href="/myportfolio.client/node_modules/resolve-url-loader/docs/how-it-works.html#algorithm">algorithm</a> works.</p>

<p>The ‚Äújoin‚Äù function is a higher-order function created using the <code class="language-plaintext highlighter-rouge">options</code> and <code class="language-plaintext highlighter-rouge">loader</code> reference. That gives a function that accepts a single <code class="language-plaintext highlighter-rouge">item</code> and synchronously returns an absolute asset path to substitute back into the original CSS.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">options</span><span class="p">:{},</span> <span class="nx">loader</span><span class="p">:{})</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="nx">item</span><span class="p">:{</span> <span class="nl">uri</span><span class="p">:</span><span class="nx">string</span><span class="p">,</span> <span class="nx">query</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">isAbsolute</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">,</span> <span class="nx">bases</span><span class="p">:{}</span> <span class="p">})</span> <span class="o">=&gt;</span>
    <span class="nx">string</span> <span class="o">|</span> <span class="kc">null</span>
</code></pre></div></div>

<p>Where the <code class="language-plaintext highlighter-rouge">bases</code> are absolute directory paths <code class="language-plaintext highlighter-rouge">{ subString, value, property, selector }</code> per the <a href="/myportfolio.client/node_modules/resolve-url-loader/docs/how-it-works.html#algorithm">algorithm</a>. Note that returning <code class="language-plaintext highlighter-rouge">null</code> implies no substitution, the original relative <code class="language-plaintext highlighter-rouge">uri</code> is retained.</p>

<p>The job of the ‚Äújoin‚Äù function is to consider possible locations for the asset based on the <code class="language-plaintext highlighter-rouge">bases</code> and determine which is most appropriate. This implies some order of precedence in these locations and some file-system operation to determine if the asset there.</p>

<p>The default implementation is suitable for most users but can be customised per the <code class="language-plaintext highlighter-rouge">join</code> option.</p>

<p>A custom <code class="language-plaintext highlighter-rouge">join</code> function from scratch is possible but we‚Äôve provided some <a href="#building-blocks">building blocks</a> to make the task easier.</p>

<h2 id="building-blocks">Building blocks</h2>

<p>There are a number of utilities (defined in <a href="/myportfolio.client/node_modules/resolve-url-loader/lib/join-function/index.js"><code class="language-plaintext highlighter-rouge">lib/join-function/index.js</code></a>) to help construct a custom ‚Äújoin‚Äù function . These are conveniently re-exported as properties of the loader.</p>

<p>These utilities are used to create the <code class="language-plaintext highlighter-rouge">defaultJoin</code> as follows.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span>
  <span class="nx">createJoinFunction</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">,</span>
  <span class="nx">defaultJoinGenerator</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">resolve-url-loader</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// create a join function equivalent to "defaultJoin"</span>
<span class="kd">const</span> <span class="nx">myJoinFn</span> <span class="o">=</span> <span class="nx">createJoinFunction</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">myJoinFn</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">(</span><span class="nx">defaultJoinGenerator</span><span class="p">),</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ü§ì If you have some very specific behaviour in mind you can specify your own implementation. This gives full control but still gives you <code class="language-plaintext highlighter-rouge">debug</code> logging for free.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">createJoinFunction</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">:</span><span class="nx">string</span><span class="p">,</span> <span class="nx">implementation</span><span class="p">:</span> <span class="kd">function</span><span class="p">):</span> <span class="kd">function</span>
</code></pre></div></div>

<p>For each item, the implementation needs to make multiple attempts at locating the asset. It has mixed concerns of itentifying locations to search and then evaluating those locates one by one.</p>

<p>üëâ However its recommended to instead use <code class="language-plaintext highlighter-rouge">createJoinImplementation</code> to create the <code class="language-plaintext highlighter-rouge">implementation</code> using the <code class="language-plaintext highlighter-rouge">generator</code> concept.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">createJoinImplementation</span> <span class="o">=</span> <span class="p">(</span><span class="nx">generator</span><span class="p">:</span> <span class="kd">function</span><span class="o">*</span><span class="p">):</span> <span class="kd">function</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">generator</code> has the single concern of identifying locations to search. The work of searching these locations is done by <code class="language-plaintext highlighter-rouge">createJoinImplementation</code>. Overall this means less boilerplate code for you to write.</p>

<p>Don‚Äôt worry, you don‚Äôt need to use <code class="language-plaintext highlighter-rouge">function*</code> semantics for the <code class="language-plaintext highlighter-rouge">generator</code> unless you want to.</p>

<h2 id="simple-customisation">Simple customisation</h2>

<p>It is relatively simple to change the precedence of values (from the <a href="/myportfolio.client/node_modules/resolve-url-loader/docs/how-it-works.html#algorithm">algorithm</a>) or add further locations to search for an asset. To do this we use <code class="language-plaintext highlighter-rouge">createJoinImplementation</code> and write a custom <code class="language-plaintext highlighter-rouge">generator</code>.</p>

<p>See the reference or jump directly to the <a href="#how-to-change-precedence-of-source-locations">examples</a>.</p>

<h3 id="reference">Reference</h3>

<p>The <code class="language-plaintext highlighter-rouge">generator</code> identifies <code class="language-plaintext highlighter-rouge">[base:string,uri:string]</code> tuples describing locations to search for an asset. It does <strong>not</strong> return the final asset path.</p>

<p>You may lazily generate tuples as <code class="language-plaintext highlighter-rouge">Iterator</code>. Refer to this <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators">guide on Iterators and Generators</a>.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">generator</span> <span class="o">=</span> <span class="kd">function</span><span class="o">*</span> <span class="p">(</span><span class="nx">item</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">options</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">loader</span><span class="p">:</span> <span class="p">{}):</span> <span class="nx">Iterator</span><span class="o">&lt;</span><span class="p">[</span><span class="nx">string</span><span class="p">,</span><span class="nx">string</span><span class="p">]</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Or it can be simpler to write a function that returns <code class="language-plaintext highlighter-rouge">Array</code> and convert it to a generator using <code class="language-plaintext highlighter-rouge">asGenerator</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">generator</span> <span class="o">=</span> <span class="nx">asGenerator</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">options</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">loader</span><span class="p">:</span> <span class="p">{}):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">)</span>
</code></pre></div></div>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">generator</span> <span class="o">=</span> <span class="nx">asGenerator</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">options</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">loader</span><span class="p">:</span> <span class="p">{}):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="p">[</span><span class="nx">string</span><span class="p">,</span><span class="nx">string</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">)</span>
</code></pre></div></div>

<p>When using <code class="language-plaintext highlighter-rouge">asGenerator</code> you may return elements as either <code class="language-plaintext highlighter-rouge">base:string</code> <strong>or</strong> <code class="language-plaintext highlighter-rouge">[base:string,uri:string]</code> tuples.</p>

<details>
<summary>Arguments</summary>

* `item` consist of -
  * `uri: string` is the argument to the `url()` as it appears in the source file.
  * `query: string` is any query or hash string starting with `?` or `#` that suffixes the `uri`
  * `isAbsolute: boolean` flag indicates whether the URI is considered an absolute file or root relative path by webpack's definition. Absolute URIs are only processed if the `root` option is specified.
  * `bases: {}` are a hash where the keys are the sourcemap evaluation locations in the [algorithm](/myportfolio.client/node_modules/resolve-url-loader/docs/how-it-works.html#algorithm) and the values are absolute paths that the sourcemap reports. These directories might not actually exist.
* `options` consist of -
   * All documented options for the loader.
   * Any other values you include in the loader configuration for your own purposes.
* `loader` consists of the webpack loader API, useful items include -
   * `fs: {}` the virtual file-system from Webpack.
   * `resourcePath: string` the source file currently being processed.
* returns an `Iterator` with elements of `[base:string,uri:string]` either intrinsically or by using `asGenerator`.
</details>

<details>
<summary>FAQ</summary>

* **Why a tuple?**

  The primary pupose of this loader is to find the correct `base` path for your `uri`. By returning a list of paths to search we can better generate `debug` logging.
  
  That said there are cases where you might want to amend the `uri`. The solution is to make each element a tuple of `base` and `uri` representing a potential location to find the asset.
  
  If you're interested only in the `base` path and don't intend to vary the `uri` then the `asGenerator` utility saves you having to create repetative tuples (and from using `function*` semantics).

* **Can I vary the `query` using the tuple?**

  No. We don't support amending the `query` in the final value. If you would like this enhancement please open an issue.

* **What about duplicate or falsey elements?**

  The `createJoinImplementation` will eliminate any invalid elements regardless of whether you use `Array` or `Iterator`. This makes it possible to `&amp;&amp;` elements inline with a predicate value.
  
  If you use `Array` then `asGenerator` will also remove duplicates.

* **When should I use `function*`?**

  If you need lazy generation of values then you may return `Iterator` or use `function*` semantics. Refer to [this guide on Iterators](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators).
  
  But in most cases, when the values are known apriori, simply returning `Array` has simpler semantics making `asGenerator` preferable.

* **Why is this generator so complicated?**

  The join function must make multiple attempts to join a `base` and `uri` and check that the file exists using webpack `fs`.

  The `generator` is focussed on identifying locations to search. It is a more scalable concept where you wish to search many places. The traditional use case for the custom "join" function is a file-system search so the `generator` was designed to make this possible.

  If you prefer a less abstract approach consider a full `implementation` per the [full customisation](#full-customisation) approach.
</details>

<h3 id="how-to-change-precedence-of-source-locations">How to: change precedence of source locations</h3>

<p>Source-map sampling is limited to the locations defined in the <a href="/myportfolio.client/node_modules/resolve-url-loader/docs/how-it-works.html#algorithm">algorithm</a>. You can‚Äôt change these locations but you can preference them in a different order.</p>

<p>This example shows the default order which you can easily amend. Absolute URIs are rare in most projects but can be handled for completeness.</p>

<p><strong>Using <code class="language-plaintext highlighter-rouge">asGenerator</code></strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span>
  <span class="nx">createJoinFunction</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">,</span>
  <span class="nx">asGenerator</span><span class="p">,</span>
  <span class="nx">defaultJoinGenerator</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">resolve-url-loader</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// order source-map sampling location by your preferred precedence (matches defaultJoinGenerator)</span>
<span class="kd">const</span> <span class="nx">myGenerator</span> <span class="o">=</span> <span class="nx">asGenerator</span><span class="p">(</span>
  <span class="p">({</span> <span class="nx">isAbsolute</span><span class="p">,</span> <span class="na">bases</span><span class="p">:</span> <span class="p">{</span> <span class="nx">substring</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">selector</span><span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">root</span> <span class="p">})</span> <span class="o">=&gt;</span>
    <span class="nx">isAbsolute</span> <span class="p">?</span> <span class="p">[</span><span class="nx">root</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="nx">subString</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">selector</span><span class="p">]</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">myJoinFn</span> <span class="o">=</span> <span class="nx">createJoinFunction</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">myJoinFn</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">(</span><span class="nx">myGenerator</span><span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>Notes</strong></p>

<ul>
  <li>The implementation is the default behaviour, so if you want this precedence do <strong>not</strong> customise the <code class="language-plaintext highlighter-rouge">join</code> option.</li>
  <li>Absolute URIs generally use the base path given in the <code class="language-plaintext highlighter-rouge">root</code> option as shown.</li>
  <li>The <code class="language-plaintext highlighter-rouge">asGenerator</code> utility allows us to return simple <code class="language-plaintext highlighter-rouge">Array&lt;string&gt;</code> of potential base paths.</li>
</ul>

<h3 id="how-to-fallback-to-a-theme-or-other-global-directory">How to: fallback to a theme or other global directory</h3>

<p>Additional locations can be added by decorating the default generator. This is popular for adding some sort of ‚Äútheme‚Äù directory containing assets.</p>

<p>This example appends a static theme directory as a fallback location where the asset might reside. Absolute URIs are rare in most projects but can be handled for completeness.</p>

<p><strong>Using <code class="language-plaintext highlighter-rouge">asGenerator</code></strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span>
  <span class="nx">createJoinFunction</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">,</span>
  <span class="nx">asGenerator</span><span class="p">,</span>
  <span class="nx">defaultJoinGenerator</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">resolve-url-loader</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">myThemeDirectory</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(...);</span>

<span class="c1">// call default generator then append any additional paths</span>
<span class="kd">const</span> <span class="nx">myGenerator</span> <span class="o">=</span> <span class="nx">asGenerator</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">...</span><span class="nx">defaultJoinGenerator</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">),</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">isAbsolute</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="nx">myThemeDirectory</span><span class="p">,</span>
  <span class="p">]</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">myJoinFn</span> <span class="o">=</span> <span class="nx">createJoinFunction</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">myJoinFn</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">(</span><span class="nx">myGenerator</span><span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>Notes</strong></p>

<ul>
  <li>By spreading the result of <code class="language-plaintext highlighter-rouge">defaultJoinGenerator</code> we are first trying the default behaviour. If that is unsuccessful we then try the theme location.</li>
  <li>It‚Äôs assumed that theming doesn‚Äôt apply to absolute URIs. Since falsey elements are ignored we can easily <code class="language-plaintext highlighter-rouge">null</code> the additional theme element inline as shown.</li>
  <li>The <code class="language-plaintext highlighter-rouge">asGenerator</code> utility allows us to return simple <code class="language-plaintext highlighter-rouge">Array&lt;string&gt;</code> of potential base paths.</li>
</ul>

<h3 id="how-to-fallback-to-some-other-asset-file">How to: fallback to some other asset file</h3>

<p>Lets imagine we don‚Äôt have high quality files for all our assets and must sometimes use a lower quality format. For each item we need to try the <code class="language-plaintext highlighter-rouge">uri</code> with different file extensions. We can do this by returning tuples of <code class="language-plaintext highlighter-rouge">[base:string,uri:string]</code>.</p>

<p>In this example we prefer the <code class="language-plaintext highlighter-rouge">.svg</code> asset we are happy to use any available <code class="language-plaintext highlighter-rouge">.png</code> or <code class="language-plaintext highlighter-rouge">.jpg</code> instead.</p>

<p><strong>Using <code class="language-plaintext highlighter-rouge">asGenerator</code></strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span>
  <span class="nx">createJoinFunction</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">,</span>
  <span class="nx">asGenerator</span><span class="p">,</span>
  <span class="nx">defaultJoinGenerator</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">resolve-url-loader</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// call default generator then pair different variations of uri with each base</span>
<span class="kd">const</span> <span class="nx">myGenerator</span> <span class="o">=</span> <span class="nx">asGenerator</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">defaultTuples</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">defaultJoinGenerator</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">)];</span>
    <span class="k">return</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">svg$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">uri</span><span class="p">)</span>
      <span class="p">?</span> <span class="p">[</span><span class="dl">'</span><span class="s1">.svg</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.png</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">jpg</span><span class="dl">'</span><span class="p">].</span><span class="nx">flatMap</span><span class="p">((</span><span class="nx">ext</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="nx">defaultTuples</span><span class="p">.</span><span class="nx">flatMap</span><span class="p">(([</span><span class="nx">base</span><span class="p">,</span> <span class="nx">uri</span><span class="p">])</span> <span class="o">=&gt;</span>
            <span class="p">[</span><span class="nx">base</span><span class="p">,</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\.</span><span class="sr">svg$/</span><span class="p">,</span> <span class="nx">ext</span><span class="p">)]</span>
          <span class="p">})</span>
        <span class="p">)</span>
      <span class="p">:</span> <span class="nx">defaultTuples</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">myJoinFn</span> <span class="o">=</span> <span class="nx">createJoinFunction</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">myJoinFn</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">(</span><span class="nx">myGenerator</span><span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>Using <code class="language-plaintext highlighter-rouge">function*</code></strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span>
  <span class="nx">createJoinFunction</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">,</span>
  <span class="nx">defaultJoinGenerator</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">resolve-url-loader</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// call default generator then pair different variations of uri with each base</span>
<span class="kd">const</span> <span class="nx">myGenerator</span> <span class="o">=</span> <span class="kd">function</span><span class="o">*</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="sr">/</span><span class="se">\.</span><span class="sr">svg$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">ext</span> <span class="k">of</span> <span class="p">[</span><span class="dl">'</span><span class="s1">.svg</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.png</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">jpg</span><span class="dl">'</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="p">[</span><span class="nx">base</span><span class="p">,</span> <span class="nx">uri</span><span class="p">]</span> <span class="k">of</span> <span class="nx">defaultJoinGenerator</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="p">[</span><span class="nx">base</span><span class="p">,</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\.</span><span class="sr">svg$/</span><span class="p">,</span> <span class="nx">ext</span><span class="p">)];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">defaultJoinGenerator</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">yield</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">myJoinFn</span> <span class="o">=</span> <span class="nx">createJoinFunction</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">myJoinFn</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">(</span><span class="nx">myGenerator</span><span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>Notes</strong></p>

<ul>
  <li>Existing generators such as <code class="language-plaintext highlighter-rouge">defaultJoinGenerator</code> will always return <code class="language-plaintext highlighter-rouge">[string,string]</code> tuples so we can destruture <code class="language-plaintext highlighter-rouge">base</code> and <code class="language-plaintext highlighter-rouge">uri</code> values with confidence.</li>
  <li>This implementation attempts all extensions for a given <code class="language-plaintext highlighter-rouge">base</code> before moving to the next <code class="language-plaintext highlighter-rouge">base</code>. Obviously we may change the nesting and instead do the oposite, attempt all bases for a single extension before moving on to the next extension</li>
  <li>The <code class="language-plaintext highlighter-rouge">asGenerator</code> utility allows us to return <code class="language-plaintext highlighter-rouge">Array&lt;[string, string]&gt;</code> but is <strong>not</strong> needed when we use <code class="language-plaintext highlighter-rouge">function*</code> semantics.</li>
</ul>

<h3 id="how-to-perform-a-file-system-search-for-an-asset">How to: perform a file-system search for an asset</h3>

<p>‚ö†Ô∏è <strong>IMPORTANT</strong> - This example is indicative only and is <strong>not</strong> advised.</p>

<p>When this loader was originally released it was very common for packages be broken to the point that a full file search was needed to locate assets referred to in CSS. While this was not performant some users really liked it. By customising the <code class="language-plaintext highlighter-rouge">generator</code> we can once again lazily search the file-system.</p>

<p>In this example we search the parent directories of the base paths, continuing upwards until we hit a package boundary. Absolute URIs are rare in most projects but can be handled for completeness.</p>

<p><strong>Using <code class="language-plaintext highlighter-rouge">function*</code></strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span>
  <span class="nx">createJoinFunction</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">,</span>
  <span class="nx">webpackExistsSync</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">resolve-url-loader</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// search up from the initial base path until you hit a package boundary</span>
<span class="kd">const</span> <span class="nx">myGenerator</span> <span class="o">=</span> <span class="kd">function</span><span class="o">*</span> <span class="p">(</span>
  <span class="p">{</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">isAbsolute</span><span class="p">,</span> <span class="na">bases</span><span class="p">:</span> <span class="p">{</span> <span class="nx">substring</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">selector</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">attempts</span> <span class="o">=</span> <span class="mi">1</span><span class="nx">e3</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">fs</span> <span class="p">},</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isAbsolute</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="p">[</span><span class="nx">root</span><span class="p">,</span> <span class="nx">uri</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">base</span> <span class="k">of</span> <span class="p">[</span><span class="nx">subString</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">selector</span><span class="p">])</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">!</span><span class="nx">isDone</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">attempts</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">yield</span> <span class="p">[</span><span class="nx">base</span><span class="p">,</span> <span class="nx">uri</span><span class="p">];</span>
          <span class="c1">// unfortunately fs.existsSync() is not present so we must shim it</span>
          <span class="kd">const</span> <span class="nx">maybePkg</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="dl">'</span><span class="s1">package.json</span><span class="dl">'</span><span class="p">));</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="nx">isDone</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">statSync</span><span class="p">(</span><span class="nx">maybePkg</span><span class="p">).</span><span class="nx">isFile</span><span class="p">();</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">base</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/</span><span class="se">(\\\/)</span><span class="sr">/</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
       <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">myJoinFn</span> <span class="o">=</span> <span class="nx">createJoinFunction</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">myJoinFn</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">createJoinImplementation</span><span class="p">(</span><span class="nx">myGenerator</span><span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>Notes</strong></p>

<ul>
  <li>
    <p>This implementation is nether tested nor robust, it would need further safeguards to avoid searching the entire file system.</p>
  </li>
  <li>
    <p>By using <code class="language-plaintext highlighter-rouge">function*</code> the generator is lazy. We only walk the file-system directory tree as necessary.</p>
  </li>
  <li>
    <p>The webpack file-system is provided by the <code class="language-plaintext highlighter-rouge">enhanced-resolver-plugin</code> and does <strong>not</strong> contain <code class="language-plaintext highlighter-rouge">fs.existsSync()</code>. We must use <code class="language-plaintext highlighter-rouge">fs.statsSync()</code> instead and catch any error where the file isn‚Äôt present.</p>
  </li>
  <li>
    <p>You may set additional <code class="language-plaintext highlighter-rouge">options</code> when you configure the loader in webpack and then access them in your <code class="language-plaintext highlighter-rouge">generator</code>. In this case we add an <code class="language-plaintext highlighter-rouge">attempts</code> option to limit the file search.</p>
  </li>
</ul>

<h2 id="full-customisation">Full customisation</h2>

<p>The <code class="language-plaintext highlighter-rouge">createJoinFunction</code> can give you full control over how the <code class="language-plaintext highlighter-rouge">base</code> and <code class="language-plaintext highlighter-rouge">uri</code> are joined to create an absolute file path <strong>and</strong> the definitiion of success for that combination.</p>

<p>It provides additional logging when using <code class="language-plaintext highlighter-rouge">debug</code> option so is a better choice then writing a ‚Äújoin‚Äù function from scratch.</p>

<p>Limited documentation is given here since it is rare to require a full customisation. Refer to the source code for further information.</p>

<h3 id="reference-1">Reference</h3>

<p>The <code class="language-plaintext highlighter-rouge">implementation</code> synchronously returns the final asset path or some fallback value. It makes a number of attempts to search for the given item and returns an element describing each attempt.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">options</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">loader</span><span class="p">:</span> <span class="p">{}):</span>
  <span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span>
    <span class="na">base</span>      <span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="na">uri</span>       <span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="na">joined</span>    <span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="na">isSuccess</span> <span class="p">:</span> <span class="nx">boolean</span><span class="p">,</span>
    <span class="na">isFallback</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">,</span>
  <span class="p">}</span><span class="o">&gt;</span>
</code></pre></div></div>
<details>
<summary>Arguments</summary>

* `item` consist of -
  * `uri: string` is the argument to the `url()` as it appears in the source file.
  * `query: string` is any string starting with `?` or `#` that suffixes the `uri`
  * `isAbsolute: boolean` flag indicates whether the URI is considered an absolute file or root relative path by webpack's definition. Absolute URIs are only processed if the `root` option is specified.
  * `bases: {}` are a hash where the keys are the sourcemap evaluation locations in the [algorithm](/myportfolio.client/node_modules/resolve-url-loader/docs/how-it-works.html#algorithm) and the values are absolute paths that the sourcemap reports. These directories might not actually exist.
* `options` consist of -
  * All documented options for the loader.
  * Any other values you include in the loader configuration for your own purposes.
* `loader` consists of the webpack loader API, useful items include -
  * `fs: {}` the virtual file-system from Webpack.
  * `resourcePath: string` the source file currently being processed.
* returns an array of attempts that were made in resolving the URI -
  * `base` the base path
  * `uri` the uri path
  * `joined` the absolute path created from the joining the `base` and `uri` paths.
  * `isSuccess` indicates the asset was found and that `joined` should be the final result
  * `isFallback` indicates the asset was not found but that `joined` kis suitable as a fallback value
</details>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
