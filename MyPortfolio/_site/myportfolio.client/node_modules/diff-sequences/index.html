<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>diff-sequences | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="diff-sequences" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/diff-sequences/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/diff-sequences/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="diff-sequences" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"diff-sequences","url":"http://localhost:4000/myportfolio.client/node_modules/diff-sequences/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=00c08f3bd19ad2390c706d50e4f8968f8b47944c">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="diff-sequences">diff-sequences</h1>

<p>Compare items in two sequences to find a <strong>longest common subsequence</strong>.</p>

<p>The items not in common are the items to delete or insert in a <strong>shortest edit script</strong>.</p>

<p>To maximize flexibility and minimize memory, you write <strong>callback</strong> functions as configuration:</p>

<p><strong>Input</strong> function <code class="language-plaintext highlighter-rouge">isCommon(aIndex, bIndex)</code> compares items at indexes in the sequences and returns a truthy/falsey value. This package might call your function more than once for some pairs of indexes.</p>

<ul>
  <li>Because your function encapsulates <strong>comparison</strong>, this package can compare items according to <code class="language-plaintext highlighter-rouge">===</code> operator, <code class="language-plaintext highlighter-rouge">Object.is</code> method, or other criterion.</li>
  <li>Because your function encapsulates <strong>sequences</strong>, this package can find differences in arrays, strings, or other data.</li>
</ul>

<p><strong>Output</strong> function <code class="language-plaintext highlighter-rouge">foundSubsequence(nCommon, aCommon, bCommon)</code> receives the number of adjacent items and starting indexes of each common subsequence. If sequences do not have common items, then this package does not call your function.</p>

<p>If N is the sum of lengths of sequences and L is length of a longest common subsequence, then D = N – 2L is the number of <strong>differences</strong> in the corresponding shortest edit script.</p>

<p><a href="http://xmailserver.org/diff2.pdf"><em>An O(ND) Difference Algorithm and Its Variations</em></a> by Eugene W. Myers is fast when sequences have <strong>few</strong> differences.</p>

<p>This package implements the <strong>linear space</strong> variation with optimizations so it is fast even when sequences have <strong>many</strong> differences.</p>

<h2 id="usage">Usage</h2>

<p>To add this package as a dependency of a project, do either of the following:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">npm install diff-sequences</code></li>
  <li><code class="language-plaintext highlighter-rouge">yarn add diff-sequences</code></li>
</ul>

<p>To use <code class="language-plaintext highlighter-rouge">diff</code> as the name of the default export from this package, do either of the following:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">var diff = require('diff-sequences').default; // CommonJS modules</code></li>
  <li><code class="language-plaintext highlighter-rouge">import diff from 'diff-sequences'; // ECMAScript modules</code></li>
</ul>

<p>Call <code class="language-plaintext highlighter-rouge">diff</code> with the <strong>lengths</strong> of sequences and your <strong>callback</strong> functions:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">];</span>

<span class="kd">function</span> <span class="nx">isCommon</span><span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]</span> <span class="o">===</span> <span class="nx">b</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">];</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">foundSubsequence</span><span class="p">(</span><span class="nx">nCommon</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">,</span> <span class="nx">bCommon</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// see examples</span>
<span class="p">}</span>

<span class="nx">diff</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">isCommon</span><span class="p">,</span> <span class="nx">foundSubsequence</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="example-of-longest-common-subsequence">Example of longest common subsequence</h2>

<p>Some sequences (for example, <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> in the example of usage) have more than one longest common subsequence.</p>

<p>This package finds the following common items:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">comparisons of common items</th>
      <th style="text-align: left">values</th>
      <th style="text-align: right">output arguments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">a[2] === b[0]</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'c'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">foundSubsequence(1, 2, 0)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">a[4] === b[1]</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'b'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">foundSubsequence(1, 4, 1)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">a[5] === b[3] &amp;&amp; a[6] === b[4]</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'b', 'a'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">foundSubsequence(2, 5, 3)</code></td>
    </tr>
  </tbody>
</table>

<p>The “edit graph” analogy in the Myers paper shows the following common items:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">comparisons of common items</th>
      <th style="text-align: left">values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">a[2] === b[0]</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'c'</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">a[3] === b[2] &amp;&amp; a[4] === b[3]</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'a', 'b'</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">a[6] === b[4]</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'a'</code></td>
    </tr>
  </tbody>
</table>

<p>Various packages which implement the Myers algorithm will <strong>always agree</strong> on the <strong>length</strong> of a longest common subsequence, but might <strong>sometimes disagree</strong> on which <strong>items</strong> are in it.</p>

<h2 id="example-of-callback-functions-to-count-common-items">Example of callback functions to count common items</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Return length of longest common subsequence according to === operator.</span>
<span class="kd">function</span> <span class="nx">countCommonItems</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">isCommon</span><span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]</span> <span class="o">===</span> <span class="nx">b</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">foundSubsequence</span><span class="p">(</span><span class="nx">nCommon</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">+=</span> <span class="nx">nCommon</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">diff</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">isCommon</span><span class="p">,</span> <span class="nx">foundSubsequence</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">commonLength</span> <span class="o">=</span> <span class="nx">countCommonItems</span><span class="p">(</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">],</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">],</span>
<span class="p">);</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">category of items</th>
      <th style="text-align: right">expression</th>
      <th style="text-align: right">value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">in common</td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">commonLength</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">4</code></td>
    </tr>
    <tr>
      <td style="text-align: left">to delete from <code class="language-plaintext highlighter-rouge">a</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">a.length - commonLength</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">3</code></td>
    </tr>
    <tr>
      <td style="text-align: left">to insert from <code class="language-plaintext highlighter-rouge">b</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">b.length - commonLength</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">2</code></td>
    </tr>
  </tbody>
</table>

<p>If the length difference <code class="language-plaintext highlighter-rouge">b.length - a.length</code> is:</p>

<ul>
  <li>negative: its absolute value is the minimum number of items to <strong>delete</strong> from <code class="language-plaintext highlighter-rouge">a</code></li>
  <li>positive: it is the minimum number of items to <strong>insert</strong> from <code class="language-plaintext highlighter-rouge">b</code></li>
  <li>zero: there is an <strong>equal</strong> number of items to delete from <code class="language-plaintext highlighter-rouge">a</code> and insert from <code class="language-plaintext highlighter-rouge">b</code></li>
  <li>non-zero: there is an equal number of <strong>additional</strong> items to delete from <code class="language-plaintext highlighter-rouge">a</code> and insert from <code class="language-plaintext highlighter-rouge">b</code></li>
</ul>

<p>In this example, <code class="language-plaintext highlighter-rouge">6 - 7</code> is:</p>

<ul>
  <li>negative: <code class="language-plaintext highlighter-rouge">1</code> is the minimum number of items to <strong>delete</strong> from <code class="language-plaintext highlighter-rouge">a</code></li>
  <li>non-zero: <code class="language-plaintext highlighter-rouge">2</code> is the number of <strong>additional</strong> items to delete from <code class="language-plaintext highlighter-rouge">a</code> and insert from <code class="language-plaintext highlighter-rouge">b</code></li>
</ul>

<h2 id="example-of-callback-functions-to-find-common-items">Example of callback functions to find common items</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Return array of items in longest common subsequence according to Object.is method.</span>
<span class="kd">const</span> <span class="nx">findCommonItems</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">diff</span><span class="p">(</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">]),</span>
    <span class="p">(</span><span class="nx">nCommon</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(;</span> <span class="nx">nCommon</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">nCommon</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">aCommon</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">aCommon</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">commonItems</span> <span class="o">=</span> <span class="nx">findCommonItems</span><span class="p">(</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">],</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">c</span><span class="dl">'</span><span class="p">],</span>
<span class="p">);</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">i</code></th>
      <th style="text-align: left"><code class="language-plaintext highlighter-rouge">commonItems[i]</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">aIndex</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'c'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">2</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'b'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">4</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">2</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'b'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">5</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">3</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'a'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">6</code></td>
    </tr>
  </tbody>
</table>

<h2 id="example-of-callback-functions-to-diff-index-intervals">Example of callback functions to diff index intervals</h2>

<p>Instead of slicing array-like objects, you can adjust indexes in your callback functions.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Diff index intervals that are half open [start, end) like array slice method.</span>
<span class="kd">const</span> <span class="nx">diffIndexIntervals</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">aStart</span><span class="p">,</span> <span class="nx">aEnd</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">bStart</span><span class="p">,</span> <span class="nx">bEnd</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Validate: 0 &lt;= aStart and aStart &lt;= aEnd and aEnd &lt;= a.length</span>
  <span class="c1">// Validate: 0 &lt;= bStart and bStart &lt;= bEnd and bEnd &lt;= b.length</span>

  <span class="nx">diff</span><span class="p">(</span>
    <span class="nx">aEnd</span> <span class="o">-</span> <span class="nx">aStart</span><span class="p">,</span>
    <span class="nx">bEnd</span> <span class="o">-</span> <span class="nx">bStart</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">aStart</span> <span class="o">+</span> <span class="nx">aIndex</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">bStart</span> <span class="o">+</span> <span class="nx">bIndex</span><span class="p">]),</span>
    <span class="p">(</span><span class="nx">nCommon</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">,</span> <span class="nx">bCommon</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// aStart + aCommon, bStart + bCommon</span>
    <span class="p">},</span>
  <span class="p">);</span>

  <span class="c1">// After the last common subsequence, do any remaining work.</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="example-of-callback-functions-to-emulate-diff-command">Example of callback functions to emulate diff command</h2>

<p>Linux or Unix has a <code class="language-plaintext highlighter-rouge">diff</code> command to compare files line by line. Its output is a <strong>shortest edit script</strong>:</p>

<ul>
  <li><strong>c</strong>hange adjacent lines from the first file to lines from the second file</li>
  <li><strong>d</strong>elete lines from the first file</li>
  <li><strong>a</strong>ppend or insert lines from the second file</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Given zero-based half-open range [start, end) of array indexes,</span>
<span class="c1">// return one-based closed range [start + 1, end] as string.</span>
<span class="kd">const</span> <span class="nx">getRange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="nx">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">===</span> <span class="nx">end</span> <span class="p">?</span> <span class="s2">`</span><span class="p">${</span><span class="nx">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">`</span> <span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">,</span><span class="p">${</span><span class="nx">end</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="c1">// Given index intervals of lines to delete or insert, or both, or neither,</span>
<span class="c1">// push formatted diff lines onto array.</span>
<span class="kd">const</span> <span class="nx">pushDelIns</span> <span class="o">=</span> <span class="p">(</span><span class="nx">aLines</span><span class="p">,</span> <span class="nx">aIndex</span><span class="p">,</span> <span class="nx">aEnd</span><span class="p">,</span> <span class="nx">bLines</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">,</span> <span class="nx">bEnd</span><span class="p">,</span> <span class="nx">array</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">deleteLines</span> <span class="o">=</span> <span class="nx">aIndex</span> <span class="o">!==</span> <span class="nx">aEnd</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">insertLines</span> <span class="o">=</span> <span class="nx">bIndex</span> <span class="o">!==</span> <span class="nx">bEnd</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">changeLines</span> <span class="o">=</span> <span class="nx">deleteLines</span> <span class="o">&amp;&amp;</span> <span class="nx">insertLines</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">changeLines</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">aEnd</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">c</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">getRange</span><span class="p">(</span><span class="nx">bIndex</span><span class="p">,</span> <span class="nx">bEnd</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">deleteLines</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">aEnd</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">d</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">String</span><span class="p">(</span><span class="nx">bIndex</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">insertLines</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">aIndex</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">getRange</span><span class="p">(</span><span class="nx">bIndex</span><span class="p">,</span> <span class="nx">bEnd</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(;</span> <span class="nx">aIndex</span> <span class="o">!==</span> <span class="nx">aEnd</span><span class="p">;</span> <span class="nx">aIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt; </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">aLines</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]);</span> <span class="c1">// delete is less than</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">changeLines</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">---</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(;</span> <span class="nx">bIndex</span> <span class="o">!==</span> <span class="nx">bEnd</span><span class="p">;</span> <span class="nx">bIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">&gt; </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bLines</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">]);</span> <span class="c1">// insert is greater than</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Given content of two files, return emulated output of diff utility.</span>
<span class="kd">const</span> <span class="nx">findShortestEditScript</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">aLines</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">bLines</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">aLength</span> <span class="o">=</span> <span class="nx">aLines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">bLength</span> <span class="o">=</span> <span class="nx">bLines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">isCommon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">aLines</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]</span> <span class="o">===</span> <span class="nx">bLines</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">];</span>

  <span class="kd">let</span> <span class="nx">aIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">bIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">const</span> <span class="nx">foundSubsequence</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nCommon</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">,</span> <span class="nx">bCommon</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">pushDelIns</span><span class="p">(</span><span class="nx">aLines</span><span class="p">,</span> <span class="nx">aIndex</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">,</span> <span class="nx">bLines</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">,</span> <span class="nx">bCommon</span><span class="p">,</span> <span class="nx">array</span><span class="p">);</span>
    <span class="nx">aIndex</span> <span class="o">=</span> <span class="nx">aCommon</span> <span class="o">+</span> <span class="nx">nCommon</span><span class="p">;</span> <span class="c1">// number of lines compared in a</span>
    <span class="nx">bIndex</span> <span class="o">=</span> <span class="nx">bCommon</span> <span class="o">+</span> <span class="nx">nCommon</span><span class="p">;</span> <span class="c1">// number of lines compared in b</span>
  <span class="p">};</span>

  <span class="nx">diff</span><span class="p">(</span><span class="nx">aLength</span><span class="p">,</span> <span class="nx">bLength</span><span class="p">,</span> <span class="nx">isCommon</span><span class="p">,</span> <span class="nx">foundSubsequence</span><span class="p">);</span>

  <span class="c1">// After the last common subsequence, push remaining change lines.</span>
  <span class="nx">pushDelIns</span><span class="p">(</span><span class="nx">aLines</span><span class="p">,</span> <span class="nx">aIndex</span><span class="p">,</span> <span class="nx">aLength</span><span class="p">,</span> <span class="nx">bLines</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">,</span> <span class="nx">bLength</span><span class="p">,</span> <span class="nx">array</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="dl">''</span> <span class="p">:</span> <span class="nx">array</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="example-of-callback-functions-to-format-diff-lines">Example of callback functions to format diff lines</h2>

<p>Here is simplified code to format <strong>changed and unchanged lines</strong> in expected and received values after a test fails in Jest:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Format diff with minus or plus for change lines and space for common lines.</span>
<span class="kd">const</span> <span class="nx">formatDiffLines</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Jest depends on pretty-format package to serialize objects as strings.</span>
  <span class="c1">// Unindented for comparison to avoid distracting differences:</span>
  <span class="kd">const</span> <span class="nx">aLinesUn</span> <span class="o">=</span> <span class="nx">format</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="p">{</span><span class="na">indent</span><span class="p">:</span> <span class="mi">0</span> <span class="cm">/*, other options*/</span><span class="p">}).</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">bLinesUn</span> <span class="o">=</span> <span class="nx">format</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="p">{</span><span class="na">indent</span><span class="p">:</span> <span class="mi">0</span> <span class="cm">/*, other options*/</span><span class="p">}).</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="c1">// Indented to display changed and unchanged lines:</span>
  <span class="kd">const</span> <span class="nx">aLinesIn</span> <span class="o">=</span> <span class="nx">format</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="p">{</span><span class="na">indent</span><span class="p">:</span> <span class="mi">2</span> <span class="cm">/*, other options*/</span><span class="p">}).</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">bLinesIn</span> <span class="o">=</span> <span class="nx">format</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="p">{</span><span class="na">indent</span><span class="p">:</span> <span class="mi">2</span> <span class="cm">/*, other options*/</span><span class="p">}).</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">aLength</span> <span class="o">=</span> <span class="nx">aLinesIn</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// Validate: aLinesUn.length === aLength</span>
  <span class="kd">const</span> <span class="nx">bLength</span> <span class="o">=</span> <span class="nx">bLinesIn</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// Validate: bLinesUn.length === bLength</span>

  <span class="kd">const</span> <span class="nx">isCommon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">aLinesUn</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]</span> <span class="o">===</span> <span class="nx">bLinesUn</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">];</span>

  <span class="c1">// Only because the GitHub Flavored Markdown doc collapses adjacent spaces,</span>
  <span class="c1">// this example code and the following table represent spaces as middle dots.</span>
  <span class="kd">let</span> <span class="nx">aIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">bIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">const</span> <span class="nx">foundSubsequence</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nCommon</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">,</span> <span class="nx">bCommon</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="nx">aIndex</span> <span class="o">!==</span> <span class="nx">aCommon</span><span class="p">;</span> <span class="nx">aIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">-·</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">aLinesIn</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]);</span> <span class="c1">// delete is minus</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="nx">bIndex</span> <span class="o">!==</span> <span class="nx">bCommon</span><span class="p">;</span> <span class="nx">bIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">+·</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bLinesIn</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">]);</span> <span class="c1">// insert is plus</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="nx">nCommon</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">nCommon</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">aIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">bIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// For common lines, received indentation seems more intuitive.</span>
      <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">··</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bLinesIn</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">]);</span> <span class="c1">// common is space</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">diff</span><span class="p">(</span><span class="nx">aLength</span><span class="p">,</span> <span class="nx">bLength</span><span class="p">,</span> <span class="nx">isCommon</span><span class="p">,</span> <span class="nx">foundSubsequence</span><span class="p">);</span>

  <span class="c1">// After the last common subsequence, push remaining change lines.</span>
  <span class="k">for</span> <span class="p">(;</span> <span class="nx">aIndex</span> <span class="o">!==</span> <span class="nx">aLength</span><span class="p">;</span> <span class="nx">aIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">-·</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">aLinesIn</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(;</span> <span class="nx">bIndex</span> <span class="o">!==</span> <span class="nx">bLength</span><span class="p">;</span> <span class="nx">bIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">+·</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bLinesIn</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">expected</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">searching</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
  <span class="na">sorting</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">ascending</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">fieldKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">what</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">received</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">searching</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
  <span class="na">sorting</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">descending</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">fieldKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">what</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">],</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">diffLines</span> <span class="o">=</span> <span class="nx">formatDiffLines</span><span class="p">(</span><span class="nx">expected</span><span class="p">,</span> <span class="nx">received</span><span class="p">);</span>
</code></pre></div></div>

<p>If N is the sum of lengths of sequences and L is length of a longest common subsequence, then N – L is length of an array of diff lines. In this example, N is 7 + 9, L is 5, and N – L is 11.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">i</code></th>
      <th style="text-align: left"><code class="language-plaintext highlighter-rouge">diffLines[i]</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">aIndex</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">bIndex</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'··Object {'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'····"searching": "",'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">2</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'-···"sorting": Object {'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">2</code></td>
      <td style="text-align: right"> </td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">3</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'-·····"ascending": true,'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">3</code></td>
      <td style="text-align: right"> </td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">4</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'+·····"sorting": Array ['</code></td>
      <td style="text-align: right"> </td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">2</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">5</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'+·······Object {'</code></td>
      <td style="text-align: right"> </td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">3</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">6</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'+·········"descending": false,'</code></td>
      <td style="text-align: right"> </td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">4</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">7</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'··········"fieldKey": "what",'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">4</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">5</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">8</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'········},'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">5</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">6</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">9</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'+·····],'</code></td>
      <td style="text-align: right"> </td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">7</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">10</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'··}'</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">6</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">8</code></td>
    </tr>
  </tbody>
</table>

<h2 id="example-of-callback-functions-to-find-diff-items">Example of callback functions to find diff items</h2>

<p>Here is simplified code to find changed and unchanged substrings <strong>within adjacent changed lines</strong> in expected and received values after a test fails in Jest:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Return diff items for strings (compatible with diff-match-patch package).</span>
<span class="kd">const</span> <span class="nx">findDiffItems</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">isCommon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">bIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">[</span><span class="nx">aIndex</span><span class="p">]</span> <span class="o">===</span> <span class="nx">b</span><span class="p">[</span><span class="nx">bIndex</span><span class="p">];</span>

  <span class="kd">let</span> <span class="nx">aIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">bIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">const</span> <span class="nx">foundSubsequence</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nCommon</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">,</span> <span class="nx">bCommon</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">aIndex</span> <span class="o">!==</span> <span class="nx">aCommon</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">aIndex</span><span class="p">,</span> <span class="nx">aCommon</span><span class="p">)]);</span> <span class="c1">// delete is -1</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bIndex</span> <span class="o">!==</span> <span class="nx">bCommon</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">bIndex</span><span class="p">,</span> <span class="nx">bCommon</span><span class="p">)]);</span> <span class="c1">// insert is 1</span>
    <span class="p">}</span>

    <span class="nx">aIndex</span> <span class="o">=</span> <span class="nx">aCommon</span> <span class="o">+</span> <span class="nx">nCommon</span><span class="p">;</span> <span class="c1">// number of characters compared in a</span>
    <span class="nx">bIndex</span> <span class="o">=</span> <span class="nx">bCommon</span> <span class="o">+</span> <span class="nx">nCommon</span><span class="p">;</span> <span class="c1">// number of characters compared in b</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">aCommon</span><span class="p">,</span> <span class="nx">aIndex</span><span class="p">)]);</span> <span class="c1">// common is 0</span>
  <span class="p">};</span>

  <span class="nx">diff</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">isCommon</span><span class="p">,</span> <span class="nx">foundSubsequence</span><span class="p">);</span>

  <span class="c1">// After the last common subsequence, push remaining change items.</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">aIndex</span> <span class="o">!==</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">aIndex</span><span class="p">)]);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">bIndex</span> <span class="o">!==</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">bIndex</span><span class="p">)]);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">expectedDeleted</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">"sorting": Object {</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">"ascending": true,</span><span class="dl">'</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span>
  <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">,</span>
<span class="p">);</span>
<span class="kd">const</span> <span class="nx">receivedInserted</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">'</span><span class="s1">"sorting": Array [</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">Object {</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">"descending": false,</span><span class="dl">'</span><span class="p">,</span>
<span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">diffItems</span> <span class="o">=</span> <span class="nx">findDiffItems</span><span class="p">(</span><span class="nx">expectedDeleted</span><span class="p">,</span> <span class="nx">receivedInserted</span><span class="p">);</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">i</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">diffItems[i][0]</code></th>
      <th style="text-align: left"><code class="language-plaintext highlighter-rouge">diffItems[i][1]</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'"sorting": '</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'Array [\n'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">2</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'Object {\n"'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">3</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">-1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'a'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">4</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'de'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">5</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'scending": '</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">6</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">-1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'tru'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">7</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'fals'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">8</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'e,'</code></td>
    </tr>
  </tbody>
</table>

<p>The length difference <code class="language-plaintext highlighter-rouge">b.length - a.length</code> is equal to the sum of <code class="language-plaintext highlighter-rouge">diffItems[i][0]</code> values times <code class="language-plaintext highlighter-rouge">diffItems[i][1]</code> lengths. In this example, the difference <code class="language-plaintext highlighter-rouge">48 - 38</code> is equal to the sum <code class="language-plaintext highlighter-rouge">10</code>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">category of diff item</th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">[0]</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">[1]</code> lengths</th>
      <th style="text-align: right">subtotal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">in common</td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">11 + 10 + 11 + 2</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
    </tr>
    <tr>
      <td style="text-align: left">to delete from <code class="language-plaintext highlighter-rouge">a</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">–1</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1 + 3</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">-4</code></td>
    </tr>
    <tr>
      <td style="text-align: left">to insert from <code class="language-plaintext highlighter-rouge">b</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">8 + 2 + 4</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">14</code></td>
    </tr>
  </tbody>
</table>

<p>Instead of formatting the changed substrings with escape codes for colors in the <code class="language-plaintext highlighter-rouge">foundSubsequence</code> function to save memory, this example spends memory to <strong>gain flexibility</strong> before formatting, so a separate heuristic algorithm might modify the generic array of diff items to show changes more clearly:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">i</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">diffItems[i][0]</code></th>
      <th style="text-align: left"><code class="language-plaintext highlighter-rouge">diffItems[i][1]</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">6</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">-1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'true'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">7</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">1</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">'false'</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">8</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">0</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">','</code></td>
    </tr>
  </tbody>
</table>

<p>For expected and received strings of serialized data, the result of finding changed <strong>lines</strong>, and then finding changed <strong>substrings</strong> within adjacent changed lines (as in the preceding two examples) sometimes displays the changes in a more intuitive way than the result of finding changed substrings, and then splitting them into changed and unchanged lines.</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
