<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>tough-cookie | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="tough-cookie" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/tough-cookie/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/tough-cookie/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="tough-cookie" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"tough-cookie","url":"http://localhost:4000/myportfolio.client/node_modules/tough-cookie/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=059dd2210d8f0fb8d42af0cbb5c1b29e59b98886">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="tough-cookie">tough-cookie</h1>

<p><a href="https://tools.ietf.org/html/rfc6265">RFC 6265</a> Cookies and CookieJar for Node.js</p>

<p><a href="https://nodei.co/npm/tough-cookie/"><img src="https://nodei.co/npm/tough-cookie.png?downloads=true&amp;downloadRank=true&amp;stars=true" alt="npm package" /></a></p>

<p><a href="https://travis-ci.org/salesforce/tough-cookie"><img src="https://travis-ci.org/salesforce/tough-cookie.svg?branch=master" alt="Build Status" /></a></p>

<h2 id="synopsis">Synopsis</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">tough</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">tough-cookie</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Cookie</span> <span class="o">=</span> <span class="nx">tough</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">header</span><span class="p">);</span>
<span class="nx">cookie</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">somethingdifferent</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">header</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">cookiejar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">tough</span><span class="p">.</span><span class="nx">CookieJar</span><span class="p">();</span>

<span class="c1">// Asynchronous!</span>
<span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cookiejar</span><span class="p">.</span><span class="nx">setCookie</span><span class="p">(</span>
  <span class="nx">cookie</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">https://currentdomain.example.com/path</span><span class="dl">"</span>
<span class="p">);</span>
<span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cookiejar</span><span class="p">.</span><span class="nx">getCookies</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://example.com/otherpath</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Or with callbacks!</span>
<span class="nx">cookiejar</span><span class="p">.</span><span class="nx">setCookie</span><span class="p">(</span>
  <span class="nx">cookie</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">https://currentdomain.example.com/path</span><span class="dl">"</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cookie</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>
<span class="p">);</span>
<span class="nx">cookiejar</span><span class="p">.</span><span class="nx">getCookies</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://example.com/otherpath</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cookies</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Why the name? NPM modules <code class="language-plaintext highlighter-rouge">cookie</code>, <code class="language-plaintext highlighter-rouge">cookies</code> and <code class="language-plaintext highlighter-rouge">cookiejar</code> were already taken.</p>

<h2 id="installation">Installation</h2>

<p>It’s <em>so</em> easy! Install with <code class="language-plaintext highlighter-rouge">npm</code> or your preferred package manager.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>tough-cookie
</code></pre></div></div>

<h2 id="nodejs-version-support">Node.js Version Support</h2>

<p>We follow the <a href="https://github.com/nodejs/Release#release-schedule">node.js release schedule</a> and support all versions that are in Active LTS or Maintenance. We will always do a major release when dropping support for older versions of node, and we will do so in consultation with our community.</p>

<h2 id="api">API</h2>

<h3 id="tough">tough</h3>

<p>The top-level exports from <code class="language-plaintext highlighter-rouge">require('tough-cookie')</code> can all be used as pure functions and don’t need to be bound.</p>

<h4 id="parsedatestring"><code class="language-plaintext highlighter-rouge">parseDate(string)</code></h4>

<p>Parse a cookie date string into a <code class="language-plaintext highlighter-rouge">Date</code>. Parses according to <a href="https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.1">RFC 6265 Section 5.1.1</a>, not <code class="language-plaintext highlighter-rouge">Date.parse()</code>.</p>

<h4 id="formatdatedate"><code class="language-plaintext highlighter-rouge">formatDate(date)</code></h4>

<p>Format a <code class="language-plaintext highlighter-rouge">Date</code> into an <a href="https://datatracker.ietf.org/doc/html/rfc822#section-5">RFC 822</a> string (the RFC 6265 recommended format).</p>

<h4 id="canonicaldomainstr"><code class="language-plaintext highlighter-rouge">canonicalDomain(str)</code></h4>

<p>Transforms a domain name into a canonical domain name. The canonical domain name is a domain name that has been trimmed, lowercased, stripped of leading dot, and optionally punycode-encoded (<a href="https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.2">Section 5.1.2 of RFC 6265</a>). For the most part, this function is idempotent (calling the function with the output from a previous call returns the same output).</p>

<h4 id="domainmatchstr-domstr-canonicalizetrue"><code class="language-plaintext highlighter-rouge">domainMatch(str, domStr[, canonicalize=true])</code></h4>

<p>Answers “does this real domain match the domain in a cookie?”. The <code class="language-plaintext highlighter-rouge">str</code> is the “current” domain name and the <code class="language-plaintext highlighter-rouge">domStr</code> is the “cookie” domain name. Matches according to <a href="https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.3">RFC 6265 Section 5.1.3</a>, but it helps to think of it as a “suffix match”.</p>

<p>The <code class="language-plaintext highlighter-rouge">canonicalize</code> parameter toggles whether the domain parameters get normalized with <code class="language-plaintext highlighter-rouge">canonicalDomain</code> or not.</p>

<h4 id="defaultpathpath"><code class="language-plaintext highlighter-rouge">defaultPath(path)</code></h4>

<p>Given a current request/response path, gives the path appropriate for storing in a cookie. This is basically the “directory” of a “file” in the path, but is specified by <a href="https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.4">Section 5.1.4 of the RFC</a>.</p>

<p>The <code class="language-plaintext highlighter-rouge">path</code> parameter MUST be <em>only</em> the pathname part of a URI (excluding the hostname, query, fragment, and so on). This is the <code class="language-plaintext highlighter-rouge">.pathname</code> property of node’s <code class="language-plaintext highlighter-rouge">uri.parse()</code> output.</p>

<h4 id="pathmatchreqpath-cookiepath"><code class="language-plaintext highlighter-rouge">pathMatch(reqPath, cookiePath)</code></h4>

<p>Answers “does the request-path path-match a given cookie-path?” as per <a href="https://datatracker.ietf.org/doc/html/rfc6265#section-5.1.4">RFC 6265 Section 5.1.4</a>. Returns a boolean.</p>

<p>This is essentially a prefix-match where <code class="language-plaintext highlighter-rouge">cookiePath</code> is a prefix of <code class="language-plaintext highlighter-rouge">reqPath</code>.</p>

<h4 id="parsecookiestring-options"><code class="language-plaintext highlighter-rouge">parse(cookieString[, options])</code></h4>

<p>Alias for <a href="#cookieparsecookiestring-options"><code class="language-plaintext highlighter-rouge">Cookie.parse(cookieString[, options])</code></a>.</p>

<h4 id="fromjsonstring"><code class="language-plaintext highlighter-rouge">fromJSON(string)</code></h4>

<p>Alias for <a href="#cookiefromjsonstrorobj"><code class="language-plaintext highlighter-rouge">Cookie.fromJSON(string)</code></a>.</p>

<h4 id="getpublicsuffixhostname"><code class="language-plaintext highlighter-rouge">getPublicSuffix(hostname)</code></h4>

<p>Returns the public suffix of this hostname. The public suffix is the shortest domain name upon which a cookie can be set. Returns <code class="language-plaintext highlighter-rouge">null</code> if the hostname cannot have cookies set for it.</p>

<p>For example: <code class="language-plaintext highlighter-rouge">www.example.com</code> and <code class="language-plaintext highlighter-rouge">www.subdomain.example.com</code> both have public suffix <code class="language-plaintext highlighter-rouge">example.com</code>.</p>

<p>For further information, see the <a href="http://publicsuffix.org/">Public Suffix List</a>. This module derives its list from that site. This call is a wrapper around <a href="https://www.npmjs.com/package/psl"><code class="language-plaintext highlighter-rouge">psl</code></a>’s <a href="https://www.npmjs.com/package/psl##pslgetdomain"><code class="language-plaintext highlighter-rouge">get</code> method</a>.</p>

<h4 id="cookiecomparea-b"><code class="language-plaintext highlighter-rouge">cookieCompare(a, b)</code></h4>

<p>For use with <code class="language-plaintext highlighter-rouge">.sort()</code>, sorts a list of cookies into the recommended order given in step 2 of (<a href="https://datatracker.ietf.org/doc/html/rfc6265#section-5.4">RFC 6265 Section 5.4</a>). The sort algorithm is, in order of precedence:</p>

<ul>
  <li>Longest <code class="language-plaintext highlighter-rouge">.path</code></li>
  <li>oldest <code class="language-plaintext highlighter-rouge">.creation</code> (which has a 1-ms precision, same as <code class="language-plaintext highlighter-rouge">Date</code>)</li>
  <li>lowest <code class="language-plaintext highlighter-rouge">.creationIndex</code> (to get beyond the 1-ms precision)</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="p">[</span>
  <span class="cm">/* unsorted array of Cookie objects */</span>
<span class="p">];</span>
<span class="nx">cookies</span> <span class="o">=</span> <span class="nx">cookies</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">cookieCompare</span><span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: Since the JavaScript <code class="language-plaintext highlighter-rouge">Date</code> is limited to a 1-ms precision, cookies within the same millisecond are entirely possible. This is especially true when using the <code class="language-plaintext highlighter-rouge">now</code> option to <code class="language-plaintext highlighter-rouge">.setCookie()</code>. The <code class="language-plaintext highlighter-rouge">.creationIndex</code> property is a per-process global counter, assigned during construction with <code class="language-plaintext highlighter-rouge">new Cookie()</code>, which preserves the spirit of the RFC sorting: older cookies go first. This works great for <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> since <code class="language-plaintext highlighter-rouge">Set-Cookie</code> headers are parsed in order, but is not so great for distributed systems. Sophisticated <code class="language-plaintext highlighter-rouge">Store</code>s may wish to set this to some other <em>logical clock</em> so that if cookies A and B are created in the same millisecond, but cookie A is created before cookie B, then <code class="language-plaintext highlighter-rouge">A.creationIndex &lt; B.creationIndex</code>. If you want to alter the global counter, which you probably <em>shouldn’t</em> do, it’s stored in <code class="language-plaintext highlighter-rouge">Cookie.cookiesCreated</code>.</p>
</blockquote>

<h4 id="permutedomaindomain"><code class="language-plaintext highlighter-rouge">permuteDomain(domain)</code></h4>

<p>Generates a list of all possible domains that <code class="language-plaintext highlighter-rouge">domainMatch()</code> the parameter. Can be handy for implementing cookie stores.</p>

<h4 id="permutepathpath"><code class="language-plaintext highlighter-rouge">permutePath(path)</code></h4>

<p>Generates a list of all possible paths that <code class="language-plaintext highlighter-rouge">pathMatch()</code> the parameter. Can be handy for implementing cookie stores.</p>

<h3 id="cookie">Cookie</h3>

<p>Exported via <code class="language-plaintext highlighter-rouge">tough.Cookie</code>.</p>

<h4 id="cookieparsecookiestring-options"><code class="language-plaintext highlighter-rouge">Cookie.parse(cookieString[, options])</code></h4>

<p>Parses a single Cookie or Set-Cookie HTTP header into a <code class="language-plaintext highlighter-rouge">Cookie</code> object. Returns <code class="language-plaintext highlighter-rouge">undefined</code> if the string can’t be parsed.</p>

<p>The options parameter is not required and currently has only one property:</p>

<ul>
  <li><em>loose</em> - boolean - if <code class="language-plaintext highlighter-rouge">true</code> enable parsing of keyless cookies like <code class="language-plaintext highlighter-rouge">=abc</code> and <code class="language-plaintext highlighter-rouge">=</code>, which are not RFC-compliant.</li>
</ul>

<p>If options is not an object it is ignored, which means it can be used with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code class="language-plaintext highlighter-rouge">Array#map</code></a>.</p>

<p>To process the Set-Cookie header(s) on a node HTTP/HTTPS response:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">"</span><span class="s2">set-cookie</span><span class="dl">"</span><span class="p">]))</span>
  <span class="nx">cookies</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">"</span><span class="s2">set-cookie</span><span class="dl">"</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">Cookie</span><span class="p">.</span><span class="nx">parse</span><span class="p">);</span>
<span class="k">else</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="p">[</span><span class="nx">Cookie</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">"</span><span class="s2">set-cookie</span><span class="dl">"</span><span class="p">])];</span>
</code></pre></div></div>

<p><em>Note:</em> In version 2.3.3, tough-cookie limited the number of spaces before the <code class="language-plaintext highlighter-rouge">=</code> to 256 characters. This limitation was removed in version 2.3.4.
For more details, see <a href="https://github.com/salesforce/tough-cookie/issues/92">issue #92</a>.</p>

<h4 id="properties">Properties</h4>

<p>Cookie object properties:</p>

<ul>
  <li><em>key</em> - string - the name or key of the cookie (default <code class="language-plaintext highlighter-rouge">""</code>)</li>
  <li><em>value</em> - string - the value of the cookie (default <code class="language-plaintext highlighter-rouge">""</code>)</li>
  <li><em>expires</em> - <code class="language-plaintext highlighter-rouge">Date</code> - if set, the <code class="language-plaintext highlighter-rouge">Expires=</code> attribute of the cookie (defaults to the string <code class="language-plaintext highlighter-rouge">"Infinity"</code>). See <code class="language-plaintext highlighter-rouge">setExpires()</code></li>
  <li><em>maxAge</em> - seconds - if set, the <code class="language-plaintext highlighter-rouge">Max-Age=</code> attribute <em>in seconds</em> of the cookie. Can also be set to strings <code class="language-plaintext highlighter-rouge">"Infinity"</code> and <code class="language-plaintext highlighter-rouge">"-Infinity"</code> for non-expiry and immediate-expiry, respectively. See <code class="language-plaintext highlighter-rouge">setMaxAge()</code></li>
  <li><em>domain</em> - string - the <code class="language-plaintext highlighter-rouge">Domain=</code> attribute of the cookie</li>
  <li><em>path</em> - string - the <code class="language-plaintext highlighter-rouge">Path=</code> of the cookie</li>
  <li><em>secure</em> - boolean - the <code class="language-plaintext highlighter-rouge">Secure</code> cookie flag</li>
  <li><em>httpOnly</em> - boolean - the <code class="language-plaintext highlighter-rouge">HttpOnly</code> cookie flag</li>
  <li><em>sameSite</em> - string - the <code class="language-plaintext highlighter-rouge">SameSite</code> cookie attribute (from <a href="#rfc-6265bis">RFC 6265bis</a>); must be one of <code class="language-plaintext highlighter-rouge">none</code>, <code class="language-plaintext highlighter-rouge">lax</code>, or <code class="language-plaintext highlighter-rouge">strict</code></li>
  <li><em>extensions</em> - <code class="language-plaintext highlighter-rouge">Array</code> - any unrecognized cookie attributes as strings (even if equal-signs inside)</li>
  <li><em>creation</em> - <code class="language-plaintext highlighter-rouge">Date</code> - when this cookie was constructed</li>
  <li><em>creationIndex</em> - number - set at construction, used to provide greater sort precision (see <code class="language-plaintext highlighter-rouge">cookieCompare(a,b)</code> for a full explanation)</li>
</ul>

<p>After a cookie has been passed through <code class="language-plaintext highlighter-rouge">CookieJar.setCookie()</code> it has the following additional attributes:</p>

<ul>
  <li><em>hostOnly</em> - boolean - is this a host-only cookie (that is, no Domain field was set, but was instead implied).</li>
  <li><em>pathIsDefault</em> - boolean - if true, there was no Path field on the cookie and <code class="language-plaintext highlighter-rouge">defaultPath()</code> was used to derive one.</li>
  <li><em>creation</em> - <code class="language-plaintext highlighter-rouge">Date</code> - <strong>modified</strong> from construction to when the cookie was added to the jar.</li>
  <li><em>lastAccessed</em> - <code class="language-plaintext highlighter-rouge">Date</code> - last time the cookie got accessed. Affects cookie cleaning after it is implemented. Using <code class="language-plaintext highlighter-rouge">cookiejar.getCookies(...)</code> updates this attribute.</li>
</ul>

<h4 id="new-cookieproperties"><code class="language-plaintext highlighter-rouge">new Cookie([properties])</code></h4>

<p>Receives an options object that can contain any of the above Cookie properties. Uses the default for unspecified properties.</p>

<h4 id="tostring"><code class="language-plaintext highlighter-rouge">.toString()</code></h4>

<p>Encodes to a Set-Cookie header value. The Expires cookie field is set using <code class="language-plaintext highlighter-rouge">formatDate()</code>, but is omitted entirely if <code class="language-plaintext highlighter-rouge">.expires</code> is <code class="language-plaintext highlighter-rouge">Infinity</code>.</p>

<h4 id="cookiestring"><code class="language-plaintext highlighter-rouge">.cookieString()</code></h4>

<p>Encodes to a Cookie header value (specifically, the <code class="language-plaintext highlighter-rouge">.key</code> and <code class="language-plaintext highlighter-rouge">.value</code> properties joined with <code class="language-plaintext highlighter-rouge">"="</code>).</p>

<h4 id="setexpiresstring"><code class="language-plaintext highlighter-rouge">.setExpires(string)</code></h4>

<p>Sets the expiry based on a date-string passed through <code class="language-plaintext highlighter-rouge">parseDate()</code>. If parseDate returns <code class="language-plaintext highlighter-rouge">null</code> (that is, can’t parse this date string), <code class="language-plaintext highlighter-rouge">.expires</code> is set to <code class="language-plaintext highlighter-rouge">"Infinity"</code> (a string).</p>

<h4 id="setmaxagenumber"><code class="language-plaintext highlighter-rouge">.setMaxAge(number)</code></h4>

<p>Sets the maxAge in seconds. Coerces <code class="language-plaintext highlighter-rouge">-Infinity</code> to <code class="language-plaintext highlighter-rouge">"-Infinity"</code> and <code class="language-plaintext highlighter-rouge">Infinity</code> to <code class="language-plaintext highlighter-rouge">"Infinity"</code> so it correctly serializes to JSON.</p>

<h4 id="expirydatenowdatenow"><code class="language-plaintext highlighter-rouge">.expiryDate([now=Date.now()])</code></h4>

<p><code class="language-plaintext highlighter-rouge">expiryTime()</code> computes the absolute unix-epoch milliseconds that this cookie expires. <code class="language-plaintext highlighter-rouge">expiryDate()</code> works similarly, except it returns a <code class="language-plaintext highlighter-rouge">Date</code> object. Note that in both cases the <code class="language-plaintext highlighter-rouge">now</code> parameter should be milliseconds.</p>

<p>Max-Age takes precedence over Expires (as per the RFC). The <code class="language-plaintext highlighter-rouge">.creation</code> attribute – or, by default, the <code class="language-plaintext highlighter-rouge">now</code> parameter – is used to offset the <code class="language-plaintext highlighter-rouge">.maxAge</code> attribute.</p>

<p>If Expires (<code class="language-plaintext highlighter-rouge">.expires</code>) is set, that’s returned.</p>

<p>Otherwise, <code class="language-plaintext highlighter-rouge">expiryTime()</code> returns <code class="language-plaintext highlighter-rouge">Infinity</code> and <code class="language-plaintext highlighter-rouge">expiryDate()</code> returns a <code class="language-plaintext highlighter-rouge">Date</code> object for “Tue, 19 Jan 2038 03:14:07 GMT” (latest date that can be expressed by a 32-bit <code class="language-plaintext highlighter-rouge">time_t</code>; the common limit for most user-agents).</p>

<h4 id="ttlnowdatenow"><code class="language-plaintext highlighter-rouge">.TTL([now=Date.now()])</code></h4>

<p>Computes the TTL relative to <code class="language-plaintext highlighter-rouge">now</code> (milliseconds). The same precedence rules as for <code class="language-plaintext highlighter-rouge">expiryTime</code>/<code class="language-plaintext highlighter-rouge">expiryDate</code> apply.</p>

<p><code class="language-plaintext highlighter-rouge">Infinity</code> is returned for cookies without an explicit expiry and <code class="language-plaintext highlighter-rouge">0</code> is returned if the cookie is expired. Otherwise a time-to-live in milliseconds is returned.</p>

<h4 id="canonicalizeddomain"><code class="language-plaintext highlighter-rouge">.canonicalizedDomain()</code></h4>

<h4 id="cdomain"><code class="language-plaintext highlighter-rouge">.cdomain()</code></h4>

<p>Returns the canonicalized <code class="language-plaintext highlighter-rouge">.domain</code> field. This is lower-cased and punycode (<a href="https://datatracker.ietf.org/doc/html/rfc3490">RFC 3490</a>) encoded if the domain has any non-ASCII characters.</p>

<h4 id="tojson"><code class="language-plaintext highlighter-rouge">.toJSON()</code></h4>

<p>For convenience in using <code class="language-plaintext highlighter-rouge">JSON.serialize(cookie)</code>. Returns a plain-old <code class="language-plaintext highlighter-rouge">Object</code> that can be JSON-serialized.</p>

<p>Any <code class="language-plaintext highlighter-rouge">Date</code> properties (such as <code class="language-plaintext highlighter-rouge">.expires</code>, <code class="language-plaintext highlighter-rouge">.creation</code>, and <code class="language-plaintext highlighter-rouge">.lastAccessed</code>) are exported in ISO format (<code class="language-plaintext highlighter-rouge">.toISOString()</code>).</p>

<blockquote>
  <p><strong>NOTE</strong>: Custom <code class="language-plaintext highlighter-rouge">Cookie</code> properties are discarded. In tough-cookie 1.x, since there was no <code class="language-plaintext highlighter-rouge">.toJSON</code> method explicitly defined, all enumerable properties were captured. If you want a property to be serialized, add the property name to the <code class="language-plaintext highlighter-rouge">Cookie.serializableProperties</code> Array.</p>
</blockquote>

<h4 id="cookiefromjsonstrorobj"><code class="language-plaintext highlighter-rouge">Cookie.fromJSON(strOrObj)</code></h4>

<p>Does the reverse of <code class="language-plaintext highlighter-rouge">cookie.toJSON()</code>. If passed a string, will <code class="language-plaintext highlighter-rouge">JSON.parse()</code> that first.</p>

<p>Any <code class="language-plaintext highlighter-rouge">Date</code> properties (such as <code class="language-plaintext highlighter-rouge">.expires</code>, <code class="language-plaintext highlighter-rouge">.creation</code>, and <code class="language-plaintext highlighter-rouge">.lastAccessed</code>) are parsed via <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse"><code class="language-plaintext highlighter-rouge">Date.parse</code></a>, not tough-cookie’s <code class="language-plaintext highlighter-rouge">parseDate</code>, since ISO timestamps are being handled at this layer.</p>

<p>Returns <code class="language-plaintext highlighter-rouge">null</code> upon a JSON parsing error.</p>

<h4 id="clone"><code class="language-plaintext highlighter-rouge">.clone()</code></h4>

<p>Does a deep clone of this cookie, implemented exactly as <code class="language-plaintext highlighter-rouge">Cookie.fromJSON(cookie.toJSON())</code>.</p>

<h4 id="validate"><code class="language-plaintext highlighter-rouge">.validate()</code></h4>

<p>Status: <em>IN PROGRESS</em>. Works for a few things, but is by no means comprehensive.</p>

<p>Validates cookie attributes for semantic correctness. Useful for “lint” checking any Set-Cookie headers you generate. For now, it returns a boolean, but eventually could return a reason string. Future-proof with this construct:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">validate</span><span class="p">()</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// it's tasty</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// yuck!</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="cookiejar">CookieJar</h3>

<p>Exported via <code class="language-plaintext highlighter-rouge">tough.CookieJar</code>.</p>

<h4 id="cookiejarstore-options"><code class="language-plaintext highlighter-rouge">CookieJar([store][, options])</code></h4>

<p>Simply use <code class="language-plaintext highlighter-rouge">new CookieJar()</code>. If a custom store is not passed to the constructor, a <a href="#memorycookiestore"><code class="language-plaintext highlighter-rouge">MemoryCookieStore</code></a> is created and used.</p>

<p>The <code class="language-plaintext highlighter-rouge">options</code> object can be omitted and can have the following properties:</p>

<ul>
  <li><em>rejectPublicSuffixes</em> - boolean - default <code class="language-plaintext highlighter-rouge">true</code> - reject cookies with domains like “com” and “co.uk”</li>
  <li><em>looseMode</em> - boolean - default <code class="language-plaintext highlighter-rouge">false</code> - accept malformed cookies like <code class="language-plaintext highlighter-rouge">bar</code> and <code class="language-plaintext highlighter-rouge">=bar</code>, which have an implied empty name.</li>
  <li><em>prefixSecurity</em> - string - default <code class="language-plaintext highlighter-rouge">silent</code> - set to <code class="language-plaintext highlighter-rouge">'unsafe-disabled'</code>, <code class="language-plaintext highlighter-rouge">'silent'</code>, or <code class="language-plaintext highlighter-rouge">'strict'</code>. See <a href="#cookie-prefixes">Cookie Prefixes</a> below.</li>
  <li><em>allowSpecialUseDomain</em> - boolean - default <code class="language-plaintext highlighter-rouge">true</code> - accepts special-use domain suffixes, such as <code class="language-plaintext highlighter-rouge">local</code>. Useful for testing purposes.
This is not in the standard, but is used sometimes on the web and is accepted by most browsers.</li>
</ul>

<h4 id="setcookiecookieorstring-currenturl-options-callbackerr-cookie"><code class="language-plaintext highlighter-rouge">.setCookie(cookieOrString, currentUrl[, options][, callback(err, cookie)])</code></h4>

<p>Attempt to set the cookie in the cookie jar. The cookie has updated <code class="language-plaintext highlighter-rouge">.creation</code>, <code class="language-plaintext highlighter-rouge">.lastAccessed</code> and <code class="language-plaintext highlighter-rouge">.hostOnly</code> properties. And returns a promise if a callback is not provided.</p>

<p>The <code class="language-plaintext highlighter-rouge">options</code> object can be omitted and can have the following properties:</p>

<ul>
  <li><em>http</em> - boolean - default <code class="language-plaintext highlighter-rouge">true</code> - indicates if this is an HTTP or non-HTTP API. Affects <code class="language-plaintext highlighter-rouge">HttpOnly</code> cookies.</li>
  <li><em>secure</em> - boolean - autodetect from URL - indicates if this is a “Secure” API. If the currentUrl starts with <code class="language-plaintext highlighter-rouge">https:</code> or <code class="language-plaintext highlighter-rouge">wss:</code> this defaults to <code class="language-plaintext highlighter-rouge">true</code>, otherwise <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li><em>now</em> - Date - default <code class="language-plaintext highlighter-rouge">new Date()</code> - what to use for the creation or access time of cookies.</li>
  <li><em>ignoreError</em> - boolean - default <code class="language-plaintext highlighter-rouge">false</code> - silently ignore things like parse errors and invalid domains. <code class="language-plaintext highlighter-rouge">Store</code> errors aren’t ignored by this option.</li>
  <li><em>sameSiteContext</em> - string - default unset - set to <code class="language-plaintext highlighter-rouge">'none'</code>, <code class="language-plaintext highlighter-rouge">'lax'</code>, or <code class="language-plaintext highlighter-rouge">'strict'</code> See <a href="#samesite-cookies">SameSite Cookies</a> below.</li>
</ul>

<p>As per the RFC, the <code class="language-plaintext highlighter-rouge">.hostOnly</code> property is set if there was no “Domain=” parameter in the cookie string (or <code class="language-plaintext highlighter-rouge">.domain</code> was null on the Cookie object). The <code class="language-plaintext highlighter-rouge">.domain</code> property is set to the fully-qualified hostname of <code class="language-plaintext highlighter-rouge">currentUrl</code> in this case. Matching this cookie requires an exact hostname match (not a <code class="language-plaintext highlighter-rouge">domainMatch</code> as per usual).</p>

<h4 id="setcookiesynccookieorstring-currenturl-options"><code class="language-plaintext highlighter-rouge">.setCookieSync(cookieOrString, currentUrl[, options])</code></h4>

<p>Synchronous version of <a href="#setcookiecookieorstring-currenturl-options-callbackerr-cookie"><code class="language-plaintext highlighter-rouge">setCookie</code></a>; only works with synchronous stores (that is, the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code>).</p>

<h4 id="getcookiescurrenturl-options-callbackerr-cookies"><code class="language-plaintext highlighter-rouge">.getCookies(currentUrl[, options][, callback(err, cookies)])</code></h4>

<p>Retrieve the list of cookies that can be sent in a Cookie header for the current URL. Returns a promise if a callback is not provided.</p>

<p>Returns an array of <code class="language-plaintext highlighter-rouge">Cookie</code> objects, sorted by default using <a href="#cookiecomparea-b"><code class="language-plaintext highlighter-rouge">cookieCompare</code></a>.</p>

<p>If an error is encountered it’s passed as <code class="language-plaintext highlighter-rouge">err</code> to the callback, otherwise an array of <code class="language-plaintext highlighter-rouge">Cookie</code> objects is passed. The array is sorted with <code class="language-plaintext highlighter-rouge">cookieCompare()</code> unless the <code class="language-plaintext highlighter-rouge">{sort:false}</code> option is given.</p>

<p>The <code class="language-plaintext highlighter-rouge">options</code> object can be omitted and can have the following properties:</p>

<ul>
  <li><em>http</em> - boolean - default <code class="language-plaintext highlighter-rouge">true</code> - indicates if this is an HTTP or non-HTTP API. Affects <code class="language-plaintext highlighter-rouge">HttpOnly</code> cookies.</li>
  <li><em>secure</em> - boolean - autodetect from URL - indicates if this is a “Secure” API. If the currentUrl starts with <code class="language-plaintext highlighter-rouge">https:</code> or <code class="language-plaintext highlighter-rouge">wss:</code> then this is defaulted to <code class="language-plaintext highlighter-rouge">true</code>, otherwise <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li><em>now</em> - Date - default <code class="language-plaintext highlighter-rouge">new Date()</code> - what to use for the creation or access time of cookies</li>
  <li><em>expire</em> - boolean - default <code class="language-plaintext highlighter-rouge">true</code> - perform expiry-time checking of cookies and asynchronously remove expired cookies from the store. Using <code class="language-plaintext highlighter-rouge">false</code> returns expired cookies and does <strong>not</strong> remove them from the store (which is potentially useful for replaying Set-Cookie headers).</li>
  <li><em>allPaths</em> - boolean - default <code class="language-plaintext highlighter-rouge">false</code> - if <code class="language-plaintext highlighter-rouge">true</code>, do not scope cookies by path. The default uses RFC-compliant path scoping. <strong>Note</strong>: may not be supported by the underlying store (the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> supports it).</li>
  <li><em>sameSiteContext</em> - string - default unset - Set this to <code class="language-plaintext highlighter-rouge">'none'</code>, <code class="language-plaintext highlighter-rouge">'lax'</code>, or <code class="language-plaintext highlighter-rouge">'strict'</code> to enforce SameSite cookies upon retrieval. See <a href="#samesite-cookies">SameSite Cookies</a> below.</li>
  <li><em>sort</em> - boolean - whether to sort the list of cookies.</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">.lastAccessed</code> property of the returned cookies will have been updated.</p>

<h4 id="getcookiessynccurrenturl-options"><code class="language-plaintext highlighter-rouge">.getCookiesSync(currentUrl, [{options}])</code></h4>

<p>Synchronous version of <a href="#getcookiescurrenturl-options-callbackerr-cookies"><code class="language-plaintext highlighter-rouge">getCookies</code></a>; only works with synchronous stores (for example, the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code>).</p>

<h4 id="getcookiestring"><code class="language-plaintext highlighter-rouge">.getCookieString(...)</code></h4>

<p>Accepts the same options as <a href="#getcookiescurrenturl-options-callbackerr-cookies"><code class="language-plaintext highlighter-rouge">.getCookies()</code></a> but returns a string suitable for a Cookie header rather than an Array.</p>

<h4 id="getcookiestringsync"><code class="language-plaintext highlighter-rouge">.getCookieStringSync(...)</code></h4>

<p>Synchronous version of <a href="#getcookiestring"><code class="language-plaintext highlighter-rouge">getCookieString</code></a>; only works with synchronous stores (for example, the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code>).</p>

<h4 id="getsetcookiestrings"><code class="language-plaintext highlighter-rouge">.getSetCookieStrings(...)</code></h4>

<p>Returns an array of strings suitable for <strong>Set-Cookie</strong> headers. Accepts the same options as <a href="#getcookiescurrenturl-options-callbackerr-cookies"><code class="language-plaintext highlighter-rouge">.getCookies()</code></a>. Simply maps the cookie array via <code class="language-plaintext highlighter-rouge">.toString()</code>.</p>

<h4 id="getsetcookiestringssync"><code class="language-plaintext highlighter-rouge">.getSetCookieStringsSync(...)</code></h4>

<p>Synchronous version of <a href="#getsetcookiestrings"><code class="language-plaintext highlighter-rouge">getSetCookieStrings</code></a>; only works with synchronous stores (for example, the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code>).</p>

<h4 id="serializecallbackerr-serializedobject"><code class="language-plaintext highlighter-rouge">.serialize([callback(err, serializedObject)])</code></h4>

<p>Returns a promise if a callback is not provided.</p>

<p>Serialize the Jar if the underlying store supports <code class="language-plaintext highlighter-rouge">.getAllCookies</code>.</p>

<blockquote>
  <p><strong>NOTE</strong>: Custom <code class="language-plaintext highlighter-rouge">Cookie</code> properties are discarded. If you want a property to be serialized, add the property name to the <code class="language-plaintext highlighter-rouge">Cookie.serializableProperties</code> Array.</p>
</blockquote>

<p>See <a href="#serialization-format">Serialization Format</a>.</p>

<h4 id="serializesync"><code class="language-plaintext highlighter-rouge">.serializeSync()</code></h4>

<p>Synchronous version of <a href="#serializecallbackerr-serializedobject"><code class="language-plaintext highlighter-rouge">serialize</code></a>; only works with synchronous stores (for example, the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code>).</p>

<h4 id="tojson-1"><code class="language-plaintext highlighter-rouge">.toJSON()</code></h4>

<p>Alias of <a href="#serializesync"><code class="language-plaintext highlighter-rouge">.serializeSync()</code></a> for the convenience of <code class="language-plaintext highlighter-rouge">JSON.stringify(cookiejar)</code>.</p>

<h4 id="cookiejardeserializeserialized-store-callbackerr-object"><code class="language-plaintext highlighter-rouge">CookieJar.deserialize(serialized[, store][, callback(err, object)])</code></h4>

<p>A new Jar is created and the serialized Cookies are added to the underlying store. Each <code class="language-plaintext highlighter-rouge">Cookie</code> is added via <code class="language-plaintext highlighter-rouge">store.putCookie</code> in the order in which they appear in the serialization. A promise is returned if a callback is not provided.</p>

<p>The <code class="language-plaintext highlighter-rouge">store</code> argument is optional, but should be an instance of <code class="language-plaintext highlighter-rouge">Store</code>. By default, a new instance of <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> is created.</p>

<p>As a convenience, if <code class="language-plaintext highlighter-rouge">serialized</code> is a string, it is passed through <code class="language-plaintext highlighter-rouge">JSON.parse</code> first.</p>

<h4 id="cookiejardeserializesyncserialized-store"><code class="language-plaintext highlighter-rouge">CookieJar.deserializeSync(serialized[, store])</code></h4>

<p>Sync version of <a href="#cookiejardeserializeserialized-store-callbackerr-object"><code class="language-plaintext highlighter-rouge">.deserialize</code></a>; only works with synchronous stores (for example, the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code>).</p>

<h4 id="cookiejarfromjsonstring"><code class="language-plaintext highlighter-rouge">CookieJar.fromJSON(string)</code></h4>

<p>Alias of <a href="#cookiejardeserializesyncserialized-store"><code class="language-plaintext highlighter-rouge">.deserializeSync</code></a> to provide consistency with <a href="#cookiefromjsonstrorobj"><code class="language-plaintext highlighter-rouge">Cookie.fromJSON()</code></a>.</p>

<h4 id="clonestore-callbackerr-cloned"><code class="language-plaintext highlighter-rouge">.clone([store][, callback(err, cloned))</code></h4>

<p>Produces a deep clone of this jar. Modifications to the original do not affect the clone, and vice versa. Returns a promise if a callback is not provided.</p>

<p>The <code class="language-plaintext highlighter-rouge">store</code> argument is optional, but should be an instance of <code class="language-plaintext highlighter-rouge">Store</code>. By default, a new instance of <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> is created. Transferring between store types is supported so long as the source implements <code class="language-plaintext highlighter-rouge">.getAllCookies()</code> and the destination implements <code class="language-plaintext highlighter-rouge">.putCookie()</code>.</p>

<h4 id="clonesyncstore"><code class="language-plaintext highlighter-rouge">.cloneSync([store])</code></h4>

<p>Synchronous version of <a href="#clonestore-callbackerr-cloned"><code class="language-plaintext highlighter-rouge">.clone</code></a>, returning a new <code class="language-plaintext highlighter-rouge">CookieJar</code> instance.</p>

<p>The <code class="language-plaintext highlighter-rouge">store</code> argument is optional, but must be a <em>synchronous</em> <code class="language-plaintext highlighter-rouge">Store</code> instance if specified. If not passed, a new instance of <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> is used.</p>

<p>The <em>source</em> and <em>destination</em> must both be synchronous <code class="language-plaintext highlighter-rouge">Store</code>s. If one or both stores are asynchronous, use <code class="language-plaintext highlighter-rouge">.clone</code> instead. Recall that <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> supports both synchronous and asynchronous API calls.</p>

<h4 id="removeallcookiescallbackerr"><code class="language-plaintext highlighter-rouge">.removeAllCookies([callback(err)])</code></h4>

<p>Removes all cookies from the jar. Returns a promise if a callback is not provided.</p>

<p>This is a new backwards-compatible feature of <code class="language-plaintext highlighter-rouge">tough-cookie</code> version 2.5, so not all Stores will implement it efficiently. For Stores that do not implement <code class="language-plaintext highlighter-rouge">removeAllCookies</code>, the fallback is to call <code class="language-plaintext highlighter-rouge">removeCookie</code> after <code class="language-plaintext highlighter-rouge">getAllCookies</code>. If <code class="language-plaintext highlighter-rouge">getAllCookies</code> fails or isn’t implemented in the Store, that error is returned. If one or more of the <code class="language-plaintext highlighter-rouge">removeCookie</code> calls fail, only the first error is returned.</p>

<h4 id="removeallcookiessync"><code class="language-plaintext highlighter-rouge">.removeAllCookiesSync()</code></h4>

<p>Sync version of <a href="#removeallcookiescallbackerr"><code class="language-plaintext highlighter-rouge">.removeAllCookies()</code></a>; only works with synchronous stores (for example, the default <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code>).</p>

<h3 id="store">Store</h3>

<p>Base class for CookieJar stores. Available as <code class="language-plaintext highlighter-rouge">tough.Store</code>.</p>

<h3 id="store-api">Store API</h3>

<p>The storage model for each <code class="language-plaintext highlighter-rouge">CookieJar</code> instance can be replaced with a custom implementation. The default is <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> which can be found in <a href="https://github.com/salesforce/tough-cookie/blob/master/lib/memstore.js"><code class="language-plaintext highlighter-rouge">lib/memstore.js</code></a>. The API uses continuation-passing-style to allow for asynchronous stores.</p>

<p>Stores should inherit from the base <code class="language-plaintext highlighter-rouge">Store</code> class, which is available as a top-level export.</p>

<p>Stores are asynchronous by default, but if <code class="language-plaintext highlighter-rouge">store.synchronous</code> is set to <code class="language-plaintext highlighter-rouge">true</code>, then the <code class="language-plaintext highlighter-rouge">*Sync</code> methods of the containing <code class="language-plaintext highlighter-rouge">CookieJar</code> can be used.</p>

<p>All <code class="language-plaintext highlighter-rouge">domain</code> parameters are normalized before calling.</p>

<p>The Cookie store must have all of the following methods. Note that asynchronous implementations <strong>must</strong> support callback parameters.</p>

<h4 id="storefindcookiedomain-path-key-callbackerr-cookie"><code class="language-plaintext highlighter-rouge">store.findCookie(domain, path, key, callback(err, cookie))</code></h4>

<p>Retrieve a cookie with the given domain, path, and key (name). The RFC maintains that exactly one of these cookies should exist in a store. If the store is using versioning, this means that the latest or newest such cookie should be returned.</p>

<p>Callback takes an error and the resulting <code class="language-plaintext highlighter-rouge">Cookie</code> object. If no cookie is found then <code class="language-plaintext highlighter-rouge">null</code> MUST be passed instead (that is, not an error).</p>

<h4 id="storefindcookiesdomain-path-allowspecialusedomain-callbackerr-cookies"><code class="language-plaintext highlighter-rouge">store.findCookies(domain, path, allowSpecialUseDomain, callback(err, cookies))</code></h4>

<p>Locates cookies matching the given domain and path. This is most often called in the context of <a href="#getcookiescurrenturl-options-callbackerr-cookies"><code class="language-plaintext highlighter-rouge">cookiejar.getCookies()</code></a>.</p>

<p>If no cookies are found, the callback MUST be passed an empty array.</p>

<p>The resulting list is checked for applicability to the current request according to the RFC (domain-match, path-match, http-only-flag, secure-flag, expiry, and so on), so it’s OK to use an optimistic search algorithm when implementing this method. However, the search algorithm used SHOULD try to find cookies that <code class="language-plaintext highlighter-rouge">domainMatch()</code> the domain and <code class="language-plaintext highlighter-rouge">pathMatch()</code> the path in order to limit the amount of checking that needs to be done.</p>

<p>As of version 0.9.12, the <code class="language-plaintext highlighter-rouge">allPaths</code> option to <code class="language-plaintext highlighter-rouge">cookiejar.getCookies()</code> above causes the path here to be <code class="language-plaintext highlighter-rouge">null</code>. If the path is <code class="language-plaintext highlighter-rouge">null</code>, path-matching MUST NOT be performed (that is, domain-matching only).</p>

<h4 id="storeputcookiecookie-callbackerr"><code class="language-plaintext highlighter-rouge">store.putCookie(cookie, callback(err))</code></h4>

<p>Adds a new cookie to the store. The implementation SHOULD replace any existing cookie with the same <code class="language-plaintext highlighter-rouge">.domain</code>, <code class="language-plaintext highlighter-rouge">.path</code>, and <code class="language-plaintext highlighter-rouge">.key</code> properties. Depending on the nature of the implementation, it’s possible that between the call to <code class="language-plaintext highlighter-rouge">fetchCookie</code> and <code class="language-plaintext highlighter-rouge">putCookie</code> that a duplicate <code class="language-plaintext highlighter-rouge">putCookie</code> can occur.</p>

<p>The <code class="language-plaintext highlighter-rouge">cookie</code> object MUST NOT be modified; as the caller has already updated the <code class="language-plaintext highlighter-rouge">.creation</code> and <code class="language-plaintext highlighter-rouge">.lastAccessed</code> properties.</p>

<p>Pass an error if the cookie cannot be stored.</p>

<h4 id="storeupdatecookieoldcookie-newcookie-callbackerr"><code class="language-plaintext highlighter-rouge">store.updateCookie(oldCookie, newCookie, callback(err))</code></h4>

<p>Update an existing cookie. The implementation MUST update the <code class="language-plaintext highlighter-rouge">.value</code> for a cookie with the same <code class="language-plaintext highlighter-rouge">domain</code>, <code class="language-plaintext highlighter-rouge">.path</code>, and <code class="language-plaintext highlighter-rouge">.key</code>. The implementation SHOULD check that the old value in the store is equivalent to <code class="language-plaintext highlighter-rouge">oldCookie</code> - how the conflict is resolved is up to the store.</p>

<p>The <code class="language-plaintext highlighter-rouge">.lastAccessed</code> property is always different between the two objects (to the precision possible via JavaScript’s clock). Both <code class="language-plaintext highlighter-rouge">.creation</code> and <code class="language-plaintext highlighter-rouge">.creationIndex</code> are guaranteed to be the same. Stores MAY ignore or defer the <code class="language-plaintext highlighter-rouge">.lastAccessed</code> change at the cost of affecting how cookies are selected for automatic deletion (for example, least-recently-used, which is up to the store to implement).</p>

<p>Stores may wish to optimize changing the <code class="language-plaintext highlighter-rouge">.value</code> of the cookie in the store versus storing a new cookie. If the implementation doesn’t define this method, a stub that calls <a href="#storeputcookiecookie-callbackerr"><code class="language-plaintext highlighter-rouge">putCookie</code></a> is added to the store object.</p>

<p>The <code class="language-plaintext highlighter-rouge">newCookie</code> and <code class="language-plaintext highlighter-rouge">oldCookie</code> objects MUST NOT be modified.</p>

<p>Pass an error if the newCookie cannot be stored.</p>

<h4 id="storeremovecookiedomain-path-key-callbackerr"><code class="language-plaintext highlighter-rouge">store.removeCookie(domain, path, key, callback(err))</code></h4>

<p>Remove a cookie from the store (see notes on <a href="#storefindcookiedomain-path-key-callbackerr-cookie"><code class="language-plaintext highlighter-rouge">findCookie</code></a> about the uniqueness constraint).</p>

<p>The implementation MUST NOT pass an error if the cookie doesn’t exist, and only pass an error due to the failure to remove an existing cookie.</p>

<h4 id="storeremovecookiesdomain-path-callbackerr"><code class="language-plaintext highlighter-rouge">store.removeCookies(domain, path, callback(err))</code></h4>

<p>Removes matching cookies from the store. The <code class="language-plaintext highlighter-rouge">path</code> parameter is optional and if missing, means all paths in a domain should be removed.</p>

<p>Pass an error ONLY if removing any existing cookies failed.</p>

<h4 id="storeremoveallcookiescallbackerr"><code class="language-plaintext highlighter-rouge">store.removeAllCookies(callback(err))</code></h4>

<p><em>Optional</em>. Removes all cookies from the store.</p>

<p>Pass an error if one or more cookies can’t be removed.</p>

<h4 id="storegetallcookiescallbackerr-cookies"><code class="language-plaintext highlighter-rouge">store.getAllCookies(callback(err, cookies))</code></h4>

<p><em>Optional</em>. Produces an <code class="language-plaintext highlighter-rouge">Array</code> of all cookies during <a href="#serializecallbackerr-serializedobject"><code class="language-plaintext highlighter-rouge">jar.serialize()</code></a>. The items in the array can be true <code class="language-plaintext highlighter-rouge">Cookie</code> objects or generic <code class="language-plaintext highlighter-rouge">Object</code>s with the <a href="#serialization-format">Serialization Format</a> data structure.</p>

<p>Cookies SHOULD be returned in creation order to preserve sorting via <a href="#cookiecomparea-b"><code class="language-plaintext highlighter-rouge">compareCookie()</code></a>. For reference, <code class="language-plaintext highlighter-rouge">MemoryCookieStore</code> sorts by <code class="language-plaintext highlighter-rouge">.creationIndex</code> since it uses true <code class="language-plaintext highlighter-rouge">Cookie</code> objects internally. If you don’t return the cookies in creation order, they’ll still be sorted by creation time, but this only has a precision of 1-ms. See <code class="language-plaintext highlighter-rouge">cookieCompare</code> for more detail.</p>

<p>Pass an error if retrieval fails.</p>

<p><strong>Note</strong>: Not all Stores can implement this due to technical limitations, so it is optional.</p>

<h3 id="memorycookiestore">MemoryCookieStore</h3>

<p>Inherits from <code class="language-plaintext highlighter-rouge">Store</code>.</p>

<p>A just-in-memory CookieJar synchronous store implementation, used by default. Despite being a synchronous implementation, it’s usable with both the synchronous and asynchronous forms of the <code class="language-plaintext highlighter-rouge">CookieJar</code> API. Supports serialization, <code class="language-plaintext highlighter-rouge">getAllCookies</code>, and <code class="language-plaintext highlighter-rouge">removeAllCookies</code>.</p>

<h3 id="community-cookie-stores">Community Cookie Stores</h3>

<p>These are some Store implementations authored and maintained by the community. They aren’t official and we don’t vouch for them but you may be interested to have a look:</p>

<ul>
  <li><a href="https://github.com/JSBizon/db-cookie-store"><code class="language-plaintext highlighter-rouge">db-cookie-store</code></a>: SQL including SQLite-based databases</li>
  <li><a href="https://github.com/JSBizon/file-cookie-store"><code class="language-plaintext highlighter-rouge">file-cookie-store</code></a>: Netscape cookie file format on disk</li>
  <li><a href="https://github.com/benkroeger/redis-cookie-store"><code class="language-plaintext highlighter-rouge">redis-cookie-store</code></a>: Redis</li>
  <li><a href="https://github.com/mitsuru/tough-cookie-filestore"><code class="language-plaintext highlighter-rouge">tough-cookie-filestore</code></a>: JSON on disk</li>
  <li><a href="https://github.com/exponentjs/tough-cookie-web-storage-store"><code class="language-plaintext highlighter-rouge">tough-cookie-web-storage-store</code></a>: DOM localStorage and sessionStorage</li>
</ul>

<h2 id="serialization-format">Serialization Format</h2>

<p><strong>NOTE</strong>: If you want to have custom <code class="language-plaintext highlighter-rouge">Cookie</code> properties serialized, add the property name to <code class="language-plaintext highlighter-rouge">Cookie.serializableProperties</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">{</span>
    <span class="c1">// The version of tough-cookie that serialized this jar.</span>
    <span class="nl">version</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tough-cookie@1.x.y</span><span class="dl">'</span><span class="p">,</span>

    <span class="c1">// add the store type, to make humans happy:</span>
    <span class="nx">storeType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">MemoryCookieStore</span><span class="dl">'</span><span class="p">,</span>

    <span class="c1">// CookieJar configuration:</span>
    <span class="nx">rejectPublicSuffixes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="c1">// ... future items go here</span>

    <span class="c1">// Gets filled from jar.store.getAllCookies():</span>
    <span class="nx">cookies</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">,</span>
        <span class="c1">// ...</span>
        <span class="cm">/* other Cookie.serializableProperties go here */</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
</code></pre></div></div>

<h2 id="rfc-6265bis">RFC 6265bis</h2>

<p>Support for RFC 6265bis revision 02 is being developed. Since this is a bit of an omnibus revision to the RFC 6252, support is broken up into the functional areas.</p>

<h3 id="leave-secure-cookies-alone">Leave Secure Cookies Alone</h3>

<p>Not yet supported.</p>

<p>This change makes it so that if a cookie is sent from the server to the client with a <code class="language-plaintext highlighter-rouge">Secure</code> attribute, the channel must also be secure or the cookie is ignored.</p>

<h3 id="samesite-cookies">SameSite Cookies</h3>

<p>Supported.</p>

<p>This change makes it possible for servers, and supporting clients, to mitigate certain types of CSRF attacks by disallowing <code class="language-plaintext highlighter-rouge">SameSite</code> cookies from being sent cross-origin.</p>

<p>On the Cookie object itself, you can get or set the <code class="language-plaintext highlighter-rouge">.sameSite</code> attribute, which is serialized into the <code class="language-plaintext highlighter-rouge">SameSite=</code> cookie attribute. When unset or <code class="language-plaintext highlighter-rouge">undefined</code>, no <code class="language-plaintext highlighter-rouge">SameSite=</code> attribute is serialized. The valid values of this attribute are <code class="language-plaintext highlighter-rouge">'none'</code>, <code class="language-plaintext highlighter-rouge">'lax'</code>, or <code class="language-plaintext highlighter-rouge">'strict'</code>. Other values are serialized as-is.</p>

<p>When parsing cookies with a <code class="language-plaintext highlighter-rouge">SameSite</code> cookie attribute, values other than <code class="language-plaintext highlighter-rouge">'lax'</code> or <code class="language-plaintext highlighter-rouge">'strict'</code> are parsed as <code class="language-plaintext highlighter-rouge">'none'</code>. For example, <code class="language-plaintext highlighter-rouge">SomeCookie=SomeValue; SameSite=garbage</code> parses so that <code class="language-plaintext highlighter-rouge">cookie.sameSite === 'none'</code>.</p>

<p>In order to support SameSite cookies, you must provide a <code class="language-plaintext highlighter-rouge">sameSiteContext</code> option to <em>both</em> <code class="language-plaintext highlighter-rouge">setCookie</code> and <code class="language-plaintext highlighter-rouge">getCookies</code>. Valid values for this option are just like for the Cookie object, but have particular meanings:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">'strict'</code> mode - If the request is on the same “site for cookies” (see the RFC draft for more information), pass this option to add a layer of defense against CSRF.</li>
  <li><code class="language-plaintext highlighter-rouge">'lax'</code> mode - If the request is from another site, <em>but</em> is directly because of navigation by the user, such as, <code class="language-plaintext highlighter-rouge">&lt;link type=prefetch&gt;</code> or <code class="language-plaintext highlighter-rouge">&lt;a href="..."&gt;</code>, pass <code class="language-plaintext highlighter-rouge">sameSiteContext: 'lax'</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">'none'</code> - Otherwise, pass <code class="language-plaintext highlighter-rouge">sameSiteContext: 'none'</code> (this indicates a cross-origin request).</li>
  <li>unset/<code class="language-plaintext highlighter-rouge">undefined</code> - SameSite <strong>is not</strong> be enforced! This can be a valid use-case for when CSRF isn’t in the threat model of the system being built.</li>
</ol>

<p>It is highly recommended that you read RFC 6265bis for fine details on SameSite cookies. In particular <a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-02##section-8.8">Section 8.8</a> discusses security considerations and defense in depth.</p>

<h3 id="cookie-prefixes">Cookie Prefixes</h3>

<p>Supported.</p>

<p>Cookie prefixes are a way to indicate that a given cookie was set with a set of attributes simply by inspecting the first few characters of the cookie’s name.</p>

<p>Cookie prefixes are defined in <a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-03##section-4.1.3">Section 4.1.3 of 6265bis</a>.</p>

<p>Two prefixes are defined:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">"__Secure-" Prefix</code>: If a cookie’s name begins with a case-sensitive match for the string “__Secure-“, then the cookie was set with a “Secure” attribute.</li>
  <li><code class="language-plaintext highlighter-rouge">"__Host-" Prefix</code>: If a cookie’s name begins with a case-sensitive match for the string “__Host-“, then the cookie was set with a “Secure” attribute, a “Path” attribute with a value of “/”, and no “Domain” attribute.</li>
</ol>

<p>If <code class="language-plaintext highlighter-rouge">prefixSecurity</code> is enabled for <code class="language-plaintext highlighter-rouge">CookieJar</code>, then cookies that match the prefixes defined above but do not obey the attribute restrictions are not added.</p>

<p>You can define this functionality by passing in the <code class="language-plaintext highlighter-rouge">prefixSecurity</code> option to <code class="language-plaintext highlighter-rouge">CookieJar</code>. It can be one of 3 values:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">silent</code>: Enable cookie prefix checking but silently fail to add the cookie if conditions are not met. Default.</li>
  <li><code class="language-plaintext highlighter-rouge">strict</code>: Enable cookie prefix checking and error out if conditions are not met.</li>
  <li><code class="language-plaintext highlighter-rouge">unsafe-disabled</code>: Disable cookie prefix checking.</li>
</ol>

<p>Note that if <code class="language-plaintext highlighter-rouge">ignoreError</code> is passed in as <code class="language-plaintext highlighter-rouge">true</code> then the error is silent regardless of the <code class="language-plaintext highlighter-rouge">prefixSecurity</code> option (assuming it’s enabled).</p>

<h2 id="copyright-and-license">Copyright and License</h2>

<p>BSD-3-Clause:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Copyright (c) 2015, Salesforce.com, Inc.
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice,
 this list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice,
 this list of conditions and the following disclaimer in the documentation
 and/or other materials provided with the distribution.

 3. Neither the name of Salesforce.com nor the names of its contributors may
 be used to endorse or promote products derived from this software without
 specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 POSSIBILITY OF SUCH DAMAGE.
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
