<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>BFJ | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="BFJ" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/bfj/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/bfj/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="BFJ" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"BFJ","url":"http://localhost:4000/myportfolio.client/node_modules/bfj/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=059dd2210d8f0fb8d42af0cbb5c1b29e59b98886">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="bfj">BFJ</h1>

<p><a href="https://gitlab.com/philbooth/bfj/pipelines"><img src="https://gitlab.com/philbooth/bfj/badges/master/pipeline.svg" alt="Build status" /></a>
<a href="https://www.npmjs.com/package/bfj"><img src="https://img.shields.io/npm/v/bfj.svg" alt="Package status" /></a>
<a href="https://www.npmjs.com/package/bfj"><img src="https://img.shields.io/npm/dm/bfj.svg" alt="Downloads" /></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/npm/l/bfj.svg" alt="License" /></a></p>

<p>Big-Friendly JSON. Asynchronous streaming functions for large JSON data sets.</p>

<ul>
  <li><a href="#why-would-i-want-those">Why would I want those?</a></li>
  <li><a href="#is-it-fast">Is it fast?</a></li>
  <li><a href="#what-functions-does-it-implement">What functions does it implement?</a></li>
  <li><a href="#how-do-i-install-it">How do I install it?</a></li>
  <li><a href="#how-do-i-read-a-json-file">How do I read a JSON file?</a></li>
  <li><a href="#how-do-i-parse-a-stream-of-json">How do I parse a stream of JSON?</a></li>
  <li><a href="#how-do-i-selectively-parse-individual-items-from-a-json-stream">How do I selectively parse individual items from a JSON stream?</a></li>
  <li><a href="#how-do-i-write-a-json-file">How do I write a JSON file?</a></li>
  <li><a href="#how-do-i-create-a-stream-of-json">How do I create a stream of JSON?</a></li>
  <li><a href="#how-do-i-create-a-json-string">How do I create a JSON string?</a></li>
  <li><a href="#what-other-methods-are-there">What other methods are there?</a>
    <ul>
      <li><a href="#bfjwalk-stream-options">bfj.walk (stream, options)</a></li>
      <li><a href="#bfjeventify-data-options">bfj.eventify (data, options)</a></li>
    </ul>
  </li>
  <li><a href="#what-options-can-i-specify">What options can I specify?</a>
    <ul>
      <li><a href="#options-for-parsing-functions">Options for parsing functions</a></li>
      <li><a href="#options-for-serialisation-functions">Options for serialisation functions</a></li>
    </ul>
  </li>
  <li><a href="#is-it-possible-to-pause-parsing-or-serialisation-from-calling-code">Is it possible to pause parsing or serialisation from calling code?</a></li>
  <li><a href="#can-it-handle-newline-delimited-json-ndjson">Can it handle newline-delimited JSON (NDJSON)?</a></li>
  <li><a href="#why-does-it-default-to-bluebird-promises">Why does it default to bluebird promises?</a></li>
  <li><a href="#can-i-specify-a-different-promise-implementation">Can I specify a different promise implementation?</a></li>
  <li><a href="#is-there-a-change-log">Is there a change log?</a></li>
  <li><a href="#how-do-i-set-up-the-dev-environment">How do I set up the dev environment?</a></li>
  <li><a href="#what-versions-of-nodejs-does-it-support">What versions of Node.js does it support?</a></li>
  <li><a href="#what-license-is-it-released-under">What license is it released under?</a></li>
</ul>

<h2 id="why-would-i-want-those">Why would I want those?</h2>

<p>If you need
to parse huge JSON strings
or stringify huge JavaScript data sets,
it monopolises the event loop
and can lead to out-of-memory exceptions.
BFJ implements asynchronous functions
and uses pre-allocated fixed-length arrays
to try and alleviate those issues.</p>

<h2 id="is-it-fast">Is it fast?</h2>

<p>No.</p>

<p>BFJ yields frequently
to avoid monopolising the event loop,
interrupting its own execution
to let other event handlers run.
The frequency of those yields
can be controlled with the <a href="#what-options-can-i-specify"><code class="language-plaintext highlighter-rouge">yieldRate</code> option</a>,
but fundamentally it is not designed for speed.</p>

<p>Furthermore,
when serialising data to a stream,
BFJ uses a fixed-length buffer
to avoid exhausting available memory.
Whenever that buffer is full,
serialisation is paused
until the receiving stream processes some more data,
regardless of the value of <code class="language-plaintext highlighter-rouge">yieldRate</code>.
You can control the size of the buffer
using the <a href="#options-for-serialisation-functions"><code class="language-plaintext highlighter-rouge">bufferLength</code> option</a>
but really,
if you need quick results,
BFJ is not for you.</p>

<h2 id="what-functions-does-it-implement">What functions does it implement?</h2>

<p>Nine functions
are exported.</p>

<p>Five are
concerned with
parsing, or
turning JSON strings
into JavaScript data:</p>

<ul>
  <li>
    <p><a href="#how-do-i-read-a-json-file"><code class="language-plaintext highlighter-rouge">read</code></a>
asynchronously parses
a JSON file from disk.</p>
  </li>
  <li>
    <p><a href="#how-do-i-parse-a-stream-of-json"><code class="language-plaintext highlighter-rouge">parse</code> and <code class="language-plaintext highlighter-rouge">unpipe</code></a>
are for asynchronously parsing
streams of JSON.</p>
  </li>
  <li>
    <p><a href="#how-do-i-selectively-parse-individual-items-from-a-json-stream"><code class="language-plaintext highlighter-rouge">match</code></a>
selectively parses individual items
from a JSON stream.</p>
  </li>
  <li>
    <p><a href="#bfjwalk-stream-options"><code class="language-plaintext highlighter-rouge">walk</code></a>
asynchronously walks
a stream,
emitting events
as it encounters
JSON tokens.
Analagous to a
<a href="http://en.wikipedia.org/wiki/Simple_API_for_XML">SAX parser</a>.</p>
  </li>
</ul>

<p>The other four functions
handle the reverse transformations,
serialising
JavaScript data
to JSON:</p>

<ul>
  <li>
    <p><a href="#how-do-i-write-a-json-file"><code class="language-plaintext highlighter-rouge">write</code></a>
asynchronously serialises data
to a JSON file on disk.</p>
  </li>
  <li>
    <p><a href="#how-do-i-create-a-stream-of-json"><code class="language-plaintext highlighter-rouge">streamify</code></a>
asynchronously serialises data
to a stream of JSON.</p>
  </li>
  <li>
    <p><a href="#how-do-i-create-a-json-string"><code class="language-plaintext highlighter-rouge">stringify</code></a>
asynchronously serialises data
to a JSON string.</p>
  </li>
  <li>
    <p><a href="#bfjeventify-data-options"><code class="language-plaintext highlighter-rouge">eventify</code></a>
asynchronously traverses
a data structure
depth-first,
emitting events
as it encounters items.
By default
it coerces
promises, buffers and iterables
to JSON-friendly values.</p>
  </li>
</ul>

<h2 id="how-do-i-install-it">How do I install it?</h2>

<p>If you’re using npm:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i bfj --save
</code></pre></div></div>

<p>Or if you just want
the git repo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@gitlab.com:philbooth/bfj.git
</code></pre></div></div>

<h2 id="how-do-i-read-a-json-file">How do I read a JSON file?</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">bfj</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">read</code> returns a <a href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a> and
asynchronously parses
a JSON file
from disk.</p>

<p>It takes two arguments;
the path to the JSON file
and an <a href="#options-for-parsing-functions">options</a> object.</p>

<p>If there are
no syntax errors,
the returned promise is resolved
with the parsed data.
If syntax errors occur,
the promise is rejected
with the first error.</p>

<h2 id="how-do-i-parse-a-stream-of-json">How do I parse a stream of JSON?</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// By passing a readable stream to bfj.parse():</span>
<span class="nx">bfj</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>

<span class="c1">// ...or by passing the result from bfj.unpipe() to stream.pipe():</span>
<span class="nx">request</span><span class="p">({</span> <span class="nx">url</span> <span class="p">}).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">unpipe</span><span class="p">((</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">}</span>
<span class="p">}))</span>
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">parse</code> returns a <a href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a>
and asynchronously parses
a stream of JSON data.</p>

    <p>It takes two arguments;
a <a href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
from which
the JSON
will be parsed
and an <a href="#options-for-parsing-functions">options</a> object.</p>

    <p>If there are
no syntax errors,
the returned promise is resolved
with the parsed data.
If syntax errors occur,
the promise is rejected
with the first error.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">unpipe</code> returns a <a href="https://nodejs.org/api/stream.html#stream_writable_streams">writable stream</a>
that can be passed to <a href="https://nodejs.org/api/stream.html#stream_readable_pipe_destination_options"><code class="language-plaintext highlighter-rouge">stream.pipe</code></a>,
then parses JSON data
read from the stream.</p>

    <p>It takes two arguments;
a callback function
that will be called
after parsing is complete
and an <a href="#options-for-parsing-functions">options</a> object.</p>

    <p>If there are no errors,
the callback is invoked
with the result as the second argument.
If errors occur,
the first error is passed
the callback
as the first argument.</p>
  </li>
</ul>

<h2 id="how-do-i-selectively-parse-individual-items-from-a-json-stream">How do I selectively parse individual items from a JSON stream?</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Call match with your stream and a selector predicate/regex/JSONPath/string</span>
<span class="kd">const</span> <span class="nx">dataStream</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">jsonStream</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="c1">// Get data out of the returned stream with event handlers</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="nx">item</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">dataError</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>

<span class="c1">// ...or you can pipe it to another stream</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">someOtherStream</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">match</code> returns a readable, object-mode stream
and asynchronously parses individual matching items
from an input JSON stream.</p>

<p>It takes three arguments:
a <a href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
from which the JSON will be parsed;
a selector argument for determining matches,
which may be a string, a regular expression, a JSONPath expression, or a predicate function;
and an <a href="#options-for-parsing-functions">options</a> object.</p>

<p>If the selector is a string,
it will be compared to property keys
to determine whether
each item in the data is a match.
If it is a regular expression,
the comparison will be made
by calling the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test">RegExp <code class="language-plaintext highlighter-rouge">test</code> method</a>
with the property key.
If it is a JSONPath expression,
it must start with <code class="language-plaintext highlighter-rouge">$.</code> to identify the root node
and only use <code class="language-plaintext highlighter-rouge">child</code> scope expressions for subsequent nodes.
Predicate functions will be called with three arguments:
<code class="language-plaintext highlighter-rouge">key</code>, <code class="language-plaintext highlighter-rouge">value</code> and <code class="language-plaintext highlighter-rouge">depth</code>.
If the result of the predicate is a truthy value
then the item will be deemed a match.</p>

<p>In addition to the regular options
accepted by other parsing functions,
you can also specify <code class="language-plaintext highlighter-rouge">minDepth</code>
to only apply the selector
to certain depths.
This can improve performance
and memory usage,
if you know that
you’re not interested in
parsing top-level items.</p>

<p>If there are any syntax errors in the JSON,
a <code class="language-plaintext highlighter-rouge">dataError</code> event will be emitted.
If any other errors occur,
an <code class="language-plaintext highlighter-rouge">error</code> event will be emitted.</p>

<h2 id="how-do-i-write-a-json-file">How do I write a JSON file?</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">bfj</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">write</code> returns a <a href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a>
and asynchronously serialises a data structure
to a JSON file on disk.
The promise is resolved
when the file has been written,
or rejected with the error
if writing failed.</p>

<p>It takes three arguments;
the path to the JSON file,
the data structure to serialise
and an <a href="#options-for-serialisation-functions">options</a> object.</p>

<h2 id="how-do-i-create-a-stream-of-json">How do I create a stream of JSON?</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">streamify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="c1">// Get data out of the stream with event handlers</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="nx">chunk</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">dataError</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>

<span class="c1">// ...or you can pipe it to another stream</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">someOtherStream</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">streamify</code> returns a <a href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
and asynchronously serialises
a data structure to JSON,
pushing the result
to the returned stream.</p>

<p>It takes two arguments;
the data structure to serialise
and an <a href="#options-for-serialisation-functions">options</a> object.</p>

<p>If there a circular reference is encountered in the data
and <code class="language-plaintext highlighter-rouge">options.circular</code> is not set to <code class="language-plaintext highlighter-rouge">'ignore'</code>,
a <code class="language-plaintext highlighter-rouge">dataError</code> event will be emitted.
If any other errors occur,
an <code class="language-plaintext highlighter-rouge">error</code> event will be emitted.</p>

<h2 id="how-do-i-create-a-json-string">How do I create a JSON string?</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">bfj</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">stringify</code> returns a <a href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a> and
asynchronously serialises a data structure
to a JSON string.
The promise is resolved
to the JSON string
when serialisation is complete.</p>

<p>It takes two arguments;
the data structure to serialise
and an <a href="#options-for-serialisation-functions">options</a> object.</p>

<h2 id="what-other-methods-are-there">What other methods are there?</h2>

<h3 id="bfjwalk-stream-options">bfj.walk (stream, options)</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">walk</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">array</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">property</span><span class="p">,</span> <span class="nx">name</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">literal</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endArray</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endObject</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">dataError</span><span class="p">,</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">walk</code> returns an <a href="https://nodejs.org/api/events.html#events_class_eventemitter">event emitter</a>
and asynchronously walks
a stream of JSON data,
emitting events
as it encounters
tokens.</p>

<p>It takes two arguments;
a <a href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
from which
the JSON
will be read
and an <a href="#options-for-parsing-functions">options</a> object.</p>

<p>The emitted events
are defined
as public properties
of an object,
<code class="language-plaintext highlighter-rouge">bfj.events</code>:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.array</code>
indicates that
an array context
has been entered
by encountering
the <code class="language-plaintext highlighter-rouge">[</code> character.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.endArray</code>
indicates that
an array context
has been left
by encountering
the <code class="language-plaintext highlighter-rouge">]</code> character.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.object</code>
indicates that
an object context
has been entered
by encountering
the <code class="language-plaintext highlighter-rouge">{</code> character.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.endObject</code>
indicates that
an object context
has been left
by encountering
the <code class="language-plaintext highlighter-rouge">}</code> character.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.property</code>
indicates that
a property
has been encountered
in an object.
The listener
will be passed
the name of the property
as its argument
and the next event
to be emitted
will represent
the property’s value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.string</code>
indicates that
a string
has been encountered.
The listener
will be passed
the value
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.number</code>
indicates that
a number
has been encountered.
The listener
will be passed
the value
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.literal</code>
indicates that
a JSON literal
(either <code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">false</code> or <code class="language-plaintext highlighter-rouge">null</code>)
has been encountered.
The listener
will be passed
the value
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.error</code>
indicates that
an error was caught
from one of the event handlers
in user code.
The listener
will be passed
the <code class="language-plaintext highlighter-rouge">Error</code> instance
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.dataError</code>
indicates that
a syntax error was encountered
in the incoming JSON stream.
The listener
will be passed
an <code class="language-plaintext highlighter-rouge">Error</code> instance
decorated with <code class="language-plaintext highlighter-rouge">actual</code>, <code class="language-plaintext highlighter-rouge">expected</code>, <code class="language-plaintext highlighter-rouge">lineNumber</code> and <code class="language-plaintext highlighter-rouge">columnNumber</code> properties
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.end</code>
indicates that
the end of the input
has been reached
and the stream is closed.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.endLine</code>
indicates that a root-level newline character
has been encountered in an <a href="#can-it-handle-newline-delimited-json-ndjson">NDJSON</a> stream.
Only emitted if the <code class="language-plaintext highlighter-rouge">ndjson</code> <a href="#options-for-parsing-functions">option</a> is set.</p>
  </li>
</ul>

<p>If you are using <code class="language-plaintext highlighter-rouge">bfj.walk</code>
to sequentially parse items in an array,
you might also be interested in
the <a href="https://github.com/hash-bang/bfj-collections">bfj-collections</a> module.</p>

<h3 id="bfjeventify-data-options">bfj.eventify (data, options)</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">eventify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">array</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">property</span><span class="p">,</span> <span class="nx">name</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">literal</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endArray</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endObject</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">dataError</span><span class="p">,</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">eventify</code> returns an <a href="https://nodejs.org/api/events.html#events_class_eventemitter">event emitter</a>
and asynchronously traverses
a data structure depth-first,
emitting events as it
encounters items.
By default it coerces
promises, buffers and iterables
to JSON-friendly values.</p>

<p>It takes two arguments;
the data structure to traverse
and an <a href="#options-for-serialisation-functions">options</a> object.</p>

<p>The emitted events
are defined
as public properties
of an object,
<code class="language-plaintext highlighter-rouge">bfj.events</code>:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.array</code>
indicates that
an array
has been encountered.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.endArray</code>
indicates that
the end of an array
has been encountered.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.object</code>
indicates that
an object
has been encountered.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.endObject</code>
indicates that
the end of an object
has been encountered.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.property</code>
indicates that
a property
has been encountered
in an object.
The listener
will be passed
the name of the property
as its argument
and the next event
to be emitted
will represent
the property’s value.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.string</code>
indicates that
a string
has been encountered.
The listener
will be passed
the value
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.number</code>
indicates that
a number
has been encountered.
The listener
will be passed
the value
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.literal</code>
indicates that
a JSON literal
(either <code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">false</code> or <code class="language-plaintext highlighter-rouge">null</code>)
has been encountered.
The listener
will be passed
the value
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.error</code>
indicates that
an error was caught
from one of the event handlers
in user code.
The listener
will be passed
the <code class="language-plaintext highlighter-rouge">Error</code> instance
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.dataError</code>
indicates that
a circular reference was encountered in the data
and the <code class="language-plaintext highlighter-rouge">circular</code> option was not set to <code class="language-plaintext highlighter-rouge">'ignore'</code>.
The listener
will be passed
an <code class="language-plaintext highlighter-rouge">Error</code> instance
as its argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.events.end</code>
indicates that
the end of the data
has been reached and
no further events
will be emitted.</p>
  </li>
</ul>

<h2 id="what-options-can-i-specify">What options can I specify?</h2>

<h3 id="options-for-parsing-functions">Options for parsing functions</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.reviver</code>:
Transformation function,
invoked depth-first
against the parsed
data structure.
This option
is analagous to the
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Using_the_reviver_parameter">reviver parameter for JSON.parse</a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.yieldRate</code>:
The number of data items to process
before yielding to the event loop.
Smaller values yield to the event loop more frequently,
meaning less time will be consumed by bfj per tick
but the overall parsing time will be slower.
Larger values yield to the event loop less often,
meaning slower tick times but faster overall parsing time.
The default value is <code class="language-plaintext highlighter-rouge">16384</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.Promise</code>:
Promise constructor that will be used
for promises returned by all methods.
If you set this option,
please be aware that some promise implementations
(including native promises)
may cause your process to die
with out-of-memory exceptions.
Defaults to <a href="http://bluebirdjs.com/docs/api-reference.html">bluebird’s implementation</a>,
which does not have that problem.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.ndjson</code>:
If set to <code class="language-plaintext highlighter-rouge">true</code>,
newline characters at the root level
will be treated as delimiters between
discrete chunks of JSON.
See <a href="#can-it-handle-newline-delimited-json-ndjson">NDJSON</a> for more information.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.numbers</code>:
For <code class="language-plaintext highlighter-rouge">bfj.match</code> only,
set this to <code class="language-plaintext highlighter-rouge">true</code>
if you wish to match against numbers
with a string or regular expression
<code class="language-plaintext highlighter-rouge">selector</code> argument.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.bufferLength</code>:
For <code class="language-plaintext highlighter-rouge">bfj.match</code> only,
the length of the match buffer.
Smaller values use less memory
but may result in a slower parse time.
The default value is <code class="language-plaintext highlighter-rouge">1024</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.highWaterMark</code>:
For <code class="language-plaintext highlighter-rouge">bfj.match</code> only,
set this if you would like to
pass a value for the <code class="language-plaintext highlighter-rouge">highWaterMark</code> option
to the readable stream constructor.</p>
  </li>
</ul>

<h3 id="options-for-serialisation-functions">Options for serialisation functions</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.space</code>:
Indentation string
or the number of spaces
to indent
each nested level by.
This option
is analagous to the
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_space_argument">space parameter for JSON.stringify</a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.promises</code>:
By default,
promises are coerced
to their resolved value.
Set this property
to <code class="language-plaintext highlighter-rouge">'ignore'</code>
for improved performance
if you don’t need
to coerce promises.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.buffers</code>:
By default,
buffers are coerced
using their <code class="language-plaintext highlighter-rouge">toString</code> method.
Set this property
to <code class="language-plaintext highlighter-rouge">'ignore'</code>
for improved performance
if you don’t need
to coerce buffers.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.maps</code>:
By default,
maps are coerced
to plain objects.
Set this property
to <code class="language-plaintext highlighter-rouge">'ignore'</code>
for improved performance
if you don’t need
to coerce maps.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.iterables</code>:
By default,
other iterables
(i.e. not arrays, strings or maps)
are coerced
to arrays.
Set this property
to <code class="language-plaintext highlighter-rouge">'ignore'</code>
for improved performance
if you don’t need
to coerce iterables.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.circular</code>:
By default,
circular references
will cause the write
to fail.
Set this property
to <code class="language-plaintext highlighter-rouge">'ignore'</code>
if you’d prefer
to silently skip past
circular references
in the data.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.bufferLength</code>:
The length of the write buffer.
Smaller values use less memory
but may result in a slower serialisation time.
The default value is <code class="language-plaintext highlighter-rouge">1024</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.highWaterMark</code>:
Set this if you would like to
pass a value for the <code class="language-plaintext highlighter-rouge">highWaterMark</code> option
to the readable stream constructor.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.yieldRate</code>:
The number of data items to process
before yielding to the event loop.
Smaller values yield to the event loop more frequently,
meaning less time will be consumed by bfj per tick
but the overall serialisation time will be slower.
Larger values yield to the event loop less often,
meaning slower tick times but faster overall serialisation time.
The default value is <code class="language-plaintext highlighter-rouge">16384</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">options.Promise</code>:
Promise constructor that will be used
for promises returned by all methods.
If you set this option,
please be aware that some promise implementations
(including native promises)
may cause your process to die
with out-of-memory exceptions.
Defaults to <a href="http://bluebirdjs.com/docs/api-reference.html">bluebird’s implementation</a>,
which does not have that problem.</p>
  </li>
</ul>

<h2 id="is-it-possible-to-pause-parsing-or-serialisation-from-calling-code">Is it possible to pause parsing or serialisation from calling code?</h2>

<p>Yes it is!
Both <a href="#bfjwalk-stream-options"><code class="language-plaintext highlighter-rouge">walk</code></a>
and <a href="#bfjeventify-data-options"><code class="language-plaintext highlighter-rouge">eventify</code></a>
decorate their returned event emitters
with a <code class="language-plaintext highlighter-rouge">pause</code> method
that will prevent any further events being emitted.
The <code class="language-plaintext highlighter-rouge">pause</code> method itself
returns a <code class="language-plaintext highlighter-rouge">resume</code> function
that you can call to indicate
that processing should continue.</p>

<p>For example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">bfj</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">walk</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span> <span class="nx">options</span><span class="p">);</span>

<span class="c1">// Later, when you want to pause parsing:</span>

<span class="kd">const</span> <span class="nx">resume</span> <span class="o">=</span> <span class="nx">emitter</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>

<span class="c1">// Then when you want to resume:</span>

<span class="nx">resume</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="can-it-handle-newline-delimited-json-ndjson">Can it handle <a href="http://ndjson.org/">newline-delimited JSON (NDJSON)</a>?</h2>

<p>Yes.
If you pass the <code class="language-plaintext highlighter-rouge">ndjson</code> <a href="#options-for-parsing-functions">option</a>
to <code class="language-plaintext highlighter-rouge">bfj.walk</code>, <code class="language-plaintext highlighter-rouge">bfj.match</code> or <code class="language-plaintext highlighter-rouge">bfj.parse</code>,
newline characters at the root level
will act as delimiters between
discrete JSON values:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.walk</code> will emit a <code class="language-plaintext highlighter-rouge">bfj.events.endLine</code> event
each time it encounters a newline character.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.match</code> will just ignore the newlines
while it continues looking for matching items.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bfj.parse</code> will resolve with the first value
and pause the underlying stream.
If it’s called again with the same stream,
it will resume processing
and resolve with the second value.
To parse the entire stream,
calls should be made sequentially one-at-a-time
until the returned promise
resolves to <code class="language-plaintext highlighter-rouge">undefined</code>
(<code class="language-plaintext highlighter-rouge">undefined</code> is not a valid JSON token).</p>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">bfj.unpipe</code> and <code class="language-plaintext highlighter-rouge">bfj.read</code> will not parse NDJSON.</p>

<h2 id="why-does-it-default-to-bluebird-promises">Why does it default to bluebird promises?</h2>

<p>Until version <code class="language-plaintext highlighter-rouge">4.2.4</code>,
native promises were used.
But they were found
to cause out-of-memory errors
when serialising large amounts of data to JSON,
due to <a href="https://alexn.org/blog/2017/10/11/javascript-promise-leaks-memory.html">well-documented problems
with the native promise implementation</a>.
So in version <code class="language-plaintext highlighter-rouge">5.0.0</code>,
bluebird promises were used instead.
In version <code class="language-plaintext highlighter-rouge">5.1.0</code>,
an option was added
that enables callers to specify
the promise constructor to use.
Use it at your own risk.</p>

<h2 id="can-i-specify-a-different-promise-implementation">Can I specify a different promise implementation?</h2>

<p>Yes.
Just pass the <code class="language-plaintext highlighter-rouge">Promise</code> option
to any method.
If you get out-of-memory errors
when using that option,
consider changing your promise implementation.</p>

<h2 id="is-there-a-change-log">Is there a change log?</h2>

<p><a href="/myportfolio.client/node_modules/bfj/HISTORY.html">Yes</a>.</p>

<h2 id="how-do-i-set-up-the-dev-environment">How do I set up the dev environment?</h2>

<p>The development environment
relies on <a href="https://nodejs.org/en/">Node.js</a>,
<a href="http://eslint.org/">ESLint</a>,
<a href="https://mochajs.org/">Mocha</a>,
<a href="http://chaijs.com/">Chai</a>,
<a href="https://github.com/thlorenz/proxyquire">Proxyquire</a> and
<a href="https://gitlab.com/philbooth/spooks.js">Spooks</a>.
Assuming that
you already have
node and NPM
set up,
you just need
to run
<code class="language-plaintext highlighter-rouge">npm install</code>
to install
all of the dependencies
as listed in <code class="language-plaintext highlighter-rouge">package.json</code>.</p>

<p>You can
lint the code
with the command
<code class="language-plaintext highlighter-rouge">npm run lint</code>.</p>

<p>You can
run the tests
with the command
<code class="language-plaintext highlighter-rouge">npm test</code>.</p>

<h2 id="what-versions-of-nodejs-does-it-support">What versions of Node.js does it support?</h2>

<p>As of <a href="/myportfolio.client/node_modules/bfj/HISTORY.html#700">version <code class="language-plaintext highlighter-rouge">7.0.0</code></a>,
only Node.js versions 8 or greater
are supported.</p>

<p>Between versions <a href="/myportfolio.client/node_modules/bfj/HISTORY.html#300"><code class="language-plaintext highlighter-rouge">3.0.0</code></a>
and <a href="/myportfolio.client/node_modules/bfj/HISTORY.html#612"><code class="language-plaintext highlighter-rouge">6.1.2</code></a>,
only Node.js versions 6 or greater
were supported.</p>

<p>Until <a href="/myportfolio.client/node_modules/bfj/HISTORY.html#212">version <code class="language-plaintext highlighter-rouge">2.1.2</code></a>,
only Node.js versions 4 or greater
were supported.</p>

<h2 id="what-license-is-it-released-under">What license is it released under?</h2>

<p><a href="/myportfolio.client/node_modules/bfj/COPYING">MIT</a>.</p>



      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
