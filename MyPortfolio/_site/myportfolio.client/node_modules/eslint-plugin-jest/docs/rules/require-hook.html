<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Require setup and teardown code to be within a hook (require-hook) | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Require setup and teardown code to be within a hook (require-hook)" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/eslint-plugin-jest/docs/rules/require-hook.html" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/eslint-plugin-jest/docs/rules/require-hook.html" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Require setup and teardown code to be within a hook (require-hook)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Require setup and teardown code to be within a hook (require-hook)","url":"http://localhost:4000/myportfolio.client/node_modules/eslint-plugin-jest/docs/rules/require-hook.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=059dd2210d8f0fb8d42af0cbb5c1b29e59b98886">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="require-setup-and-teardown-code-to-be-within-a-hook-require-hook">Require setup and teardown code to be within a hook (<code class="language-plaintext highlighter-rouge">require-hook</code>)</h1>

<p>Often while writing tests you have some setup work that needs to happen before
tests run, and you have some finishing work that needs to happen after tests
run. Jest provides helper functions to handle this.</p>

<p>It’s common when writing tests to need to perform setup work that needs to
happen before tests run, and finishing work after tests run.</p>

<p>Because Jest executes all <code class="language-plaintext highlighter-rouge">describe</code> handlers in a test file <em>before</em> it
executes any of the actual tests, it’s important to ensure setup and teardown
work is done inside <code class="language-plaintext highlighter-rouge">before*</code> and <code class="language-plaintext highlighter-rouge">after*</code> handlers respectively, rather than
inside the <code class="language-plaintext highlighter-rouge">describe</code> blocks.</p>

<h2 id="rule-details">Rule details</h2>

<p>This rule flags any expression that is either at the toplevel of a test file or
directly within the body of a <code class="language-plaintext highlighter-rouge">describe</code>, <em>except</em> for the following:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">import</code> statements</li>
  <li><code class="language-plaintext highlighter-rouge">const</code> variables</li>
  <li><code class="language-plaintext highlighter-rouge">let</code> <em>declarations</em>, and initializations to <code class="language-plaintext highlighter-rouge">null</code> or <code class="language-plaintext highlighter-rouge">undefined</code></li>
  <li>Classes</li>
  <li>Types</li>
  <li>Calls to the standard Jest globals</li>
</ul>

<p>This rule flags any function calls within test files that are directly within
the body of a <code class="language-plaintext highlighter-rouge">describe</code>, and suggests wrapping them in one of the four
lifecycle hooks.</p>

<p>Here is a slightly contrived test file showcasing some common cases that would
be flagged:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">database</span><span class="p">,</span> <span class="nx">isCity</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../database</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Logger</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../src/Logger</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">loadCities</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../api</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">../api</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">initializeCityDatabase</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">addCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">Vienna</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">addCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">San Juan</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">addCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">Wellington</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">clearCityDatabase</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">initializeCityDatabase</span><span class="p">();</span>

<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">that persists cities</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">database</span><span class="p">.</span><span class="nx">cities</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">city database has Vienna</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">isCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">Vienna</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">city database has San Juan</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">isCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">San Juan</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">when loading cities from the api</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">consoleWarnSpy</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">);</span>

  <span class="nx">loadCities</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">([</span><span class="dl">'</span><span class="s1">Wellington</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">London</span><span class="dl">'</span><span class="p">]);</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">does not duplicate cities</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="nx">loadCities</span><span class="p">();</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">database</span><span class="p">.</span><span class="nx">cities</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">logs any duplicates</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="nx">loadCities</span><span class="p">();</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">consoleWarnSpy</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">Ignored duplicate cities: Wellington</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">clearCityDatabase</span><span class="p">();</span>
</code></pre></div></div>

<p>Here is the same slightly contrived test file showcasing the same common cases
but in ways that would be <strong>not</strong> flagged:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">database</span><span class="p">,</span> <span class="nx">isCity</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../database</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Logger</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../src/Logger</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">loadCities</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../api</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">../api</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">initializeCityDatabase</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">addCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">Vienna</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">addCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">San Juan</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">addCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">Wellington</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">clearCityDatabase</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">initializeCityDatabase</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">that persists cities</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">database</span><span class="p">.</span><span class="nx">cities</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">city database has Vienna</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">isCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">Vienna</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">city database has San Juan</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">isCity</span><span class="p">(</span><span class="dl">'</span><span class="s1">San Juan</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">when loading cities from the api</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">consoleWarnSpy</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">consoleWarnSpy</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">loadCities</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">([</span><span class="dl">'</span><span class="s1">Wellington</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">London</span><span class="dl">'</span><span class="p">]);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">does not duplicate cities</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="nx">loadCities</span><span class="p">();</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">database</span><span class="p">.</span><span class="nx">cities</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">logs any duplicates</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="nx">loadCities</span><span class="p">();</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">consoleWarnSpy</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">Ignored duplicate cities: Wellington</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">afterEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clearCityDatabase</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="options">Options</h2>

<p>If there are methods that you want to call outside of hooks and tests, you can
mark them as allowed using the <code class="language-plaintext highlighter-rouge">allowedFunctionCalls</code> option.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"jest/require-hook"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"allowedFunctionCalls"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"enableAutoDestroy"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Examples of <strong>correct</strong> code when using
<code class="language-plaintext highlighter-rouge">{ "allowedFunctionCalls": ["enableAutoDestroy"] }</code> option:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* eslint jest/require-hook: ["error", { "allowedFunctionCalls": ["enableAutoDestroy"] }] */</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">enableAutoDestroy</span><span class="p">,</span> <span class="nx">mount</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@vue/test-utils</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">initDatabase</span><span class="p">,</span> <span class="nx">tearDownDatabase</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./databaseUtils</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">enableAutoDestroy</span><span class="p">(</span><span class="nx">afterEach</span><span class="p">);</span>

<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">initDatabase</span><span class="p">);</span>
<span class="nx">afterEach</span><span class="p">(</span><span class="nx">tearDownDatabase</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Foo</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">always returns 42</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nb">global</span><span class="p">.</span><span class="nx">getAnswer</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
