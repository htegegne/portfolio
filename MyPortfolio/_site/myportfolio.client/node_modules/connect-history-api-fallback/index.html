<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="portfolio" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/connect-history-api-fallback/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/connect-history-api-fallback/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="portfolio" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"portfolio","url":"http://localhost:4000/myportfolio.client/node_modules/connect-history-api-fallback/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=00c08f3bd19ad2390c706d50e4f8968f8b47944c">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 align="center">connect-history-api-fallback</h1>
<p align="center">Middleware to proxy requests through a specified index page, useful for Single Page Applications that utilise the HTML5 History API.</p>

<h2>Table of Contents</h2>

<!-- TOC depthFrom:2 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#usage">Usage</a></li>
  <li><a href="#options">Options</a>
    <ul>
      <li><a href="#index">index</a></li>
      <li><a href="#rewrites">rewrites</a></li>
      <li><a href="#verbose">verbose</a></li>
      <li><a href="#htmlacceptheaders">htmlAcceptHeaders</a></li>
      <li><a href="#disabledotrule">disableDotRule</a></li>
    </ul>
  </li>
</ul>

<!-- /TOC -->

<h2 id="introduction">Introduction</h2>

<p>Single Page Applications (SPA) typically only utilise one index file that is
accessible by web browsers: usually <code class="language-plaintext highlighter-rouge">index.html</code>. Navigation in the application
is then commonly handled using JavaScript with the help of the
<a href="http://www.w3.org/html/wg/drafts/html/master/single-page.html#the-history-interface">HTML5 History API</a>.
This results in issues when the user hits the refresh button or is directly
accessing a page other than the landing page, e.g. <code class="language-plaintext highlighter-rouge">/help</code> or <code class="language-plaintext highlighter-rouge">/help/online</code>
as the web server bypasses the index file to locate the file at this location.
As your application is a SPA, the web server will fail trying to retrieve the file and return a <em>404 - Not Found</em>
message to the user.</p>

<p>This tiny middleware addresses some of the issues. Specifically, it will change
the requested location to the index you specify (default being <code class="language-plaintext highlighter-rouge">/index.html</code>)
whenever there is a request which fulfills the following criteria:</p>

<ol>
  <li>The request is a <code class="language-plaintext highlighter-rouge">GET</code> or <code class="language-plaintext highlighter-rouge">HEAD</code> request</li>
  <li>which accepts <code class="language-plaintext highlighter-rouge">text/html</code>,</li>
  <li>is not a direct file request, i.e. the requested path does not contain a
<code class="language-plaintext highlighter-rouge">.</code> (DOT) character and</li>
  <li>does not match a pattern provided in options.rewrites (see options below)</li>
</ol>

<h2 id="usage">Usage</h2>

<p>The middleware is available through NPM and can easily be added.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install --save connect-history-api-fallback
</code></pre></div></div>

<p>Import the library</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect-history-api-fallback</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>Now you only need to add the middleware to your application like so</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">history</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div></div>

<p>Of course you can also use this piece of middleware with express:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">history</span><span class="p">());</span>
</code></pre></div></div>

<h2 id="options">Options</h2>
<p>You can optionally pass options to the library when obtaining the middleware</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">middleware</span> <span class="o">=</span> <span class="nx">history</span><span class="p">({});</span>
</code></pre></div></div>

<h3 id="index">index</h3>
<p>Override the index (default <code class="language-plaintext highlighter-rouge">/index.html</code>). This is the request path that will be used when the middleware identifies that the request path needs to be rewritten.</p>

<p>This is not the path to a file on disk. Instead it is the HTTP request path. Downstream connect/express middleware is responsible to turn this rewritten HTTP request path into actual responses, e.g. by reading a file from disk.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/default.html</span><span class="dl">'</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="rewrites">rewrites</h3>
<p>Override the index when the request url matches a regex pattern. You can either rewrite to a static string or use a function to transform the incoming request.</p>

<p>The following will rewrite a request that matches the <code class="language-plaintext highlighter-rouge">/\/soccer/</code> pattern to <code class="language-plaintext highlighter-rouge">/soccer.html</code>.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span><span class="p">({</span>
  <span class="na">rewrites</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="sr">/</span><span class="se">\/</span><span class="sr">soccer/</span><span class="p">,</span> <span class="na">to</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/soccer.html</span><span class="dl">'</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Alternatively functions can be used to have more control over the rewrite process. For instance, the following listing shows how requests to <code class="language-plaintext highlighter-rouge">/libs/jquery/jquery.1.12.0.min.js</code> and the like can be routed to <code class="language-plaintext highlighter-rouge">./bower_components/libs/jquery/jquery.1.12.0.min.js</code>. You can also make use of this if you have an API version in the URL path.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span><span class="p">({</span>
  <span class="na">rewrites</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">from</span><span class="p">:</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">libs</span><span class="se">\/</span><span class="sr">.*$/</span><span class="p">,</span>
      <span class="na">to</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="dl">'</span><span class="s1">/bower_components</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">parsedUrl</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">});</span>
</code></pre></div></div>

<p>The function will always be called with a context object that has the following properties:</p>

<ul>
  <li><strong>parsedUrl</strong>: Information about the URL as provided by the <a href="https://nodejs.org/api/url.html#url_url_parse_urlstr_parsequerystring_slashesdenotehost">URL module’s</a> <code class="language-plaintext highlighter-rouge">url.parse</code>.</li>
  <li><strong>match</strong>: An Array of matched results as provided by <code class="language-plaintext highlighter-rouge">String.match(...)</code>.</li>
  <li><strong>request</strong>: The HTTP request object.</li>
</ul>

<h3 id="verbose">verbose</h3>
<p>This middleware does not log any information by default. If you wish to activate logging, then you can do so via the <code class="language-plaintext highlighter-rouge">verbose</code> option or by specifying a logger function.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span><span class="p">({</span>
  <span class="na">verbose</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Alternatively use your own logger</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span><span class="p">({</span>
  <span class="na">logger</span><span class="p">:</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="htmlacceptheaders">htmlAcceptHeaders</h3>
<p>Override the default <code class="language-plaintext highlighter-rouge">Accepts:</code> headers that are queried when matching HTML content requests (Default: <code class="language-plaintext highlighter-rouge">['text/html', '*/*']</code>).</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span><span class="p">({</span>
  <span class="na">htmlAcceptHeaders</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">application/xhtml+xml</span><span class="dl">'</span><span class="p">]</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="disabledotrule">disableDotRule</h3>
<p>Disables the dot rule mentioned above:</p>

<blockquote>
  <p>[…] is not a direct file request, i.e. the requested path does not contain a <code class="language-plaintext highlighter-rouge">.</code> (DOT) character […]</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span><span class="p">({</span>
  <span class="na">disableDotRule</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
