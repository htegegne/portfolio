<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>faye-websocket | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="faye-websocket" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/faye-websocket/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/faye-websocket/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="faye-websocket" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"faye-websocket","url":"http://localhost:4000/myportfolio.client/node_modules/faye-websocket/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=059dd2210d8f0fb8d42af0cbb5c1b29e59b98886">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="faye-websocket">faye-websocket</h1>

<p>This is a general-purpose WebSocket implementation extracted from the
<a href="http://faye.jcoglan.com">Faye</a> project. It provides classes for easily building
WebSocket servers and clients in Node. It does not provide a server itself, but
rather makes it easy to handle WebSocket connections within an existing
<a href="https://nodejs.org/">Node</a> application. It does not provide any abstraction
other than the standard <a href="https://html.spec.whatwg.org/multipage/comms.html#network">WebSocket
API</a>.</p>

<p>It also provides an abstraction for handling
<a href="https://html.spec.whatwg.org/multipage/comms.html#server-sent-events">EventSource</a>
connections, which are one-way connections that allow the server to push data to
the client. They are based on streaming HTTP responses and can be easier to access
via proxies than WebSockets.</p>

<h2 id="installation">Installation</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ npm install faye-websocket
</code></pre></div></div>

<h2 id="handling-websocket-connections-in-node">Handling WebSocket connections in Node</h2>

<p>You can handle WebSockets on the server side by listening for HTTP Upgrade
requests, and creating a new socket for the request. This socket object exposes
the usual WebSocket methods for receiving and sending messages. For example this
is how you’d implement an echo server:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">faye-websocket</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">http</span>      <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">upgrade</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">isWebSocket</span><span class="p">(</span><span class="nx">request</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">body</span><span class="p">);</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">reason</span><span class="p">);</span>
      <span class="nx">ws</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">WebSocket</code> objects are also duplex streams, so you could replace the
<code class="language-plaintext highlighter-rouge">ws.on('message', ...)</code> line with:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">ws</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">ws</span><span class="p">);</span>
</code></pre></div></div>

<p>Note that under certain circumstances (notably a draft-76 client connecting
through an HTTP proxy), the WebSocket handshake will not be complete after you
call <code class="language-plaintext highlighter-rouge">new WebSocket()</code> because the server will not have received the entire
handshake from the client yet. In this case, calls to <code class="language-plaintext highlighter-rouge">ws.send()</code> will buffer
the message in memory until the handshake is complete, at which point any
buffered messages will be sent to the client.</p>

<p>If you need to detect when the WebSocket handshake is complete, you can use the
<code class="language-plaintext highlighter-rouge">onopen</code> event.</p>

<p>If the connection’s protocol version supports it, you can call <code class="language-plaintext highlighter-rouge">ws.ping()</code> to
send a ping message and wait for the client’s response. This method takes a
message string, and an optional callback that fires when a matching pong message
is received. It returns <code class="language-plaintext highlighter-rouge">true</code> if and only if a ping message was sent. If the
client does not support ping/pong, this method sends no data and returns
<code class="language-plaintext highlighter-rouge">false</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ws</span><span class="p">.</span><span class="nx">ping</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mic check, one, two</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// fires when pong is received</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="using-the-websocket-client">Using the WebSocket client</h2>

<p>The client supports both the plain-text <code class="language-plaintext highlighter-rouge">ws</code> protocol and the encrypted <code class="language-plaintext highlighter-rouge">wss</code>
protocol, and has exactly the same interface as a socket you would use in a web
browser. On the wire it identifies itself as <code class="language-plaintext highlighter-rouge">hybi-13</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">faye-websocket</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">ws</span>        <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws://www.example.com/</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello, world!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">reason</span><span class="p">);</span>
  <span class="nx">ws</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>The WebSocket client also lets you inspect the status and headers of the
handshake response via its <code class="language-plaintext highlighter-rouge">statusCode</code> and <code class="language-plaintext highlighter-rouge">headers</code> properties.</p>

<p>To connect via a proxy, set the <code class="language-plaintext highlighter-rouge">proxy</code> option to the HTTP origin of the proxy,
including any authorization information, custom headers and TLS config you
require. Only the <code class="language-plaintext highlighter-rouge">origin</code> setting is required.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws://www.example.com/</span><span class="dl">'</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span>
  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">origin</span><span class="p">:</span>  <span class="dl">'</span><span class="s1">http://username:password@proxy.example.com</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">User-Agent</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">node</span><span class="dl">'</span> <span class="p">},</span>
    <span class="na">tls</span><span class="p">:</span>     <span class="p">{</span> <span class="na">cert</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">client.crt</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">tls</code> value is an object that will be passed to
<a href="https://nodejs.org/api/tls.html#tls_tls_connect_options_callback"><code class="language-plaintext highlighter-rouge">tls.connect()</code></a>.</p>

<h2 id="subprotocol-negotiation">Subprotocol negotiation</h2>

<p>The WebSocket protocol allows peers to select and identify the application
protocol to use over the connection. On the client side, you can set which
protocols the client accepts by passing a list of protocol names when you
construct the socket:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws://www.example.com/</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">irc</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">amqp</span><span class="dl">'</span><span class="p">]);</span>
</code></pre></div></div>

<p>On the server side, you can likewise pass in the list of protocols the server
supports after the other constructor arguments:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">irc</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">amqp</span><span class="dl">'</span><span class="p">]);</span>
</code></pre></div></div>

<p>If the client and server agree on a protocol, both the client- and server-side
socket objects expose the selected protocol through the <code class="language-plaintext highlighter-rouge">ws.protocol</code> property.</p>

<h2 id="protocol-extensions">Protocol extensions</h2>

<p>faye-websocket is based on the
<a href="https://github.com/faye/websocket-extensions-node">websocket-extensions</a>
framework that allows extensions to be negotiated via the
<code class="language-plaintext highlighter-rouge">Sec-WebSocket-Extensions</code> header. To add extensions to a connection, pass an
array of extensions to the <code class="language-plaintext highlighter-rouge">:extensions</code> option. For example, to add
<a href="https://github.com/faye/permessage-deflate-node">permessage-deflate</a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">deflate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">permessage-deflate</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span> <span class="na">extensions</span><span class="p">:</span> <span class="p">[</span><span class="nx">deflate</span><span class="p">]</span> <span class="p">});</span>
</code></pre></div></div>

<h2 id="initialization-options">Initialization options</h2>

<p>Both the server- and client-side classes allow an options object to be passed in
at initialization time, for example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="nx">protocols</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">protocols</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">protocols</code> is an array of subprotocols as described above, or <code class="language-plaintext highlighter-rouge">null</code>.
<code class="language-plaintext highlighter-rouge">options</code> is an optional object containing any of these fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">extensions</code> - an array of
<a href="https://github.com/faye/websocket-extensions-node">websocket-extensions</a>
compatible extensions, as described above</li>
  <li><code class="language-plaintext highlighter-rouge">headers</code> - an object containing key-value pairs representing HTTP headers to
be sent during the handshake process</li>
  <li><code class="language-plaintext highlighter-rouge">maxLength</code> - the maximum allowed size of incoming message frames, in bytes.
The default value is <code class="language-plaintext highlighter-rouge">2^26 - 1</code>, or 1 byte short of 64 MiB.</li>
  <li><code class="language-plaintext highlighter-rouge">ping</code> - an integer that sets how often the WebSocket should send ping frames,
measured in seconds</li>
</ul>

<p>The client accepts some additional options:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">proxy</code> - settings for a proxy as described above</li>
  <li><code class="language-plaintext highlighter-rouge">net</code> - an object containing settings for the origin server that will be
passed to
<a href="https://nodejs.org/api/net.html#net_socket_connect_options_connectlistener"><code class="language-plaintext highlighter-rouge">net.connect()</code></a></li>
  <li><code class="language-plaintext highlighter-rouge">tls</code> - an object containing TLS settings for the origin server, this will be
passed to
<a href="https://nodejs.org/api/tls.html#tls_tls_connect_options_callback"><code class="language-plaintext highlighter-rouge">tls.connect()</code></a></li>
  <li><code class="language-plaintext highlighter-rouge">ca</code> - (legacy) a shorthand for passing <code class="language-plaintext highlighter-rouge">{ tls: { ca: value } }</code></li>
</ul>

<h2 id="websocket-api">WebSocket API</h2>

<p>Both server- and client-side <code class="language-plaintext highlighter-rouge">WebSocket</code> objects support the following API.</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">on('open', function(event) {})</code></strong> fires when the socket connection is
established. Event has no attributes.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">on('message', function(event) {})</code></strong> fires when the socket receives a
message. Event has one attribute, <strong><code class="language-plaintext highlighter-rouge">data</code></strong>, which is either a <code class="language-plaintext highlighter-rouge">String</code> (for
text frames) or a <code class="language-plaintext highlighter-rouge">Buffer</code> (for binary frames).</li>
  <li><strong><code class="language-plaintext highlighter-rouge">on('error', function(event) {})</code></strong> fires when there is a protocol error due
to bad data sent by the other peer. This event is purely informational, you do
not need to implement error recover.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">on('close', function(event) {})</code></strong> fires when either the client or the
server closes the connection. Event has two optional attributes, <strong><code class="language-plaintext highlighter-rouge">code</code></strong>
and <strong><code class="language-plaintext highlighter-rouge">reason</code></strong>, that expose the status code and message sent by the peer
that closed the connection.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">send(message)</code></strong> accepts either a <code class="language-plaintext highlighter-rouge">String</code> or a <code class="language-plaintext highlighter-rouge">Buffer</code> and sends a text
or binary message over the connection to the other peer.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">ping(message, function() {})</code></strong> sends a ping frame with an optional message
and fires the callback when a matching pong is received.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">close(code, reason)</code></strong> closes the connection, sending the given status code
and reason text, both of which are optional.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">version</code></strong> is a string containing the version of the <code class="language-plaintext highlighter-rouge">WebSocket</code> protocol
the connection is using.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">protocol</code></strong> is a string (which may be empty) identifying the subprotocol
the socket is using.</li>
</ul>

<h2 id="handling-eventsource-connections-in-node">Handling EventSource connections in Node</h2>

<p>EventSource connections provide a very similar interface, although because they
only allow the server to send data to the client, there is no <code class="language-plaintext highlighter-rouge">onmessage</code> API.
EventSource allows the server to push text messages to the client, where each
message has an optional event-type and ID.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">WebSocket</span>   <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">faye-websocket</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">EventSource</span> <span class="o">=</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">EventSource</span><span class="p">,</span>
    <span class="nx">http</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">request</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">EventSource</span><span class="p">.</span><span class="nx">isEventSource</span><span class="p">(</span><span class="nx">request</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">es</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventSource</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="nx">es</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">es</span><span class="p">.</span><span class="nx">lastEventId</span><span class="p">);</span>

    <span class="c1">// Periodically send messages</span>
    <span class="kd">var</span> <span class="nx">loop</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">es</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">)</span> <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

    <span class="nx">es</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">loop</span><span class="p">);</span>
      <span class="nx">es</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">});</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Normal HTTP request</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span> <span class="p">});</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">);</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">send</code> method takes two optional parameters, <code class="language-plaintext highlighter-rouge">event</code> and <code class="language-plaintext highlighter-rouge">id</code>. The default
event-type is <code class="language-plaintext highlighter-rouge">'message'</code> with no ID. For example, to send a <code class="language-plaintext highlighter-rouge">notification</code>
event with ID <code class="language-plaintext highlighter-rouge">99</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">es</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Breaking News!</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">event</span><span class="p">:</span> <span class="dl">'</span><span class="s1">notification</span><span class="dl">'</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">99</span><span class="dl">'</span> <span class="p">});</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">EventSource</code> object exposes the following properties:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">url</code></strong> is a string containing the URL the client used to create the
EventSource.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">lastEventId</code></strong> is a string containing the last event ID received by the
client. You can use this when the client reconnects after a dropped connection
to determine which messages need resending.</li>
</ul>

<p>When you initialize an EventSource with ` new EventSource()<code class="language-plaintext highlighter-rouge">, you can pass
configuration options after the </code>response` parameter. Available options are:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">headers</code></strong> is an object containing custom headers to be set on the
EventSource response.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">retry</code></strong> is a number that tells the client how long (in seconds) it should
wait after a dropped connection before attempting to reconnect.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">ping</code></strong> is a number that tells the server how often (in seconds) to send
‘ping’ packets to the client to keep the connection open, to defeat timeouts
set by proxies. The client will ignore these messages.</li>
</ul>

<p>For example, this creates a connection that allows access from any origin, pings
every 15 seconds and is retryable every 10 seconds if the connection is broken:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">es</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventSource</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">Access-Control-Allow-Origin</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">ping</span><span class="p">:</span>    <span class="mi">15</span><span class="p">,</span>
  <span class="na">retry</span><span class="p">:</span>   <span class="mi">10</span>
<span class="p">});</span>
</code></pre></div></div>

<p>You can send a ping message at any time by calling <code class="language-plaintext highlighter-rouge">es.ping()</code>. Unlike
WebSocket, the client does not send a response to this; it is merely to send
some data over the wire to keep the connection alive.</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
