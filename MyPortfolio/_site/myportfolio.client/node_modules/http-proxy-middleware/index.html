<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>http-proxy-middleware | portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="http-proxy-middleware" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/http-proxy-middleware/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/http-proxy-middleware/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="http-proxy-middleware" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"http-proxy-middleware","url":"http://localhost:4000/myportfolio.client/node_modules/http-proxy-middleware/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=059dd2210d8f0fb8d42af0cbb5c1b29e59b98886">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <h1 id="http-proxy-middleware">http-proxy-middleware</h1>

<p><a href="https://github.com/chimurai/http-proxy-middleware/actions?query=branch%3Amaster"><img src="https://img.shields.io/github/workflow/status/chimurai/http-proxy-middleware/CI/master?style=flat-square" alt="GitHub Workflow Status (branch)" /></a>
<a href="https://coveralls.io/r/chimurai/http-proxy-middleware"><img src="https://img.shields.io/coveralls/chimurai/http-proxy-middleware.svg?style=flat-square" alt="Coveralls" /></a>
<a href="https://snyk.io/test/npm/http-proxy-middleware"><img src="https://snyk.io/test/npm/http-proxy-middleware/badge.svg?style=flat-square" alt="dependency Status" /></a>
<a href="https://www.npmjs.com/package/http-proxy-middleware"><img src="https://img.shields.io/npm/v/http-proxy-middleware?color=%23CC3534&amp;style=flat-square" alt="npm" /></a></p>

<p>Node.js proxying made simple. Configure proxy middleware with ease for <a href="https://github.com/senchalabs/connect">connect</a>, <a href="https://github.com/strongloop/express">express</a>, <a href="https://github.com/BrowserSync/browser-sync">browser-sync</a> and <a href="#compatible-servers">many more</a>.</p>

<p>Powered by the popular Nodejitsu <a href="https://github.com/nodejitsu/node-http-proxy"><code class="language-plaintext highlighter-rouge">http-proxy</code></a>. <a href="https://github.com/nodejitsu/node-http-proxy"><img src="https://img.shields.io/github/stars/nodejitsu/node-http-proxy.svg?style=social&amp;label=Star" alt="GitHub stars" /></a></p>

<h2 id="️-note-">⚠️ Note <!-- omit in toc --></h2>

<p>This page is showing documentation for version v2.x.x (<a href="https://github.com/chimurai/http-proxy-middleware/releases">release notes</a>)</p>

<p>If you’re looking for v0.x documentation. Go to:
https://github.com/chimurai/http-proxy-middleware/tree/v0.21.0#readme</p>

<h2 id="tldr-">TL;DR <!-- omit in toc --></h2>

<p>Proxy <code class="language-plaintext highlighter-rouge">/api</code> requests to <code class="language-plaintext highlighter-rouge">http://www.example.org</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// javascript</span>

<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">createProxyMiddleware</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http-proxy-middleware</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="nx">createProxyMiddleware</span><span class="p">({</span> <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://www.example.org</span><span class="dl">'</span><span class="p">,</span> <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

<span class="c1">// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar</span>
</code></pre></div></div>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// typescript</span>

<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">express</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createProxyMiddleware</span><span class="p">,</span> <span class="nx">Filter</span><span class="p">,</span> <span class="nx">Options</span><span class="p">,</span> <span class="nx">RequestHandler</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">http-proxy-middleware</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="nx">createProxyMiddleware</span><span class="p">({</span> <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://www.example.org</span><span class="dl">'</span><span class="p">,</span> <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

<span class="c1">// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar</span>
</code></pre></div></div>

<p><em>All</em> <code class="language-plaintext highlighter-rouge">http-proxy</code> <a href="https://github.com/nodejitsu/node-http-proxy#options">options</a> can be used, along with some extra <code class="language-plaintext highlighter-rouge">http-proxy-middleware</code> <a href="#options">options</a>.</p>

<p>:bulb: <strong>Tip:</strong> Set the option <code class="language-plaintext highlighter-rouge">changeOrigin</code> to <code class="language-plaintext highlighter-rouge">true</code> for <a href="http://en.wikipedia.org/wiki/Virtual_hosting#Name-based">name-based virtual hosted sites</a>.</p>

<h2 id="table-of-contents-">Table of Contents <!-- omit in toc --></h2>

<ul>
  <li><a href="#install">Install</a></li>
  <li><a href="#core-concept">Core concept</a></li>
  <li><a href="#example">Example</a></li>
  <li><a href="#context-matching">Context matching</a></li>
  <li><a href="#options">Options</a>
    <ul>
      <li><a href="#http-proxy-middleware-options">http-proxy-middleware options</a></li>
      <li><a href="#http-proxy-events">http-proxy events</a></li>
      <li><a href="#http-proxy-options">http-proxy options</a></li>
    </ul>
  </li>
  <li><a href="#shorthand">Shorthand</a>
    <ul>
      <li><a href="#appusepath-proxy">app.use(path, proxy)</a></li>
    </ul>
  </li>
  <li><a href="#websocket">WebSocket</a>
    <ul>
      <li><a href="#external-websocket-upgrade">External WebSocket upgrade</a></li>
    </ul>
  </li>
  <li><a href="#intercept-and-manipulate-requests">Intercept and manipulate requests</a></li>
  <li><a href="#intercept-and-manipulate-responses">Intercept and manipulate responses</a></li>
  <li><a href="#working-examples">Working examples</a></li>
  <li><a href="#recipes">Recipes</a></li>
  <li><a href="#compatible-servers">Compatible servers</a></li>
  <li><a href="#tests">Tests</a></li>
  <li><a href="#changelog">Changelog</a></li>
  <li><a href="#license">License</a></li>
</ul>

<h2 id="install">Install</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">--save-dev</span> http-proxy-middleware
</code></pre></div></div>

<h2 id="core-concept">Core concept</h2>

<p>Proxy middleware configuration.</p>

<h4 id="createproxymiddlewarecontext-config">createProxyMiddleware([context,] config)</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">createProxyMiddleware</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http-proxy-middleware</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">apiProxy</span> <span class="o">=</span> <span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://www.example.org</span><span class="dl">'</span> <span class="p">});</span>
<span class="c1">//                                    \____/   \_____________________________/</span>
<span class="c1">//                                      |                    |</span>
<span class="c1">//                                    context             options</span>

<span class="c1">// 'apiProxy' is now ready to be used as middleware in a server.</span>
</code></pre></div></div>

<ul>
  <li><strong>context</strong>: Determine which requests should be proxied to the target host.
(more on <a href="#context-matching">context matching</a>)</li>
  <li><strong>options.target</strong>: target host to proxy to. <em>(protocol + host)</em></li>
</ul>

<p>(full list of <a href="#options"><code class="language-plaintext highlighter-rouge">http-proxy-middleware</code> configuration options</a>)</p>

<h4 id="createproxymiddlewareuri--config">createProxyMiddleware(uri [, config])</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// shorthand syntax for the example above:</span>
<span class="kd">const</span> <span class="nx">apiProxy</span> <span class="o">=</span> <span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://www.example.org/api</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>More about the <a href="#shorthand">shorthand configuration</a>.</p>

<h2 id="example">Example</h2>

<p>An example with <code class="language-plaintext highlighter-rouge">express</code> server.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// include dependencies</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">createProxyMiddleware</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http-proxy-middleware</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// proxy middleware options</span>
<span class="cm">/** @type {import('http-proxy-middleware/dist/types').Options} */</span>
<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://www.example.org</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// target host</span>
  <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// needed for virtual hosted sites</span>
  <span class="na">ws</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// proxy websockets</span>
  <span class="na">pathRewrite</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">^/api/old-path</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/api/new-path</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// rewrite path</span>
    <span class="dl">'</span><span class="s1">^/api/remove/path</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/path</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// remove base path</span>
  <span class="p">},</span>
  <span class="na">router</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// when request.headers.host == 'dev.localhost:3000',</span>
    <span class="c1">// override target 'http://www.example.org' to 'http://localhost:8000'</span>
    <span class="dl">'</span><span class="s1">dev.localhost:3000</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:8000</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// create the proxy (without context)</span>
<span class="kd">const</span> <span class="nx">exampleProxy</span> <span class="o">=</span> <span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

<span class="c1">// mount `exampleProxy` in web server</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="nx">exampleProxy</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="context-matching">Context matching</h2>

<p>Providing an alternative way to decide which requests should be proxied; In case you are not able to use the server’s <a href="http://expressjs.com/en/4x/api.html#app.use"><code class="language-plaintext highlighter-rouge">path</code> parameter</a> to mount the proxy or when you need more flexibility.</p>

<p><a href="https://tools.ietf.org/html/rfc3986#section-3.3">RFC 3986 <code class="language-plaintext highlighter-rouge">path</code></a> is used for context matching.</p>

<pre><code class="language-ascii">         foo://example.com:8042/over/there?name=ferret#nose
         \_/   \______________/\_________/ \_________/ \__/
          |           |            |            |        |
       scheme     authority       path        query   fragment
</code></pre>

<ul>
  <li>
    <p><strong>path matching</strong></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware({...})</code> - matches any path, all requests will be proxied.</li>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware('/', {...})</code> - matches any path, all requests will be proxied.</li>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware('/api', {...})</code> - matches paths starting with <code class="language-plaintext highlighter-rouge">/api</code></li>
    </ul>
  </li>
  <li>
    <p><strong>multiple path matching</strong></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware(['/api', '/ajax', '/someotherpath'], {...})</code></li>
    </ul>
  </li>
  <li>
    <p><strong>wildcard path matching</strong></p>

    <p>For fine-grained control you can use wildcard matching. Glob pattern matching is done by <em>micromatch</em>. Visit <a href="https://www.npmjs.com/package/micromatch">micromatch</a> or <a href="https://www.npmjs.com/package/glob">glob</a> for more globbing examples.</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware('**', {...})</code> matches any path, all requests will be proxied.</li>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware('**/*.html', {...})</code> matches any path which ends with <code class="language-plaintext highlighter-rouge">.html</code></li>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware('/*.html', {...})</code> matches paths directly under path-absolute</li>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware('/api/**/*.html', {...})</code> matches requests ending with <code class="language-plaintext highlighter-rouge">.html</code> in the path of <code class="language-plaintext highlighter-rouge">/api</code></li>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware(['/api/**', '/ajax/**'], {...})</code> combine multiple patterns</li>
      <li><code class="language-plaintext highlighter-rouge">createProxyMiddleware(['/api/**', '!**/bad.json'], {...})</code> exclusion</li>
    </ul>

    <p><strong>Note</strong>: In multiple path matching, you cannot use string paths and wildcard paths together.</p>
  </li>
  <li>
    <p><strong>custom matching</strong></p>

    <p>For full control you can provide a custom function to determine which requests should be proxied or not.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @return {Boolean}
 */</span>
<span class="kd">const</span> <span class="nx">filter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pathname</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">pathname</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="dl">'</span><span class="s1">^/api</span><span class="dl">'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">apiProxy</span> <span class="o">=</span> <span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://www.example.org</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="options">Options</h2>

<h3 id="http-proxy-middleware-options">http-proxy-middleware options</h3>

<ul>
  <li>
    <p><strong>option.pathRewrite</strong>: object/function, rewrite target’s url path. Object-keys will be used as <em>RegExp</em> to match paths.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// rewrite path</span>
<span class="nx">pathRewrite</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">^/old/api</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">/new/api</span><span class="dl">'</span><span class="p">}</span>

<span class="c1">// remove path</span>
<span class="nl">pathRewrite</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">^/remove/api</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">''</span><span class="p">}</span>

<span class="c1">// add base path</span>
<span class="nl">pathRewrite</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">^/</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">/basepath/</span><span class="dl">'</span><span class="p">}</span>

<span class="c1">// custom rewriting</span>
<span class="nl">pathRewrite</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/base/api</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>

<span class="c1">// custom rewriting, returning Promise</span>
<span class="nl">pathRewrite</span><span class="p">:</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">should_add_something</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">httpRequestToDecideSomething</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">should_add_something</span><span class="p">)</span> <span class="nx">path</span> <span class="o">+=</span> <span class="dl">"</span><span class="s2">something</span><span class="dl">"</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.router</strong>: object/function, re-target <code class="language-plaintext highlighter-rouge">option.target</code> for specific requests.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Use `host` and/or `path` to match requests. First match will be used.</span>
<span class="c1">// The order of the configuration matters.</span>
<span class="nx">router</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">integration.localhost:3000</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:8001</span><span class="dl">'</span><span class="p">,</span>  <span class="c1">// host only</span>
    <span class="dl">'</span><span class="s1">staging.localhost:3000</span><span class="dl">'</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:8002</span><span class="dl">'</span><span class="p">,</span>  <span class="c1">// host only</span>
    <span class="dl">'</span><span class="s1">localhost:3000/api</span><span class="dl">'</span>         <span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:8003</span><span class="dl">'</span><span class="p">,</span>  <span class="c1">// host + path</span>
    <span class="dl">'</span><span class="s1">/rest</span><span class="dl">'</span>                      <span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:8004</span><span class="dl">'</span>   <span class="c1">// path only</span>
<span class="p">}</span>

<span class="c1">// Custom router function (string target)</span>
<span class="nl">router</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">http://localhost:8004</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Custom router function (target object)</span>
<span class="nl">router</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">protocol</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https:</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// The : is required</span>
        <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">port</span><span class="p">:</span> <span class="mi">8004</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Asynchronous router function which returns promise</span>
<span class="nl">router</span><span class="p">:</span> <span class="k">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">doSomeIO</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.logLevel</strong>: string, [‘debug’, ‘info’, ‘warn’, ‘error’, ‘silent’]. Default: <code class="language-plaintext highlighter-rouge">'info'</code></p>
  </li>
  <li>
    <p><strong>option.logProvider</strong>: function, modify or replace log provider. Default: <code class="language-plaintext highlighter-rouge">console</code>.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// simple replace</span>
<span class="kd">function</span> <span class="nx">logProvider</span><span class="p">(</span><span class="nx">provider</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// replace the default console log provider.</span>
  <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">winston</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// verbose replacement</span>
<span class="kd">function</span> <span class="nx">logProvider</span><span class="p">(</span><span class="nx">provider</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">winston</span><span class="dl">'</span><span class="p">).</span><span class="nx">Logger</span><span class="p">)();</span>

  <span class="kd">const</span> <span class="nx">myCustomProvider</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">log</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span>
    <span class="na">debug</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span>
    <span class="na">info</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">,</span>
    <span class="na">warn</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">warn</span><span class="p">,</span>
    <span class="na">error</span><span class="p">:</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">myCustomProvider</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="http-proxy-events">http-proxy events</h3>

<p>Subscribe to <a href="https://github.com/nodejitsu/node-http-proxy#listening-for-proxy-events">http-proxy events</a>:</p>

<ul>
  <li>
    <p><strong>option.onError</strong>: function, subscribe to http-proxy’s <code class="language-plaintext highlighter-rouge">error</code> event for custom error handling.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">Something went wrong. And we are reporting a custom error message.</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.onProxyRes</strong>: function, subscribe to http-proxy’s <code class="language-plaintext highlighter-rouge">proxyRes</code> event.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onProxyRes</span><span class="p">(</span><span class="nx">proxyRes</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">proxyRes</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">x-added</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">foobar</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// add new header to response</span>
  <span class="k">delete</span> <span class="nx">proxyRes</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">x-removed</span><span class="dl">'</span><span class="p">];</span> <span class="c1">// remove header from response</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.onProxyReq</strong>: function, subscribe to http-proxy’s <code class="language-plaintext highlighter-rouge">proxyReq</code> event.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onProxyReq</span><span class="p">(</span><span class="nx">proxyReq</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// add custom header to request</span>
  <span class="nx">proxyReq</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">x-added</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">foobar</span><span class="dl">'</span><span class="p">);</span>
  <span class="c1">// or log the req</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.onProxyReqWs</strong>: function, subscribe to http-proxy’s <code class="language-plaintext highlighter-rouge">proxyReqWs</code> event.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onProxyReqWs</span><span class="p">(</span><span class="nx">proxyReq</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// add custom header</span>
  <span class="nx">proxyReq</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">X-Special-Proxy-Header</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">foobar</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.onOpen</strong>: function, subscribe to http-proxy’s <code class="language-plaintext highlighter-rouge">open</code> event.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onOpen</span><span class="p">(</span><span class="nx">proxySocket</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// listen for messages coming FROM the target here</span>
  <span class="nx">proxySocket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="nx">hybridParseAndLogMessage</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>option.onClose</strong>: function, subscribe to http-proxy’s <code class="language-plaintext highlighter-rouge">close</code> event.</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onClose</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// view disconnected websocket connections</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Client disconnected</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="http-proxy-options">http-proxy options</h3>

<p>The following options are provided by the underlying <a href="https://github.com/nodejitsu/node-http-proxy#options">http-proxy</a> library.</p>

<ul>
  <li><strong>option.target</strong>: url string to be parsed with the url module</li>
  <li><strong>option.forward</strong>: url string to be parsed with the url module</li>
  <li><strong>option.agent</strong>: object to be passed to http(s).request (see Node’s <a href="http://nodejs.org/api/https.html#https_class_https_agent">https agent</a> and <a href="http://nodejs.org/api/http.html#http_class_http_agent">http agent</a> objects)</li>
  <li><strong>option.ssl</strong>: object to be passed to https.createServer()</li>
  <li><strong>option.ws</strong>: true/false: if you want to proxy websockets</li>
  <li><strong>option.xfwd</strong>: true/false, adds x-forward headers</li>
  <li><strong>option.secure</strong>: true/false, if you want to verify the SSL Certs</li>
  <li><strong>option.toProxy</strong>: true/false, passes the absolute URL as the <code class="language-plaintext highlighter-rouge">path</code> (useful for proxying to proxies)</li>
  <li><strong>option.prependPath</strong>: true/false, Default: true - specify whether you want to prepend the target’s path to the proxy path</li>
  <li><strong>option.ignorePath</strong>: true/false, Default: false - specify whether you want to ignore the proxy path of the incoming request (note: you will have to append / manually if required).</li>
  <li><strong>option.localAddress</strong> : Local interface string to bind for outgoing connections</li>
  <li><strong>option.changeOrigin</strong>: true/false, Default: false - changes the origin of the host header to the target URL</li>
  <li><strong>option.preserveHeaderKeyCase</strong>: true/false, Default: false - specify whether you want to keep letter case of response header key</li>
  <li><strong>option.auth</strong> : Basic authentication i.e. ‘user:password’ to compute an Authorization header.</li>
  <li><strong>option.hostRewrite</strong>: rewrites the location hostname on (301/302/307/308) redirects.</li>
  <li><strong>option.autoRewrite</strong>: rewrites the location host/port on (301/302/307/308) redirects based on requested host/port. Default: false.</li>
  <li><strong>option.protocolRewrite</strong>: rewrites the location protocol on (301/302/307/308) redirects to ‘http’ or ‘https’. Default: null.</li>
  <li><strong>option.cookieDomainRewrite</strong>: rewrites domain of <code class="language-plaintext highlighter-rouge">set-cookie</code> headers. Possible values:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">false</code> (default): disable cookie rewriting</li>
      <li>String: new domain, for example <code class="language-plaintext highlighter-rouge">cookieDomainRewrite: "new.domain"</code>. To remove the domain, use <code class="language-plaintext highlighter-rouge">cookieDomainRewrite: ""</code>.</li>
      <li>Object: mapping of domains to new domains, use <code class="language-plaintext highlighter-rouge">"*"</code> to match all domains.<br />
For example keep one domain unchanged, rewrite one domain and remove other domains:
        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cookieDomainRewrite:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"unchanged.domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unchanged.domain"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"old.domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new.domain"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"*"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>option.cookiePathRewrite</strong>: rewrites path of <code class="language-plaintext highlighter-rouge">set-cookie</code> headers. Possible values:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">false</code> (default): disable cookie rewriting</li>
      <li>String: new path, for example <code class="language-plaintext highlighter-rouge">cookiePathRewrite: "/newPath/"</code>. To remove the path, use <code class="language-plaintext highlighter-rouge">cookiePathRewrite: ""</code>. To set path to root use <code class="language-plaintext highlighter-rouge">cookiePathRewrite: "/"</code>.</li>
      <li>Object: mapping of paths to new paths, use <code class="language-plaintext highlighter-rouge">"*"</code> to match all paths.
For example, to keep one path unchanged, rewrite one path and remove other paths:
        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cookiePathRewrite:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"/unchanged.path/"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/unchanged.path/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"/old.path/"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/new.path/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"*"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>option.headers</strong>: object, adds <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Request_fields">request headers</a>. (Example: <code class="language-plaintext highlighter-rouge">{host:'www.example.org'}</code>)</li>
  <li><strong>option.proxyTimeout</strong>: timeout (in millis) when proxy receives no response from target</li>
  <li><strong>option.timeout</strong>: timeout (in millis) for incoming requests</li>
  <li><strong>option.followRedirects</strong>: true/false, Default: false - specify whether you want to follow redirects</li>
  <li><strong>option.selfHandleResponse</strong> true/false, if set to true, none of the webOutgoing passes are called and it’s your responsibility to appropriately return the response by listening and acting on the <code class="language-plaintext highlighter-rouge">proxyRes</code> event</li>
  <li>
    <p><strong>option.buffer</strong>: stream of data to send as the request body. Maybe you have some middleware that consumes the request stream before proxying it on e.g. If you read the body of a request into a field called ‘req.rawbody’ you could restream this field in the buffer option:</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">streamify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">stream-array</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">HttpProxy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http-proxy</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpProxy</span><span class="p">();</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">proxy</span><span class="p">.</span><span class="nx">web</span><span class="p">(</span>
    <span class="nx">req</span><span class="p">,</span>
    <span class="nx">res</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:4003/</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">buffer</span><span class="p">:</span> <span class="nx">streamify</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">rawBody</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="nx">next</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="shorthand">Shorthand</h2>

<p>Use the shorthand syntax when verbose configuration is not needed. The <code class="language-plaintext highlighter-rouge">context</code> and <code class="language-plaintext highlighter-rouge">option.target</code> will be automatically configured when shorthand is used. Options can still be used if needed.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://www.example.org:8000/api</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// createProxyMiddleware('/api', {target: 'http://www.example.org:8000'});</span>

<span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://www.example.org:8000/api/books/*/**.json</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// createProxyMiddleware('/api/books/*/**.json', {target: 'http://www.example.org:8000'});</span>

<span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://www.example.org:8000/api</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
<span class="c1">// createProxyMiddleware('/api', {target: 'http://www.example.org:8000', changeOrigin: true});</span>
</code></pre></div></div>

<h3 id="appusepath-proxy">app.use(path, proxy)</h3>

<p>If you want to use the server’s <code class="language-plaintext highlighter-rouge">app.use</code> <code class="language-plaintext highlighter-rouge">path</code> parameter to match requests;
Create and mount the proxy without the http-proxy-middleware <code class="language-plaintext highlighter-rouge">context</code> parameter:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="nx">createProxyMiddleware</span><span class="p">({</span> <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://www.example.org</span><span class="dl">'</span><span class="p">,</span> <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">app.use</code> documentation:</p>

<ul>
  <li>express: http://expressjs.com/en/4x/api.html#app.use</li>
  <li>connect: https://github.com/senchalabs/connect#mount-middleware</li>
  <li>polka: https://github.com/lukeed/polka#usebase-fn</li>
</ul>

<h2 id="websocket">WebSocket</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// verbose api</span>
<span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://echo.websocket.org</span><span class="dl">'</span><span class="p">,</span> <span class="na">ws</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>

<span class="c1">// shorthand</span>
<span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://echo.websocket.org</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">ws</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>

<span class="c1">// shorter shorthand</span>
<span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws://echo.websocket.org</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="external-websocket-upgrade">External WebSocket upgrade</h3>

<p>In the previous WebSocket examples, http-proxy-middleware relies on a initial http request in order to listen to the http <code class="language-plaintext highlighter-rouge">upgrade</code> event. If you need to proxy WebSockets without the initial http request, you can subscribe to the server’s http <code class="language-plaintext highlighter-rouge">upgrade</code> event manually.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">wsProxy</span> <span class="o">=</span> <span class="nx">createProxyMiddleware</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws://echo.websocket.org</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">wsProxy</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">upgrade</span><span class="dl">'</span><span class="p">,</span> <span class="nx">wsProxy</span><span class="p">.</span><span class="nx">upgrade</span><span class="p">);</span> <span class="c1">// &lt;-- subscribe to http 'upgrade'</span>
</code></pre></div></div>

<h2 id="intercept-and-manipulate-requests">Intercept and manipulate requests</h2>

<p>Intercept requests from downstream by defining <code class="language-plaintext highlighter-rouge">onProxyReq</code> in <code class="language-plaintext highlighter-rouge">createProxyMiddleware</code>.</p>

<p>Currently the only pre-provided request interceptor is <code class="language-plaintext highlighter-rouge">fixRequestBody</code>, which is used to fix proxied POST requests when <code class="language-plaintext highlighter-rouge">bodyParser</code> is applied before this middleware.</p>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">createProxyMiddleware</span><span class="p">,</span> <span class="nx">fixRequestBody</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http-proxy-middleware</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="nx">createProxyMiddleware</span><span class="p">({</span>
  <span class="cm">/**
   * Fix bodyParser
   **/</span>
  <span class="na">onProxyReq</span><span class="p">:</span> <span class="nx">fixRequestBody</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="intercept-and-manipulate-responses">Intercept and manipulate responses</h2>

<p>Intercept responses from upstream with <code class="language-plaintext highlighter-rouge">responseInterceptor</code>. (Make sure to set <code class="language-plaintext highlighter-rouge">selfHandleResponse: true</code>)</p>

<p>Responses which are compressed with <code class="language-plaintext highlighter-rouge">brotli</code>, <code class="language-plaintext highlighter-rouge">gzip</code> and <code class="language-plaintext highlighter-rouge">deflate</code> will be decompressed automatically. The response will be returned as <code class="language-plaintext highlighter-rouge">buffer</code> (<a href="https://nodejs.org/api/buffer.html">docs</a>) which you can manipulate.</p>

<p>With <code class="language-plaintext highlighter-rouge">buffer</code>, response manipulation is not limited to text responses (html/css/js, etc…); image manipulation will be possible too. (<a href="https://github.com/chimurai/http-proxy-middleware/blob/master/recipes/response-interceptor.md#manipulate-image-response">example</a>)</p>

<p>NOTE: <code class="language-plaintext highlighter-rouge">responseInterceptor</code> disables streaming of target’s response.</p>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">createProxyMiddleware</span><span class="p">,</span> <span class="nx">responseInterceptor</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http-proxy-middleware</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="nx">createProxyMiddleware</span><span class="p">({</span>
  <span class="cm">/**
   * IMPORTANT: avoid res.end being called automatically
   **/</span>
  <span class="na">selfHandleResponse</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// res.end() will be called internally by responseInterceptor()</span>

  <span class="cm">/**
   * Intercept response and replace 'Hello' with 'Goodbye'
   **/</span>
  <span class="na">onProxyRes</span><span class="p">:</span> <span class="nx">responseInterceptor</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">responseBuffer</span><span class="p">,</span> <span class="nx">proxyRes</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">responseBuffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// convert buffer to string</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Goodbye</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// manipulate response and return the result</span>
  <span class="p">}),</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Check out <a href="https://github.com/chimurai/http-proxy-middleware/blob/master/recipes/response-interceptor.md#readme">interception recipes</a> for more examples.</p>

<h2 id="working-examples">Working examples</h2>

<p>View and play around with <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples">working examples</a>.</p>

<ul>
  <li>Browser-Sync (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/browser-sync/index.js">example source</a>)</li>
  <li>express (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/express/index.js">example source</a>)</li>
  <li>connect (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/connect/index.js">example source</a>)</li>
  <li>WebSocket (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/websocket/index.js">example source</a>)</li>
  <li>Response Manipulation (<a href="https://github.com/chimurai/http-proxy-middleware/blob/master/examples/response-interceptor/index.js">example source</a>)</li>
</ul>

<h2 id="recipes">Recipes</h2>

<p>View the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes">recipes</a> for common use cases.</p>

<h2 id="compatible-servers">Compatible servers</h2>

<p><code class="language-plaintext highlighter-rouge">http-proxy-middleware</code> is compatible with the following servers:</p>

<ul>
  <li><a href="https://www.npmjs.com/package/connect">connect</a></li>
  <li><a href="https://www.npmjs.com/package/express">express</a></li>
  <li><a href="https://www.npmjs.com/package/fastify">fastify</a></li>
  <li><a href="https://www.npmjs.com/package/browser-sync">browser-sync</a></li>
  <li><a href="https://www.npmjs.com/package/lite-server">lite-server</a></li>
  <li><a href="https://github.com/lukeed/polka">polka</a></li>
  <li><a href="https://www.npmjs.com/package/grunt-contrib-connect">grunt-contrib-connect</a></li>
  <li><a href="https://www.npmjs.com/package/grunt-browser-sync">grunt-browser-sync</a></li>
  <li><a href="https://www.npmjs.com/package/gulp-connect">gulp-connect</a></li>
  <li><a href="https://www.npmjs.com/package/gulp-webserver">gulp-webserver</a></li>
</ul>

<p>Sample implementations can be found in the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes/servers.md">server recipes</a>.</p>

<h2 id="tests">Tests</h2>

<p>Run the test suite:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install dependencies</span>
<span class="nv">$ </span>yarn

<span class="c"># linting</span>
<span class="nv">$ </span>yarn lint
<span class="nv">$ </span>yarn lint:fix

<span class="c"># building (compile typescript to js)</span>
<span class="nv">$ </span>yarn build

<span class="c"># unit tests</span>
<span class="nv">$ </span>yarn <span class="nb">test</span>

<span class="c"># code coverage</span>
<span class="nv">$ </span>yarn cover

<span class="c"># check spelling mistakes</span>
<span class="nv">$ </span>yarn spellcheck
</code></pre></div></div>

<h2 id="changelog">Changelog</h2>

<ul>
  <li><a href="https://github.com/chimurai/http-proxy-middleware/blob/master/CHANGELOG.md">View changelog</a></li>
</ul>

<h2 id="license">License</h2>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2015-2022 Steven Chim</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
