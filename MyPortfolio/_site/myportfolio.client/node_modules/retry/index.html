<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>portfolio</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="portfolio" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/myportfolio.client/node_modules/retry/" />
<meta property="og:url" content="http://localhost:4000/myportfolio.client/node_modules/retry/" />
<meta property="og:site_name" content="portfolio" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="portfolio" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"portfolio","url":"http://localhost:4000/myportfolio.client/node_modules/retry/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=00c08f3bd19ad2390c706d50e4f8968f8b47944c">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">portfolio</a></h1>
      

      <!-- badges/ -->
<p><a href="http://travis-ci.org/tim-kos/node-retry" title="Check this project's build status on TravisCI"><img src="https://secure.travis-ci.org/tim-kos/node-retry.svg?branch=master" alt="Build Status" /></a>
<a href="https://codecov.io/gh/tim-kos/node-retry"><img src="https://codecov.io/gh/tim-kos/node-retry/branch/master/graph/badge.svg" alt="codecov" /></a>
<!-- /badges --></p>

<h1 id="retry">retry</h1>

<p>Abstraction for exponential and custom retry strategies for failed operations.</p>

<h2 id="installation">Installation</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install retry
</code></pre></div></div>

<h2 id="current-status">Current Status</h2>

<p>This module has been tested and is ready to be used.</p>

<h2 id="tutorial">Tutorial</h2>

<p>The example below will retry a potentially failing <code class="language-plaintext highlighter-rouge">dns.resolve</code> operation
<code class="language-plaintext highlighter-rouge">10</code> times using an exponential backoff strategy. With the default settings, this
means the last attempt is made after <code class="language-plaintext highlighter-rouge">17 minutes and 3 seconds</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">dns</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dns</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">retry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">retry</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">faultTolerantResolve</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">operation</span> <span class="o">=</span> <span class="nx">retry</span><span class="p">.</span><span class="nx">operation</span><span class="p">();</span>

  <span class="nx">operation</span><span class="p">.</span><span class="nx">attempt</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">currentAttempt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dns</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">addresses</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">operation</span><span class="p">.</span><span class="nx">retry</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span> <span class="p">?</span> <span class="nx">operation</span><span class="p">.</span><span class="nx">mainError</span><span class="p">()</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">addresses</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">faultTolerantResolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">nodejs.org</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">addresses</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">addresses</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Of course you can also configure the factors that go into the exponential
backoff. See the API documentation below for all available settings.
currentAttempt is an int representing the number of attempts so far.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">operation</span> <span class="o">=</span> <span class="nx">retry</span><span class="p">.</span><span class="nx">operation</span><span class="p">({</span>
  <span class="na">retries</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="na">factor</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="na">minTimeout</span><span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="na">maxTimeout</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="na">randomize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="api">API</h2>

<h3 id="retryoperationoptions">retry.operation([options])</h3>

<p>Creates a new <code class="language-plaintext highlighter-rouge">RetryOperation</code> object. <code class="language-plaintext highlighter-rouge">options</code> is the same as <code class="language-plaintext highlighter-rouge">retry.timeouts()</code>’s <code class="language-plaintext highlighter-rouge">options</code>, with three additions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">forever</code>: Whether to retry forever, defaults to <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">unref</code>: Whether to <a href="https://nodejs.org/api/timers.html#timers_unref">unref</a> the setTimeout’s, defaults to <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">maxRetryTime</code>: The maximum time (in milliseconds) that the retried operation is allowed to run. Default is <code class="language-plaintext highlighter-rouge">Infinity</code>.</li>
</ul>

<h3 id="retrytimeoutsoptions">retry.timeouts([options])</h3>

<p>Returns an array of timeouts. All time <code class="language-plaintext highlighter-rouge">options</code> and return values are in
milliseconds. If <code class="language-plaintext highlighter-rouge">options</code> is an array, a copy of that array is returned.</p>

<p><code class="language-plaintext highlighter-rouge">options</code> is a JS object that can contain any of the following keys:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">retries</code>: The maximum amount of times to retry the operation. Default is <code class="language-plaintext highlighter-rouge">10</code>. Seting this to <code class="language-plaintext highlighter-rouge">1</code> means <code class="language-plaintext highlighter-rouge">do it once, then retry it once</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">factor</code>: The exponential factor to use. Default is <code class="language-plaintext highlighter-rouge">2</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">minTimeout</code>: The number of milliseconds before starting the first retry. Default is <code class="language-plaintext highlighter-rouge">1000</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">maxTimeout</code>: The maximum number of milliseconds between two retries. Default is <code class="language-plaintext highlighter-rouge">Infinity</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">randomize</code>: Randomizes the timeouts by multiplying with a factor between <code class="language-plaintext highlighter-rouge">1</code> to <code class="language-plaintext highlighter-rouge">2</code>. Default is <code class="language-plaintext highlighter-rouge">false</code>.</li>
</ul>

<p>The formula used to calculate the individual timeouts is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Math.min(random * minTimeout * Math.pow(factor, attempt), maxTimeout)
</code></pre></div></div>

<p>Have a look at <a href="http://dthain.blogspot.com/2009/02/exponential-backoff-in-distributed.html">this article</a> for a better explanation of approach.</p>

<p>If you want to tune your <code class="language-plaintext highlighter-rouge">factor</code> / <code class="language-plaintext highlighter-rouge">times</code> settings to attempt the last retry
after a certain amount of time, you can use wolfram alpha. For example in order
to tune for <code class="language-plaintext highlighter-rouge">10</code> attempts in <code class="language-plaintext highlighter-rouge">5 minutes</code>, you can use this equation:</p>

<p><img src="https://github.com/tim-kos/node-retry/raw/master/equation.gif" alt="screenshot" /></p>

<p>Explaining the various values from left to right:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">k = 0 ... 9</code>:  The <code class="language-plaintext highlighter-rouge">retries</code> value (10)</li>
  <li><code class="language-plaintext highlighter-rouge">1000</code>: The <code class="language-plaintext highlighter-rouge">minTimeout</code> value in ms (1000)</li>
  <li><code class="language-plaintext highlighter-rouge">x^k</code>: No need to change this, <code class="language-plaintext highlighter-rouge">x</code> will be your resulting factor</li>
  <li><code class="language-plaintext highlighter-rouge">5 * 60 * 1000</code>: The desired total amount of time for retrying in ms (5 minutes)</li>
</ul>

<p>To make this a little easier for you, use wolfram alpha to do the calculations:</p>

<p><a href="http://www.wolframalpha.com/input/?i=Sum%5B1000*x^k%2C+{k%2C+0%2C+9}%5D+%3D+5+*+60+*+1000">http://www.wolframalpha.com/input/?i=Sum%5B1000*x^k%2C+{k%2C+0%2C+9}%5D+%3D+5+*+60+*+1000</a></p>

<h3 id="retrycreatetimeoutattempt-opts">retry.createTimeout(attempt, opts)</h3>

<p>Returns a new <code class="language-plaintext highlighter-rouge">timeout</code> (integer in milliseconds) based on the given parameters.</p>

<p><code class="language-plaintext highlighter-rouge">attempt</code> is an integer representing for which retry the timeout should be calculated. If your retry operation was executed 4 times you had one attempt and 3 retries. If you then want to calculate a new timeout, you should set <code class="language-plaintext highlighter-rouge">attempt</code> to 4 (attempts are zero-indexed).</p>

<p><code class="language-plaintext highlighter-rouge">opts</code> can include <code class="language-plaintext highlighter-rouge">factor</code>, <code class="language-plaintext highlighter-rouge">minTimeout</code>, <code class="language-plaintext highlighter-rouge">randomize</code> (boolean) and <code class="language-plaintext highlighter-rouge">maxTimeout</code>. They are documented above.</p>

<p><code class="language-plaintext highlighter-rouge">retry.createTimeout()</code> is used internally by <code class="language-plaintext highlighter-rouge">retry.timeouts()</code> and is public for you to be able to create your own timeouts for reinserting an item, see <a href="https://github.com/tim-kos/node-retry/issues/13">issue #13</a>.</p>

<h3 id="retrywrapobj-options-methodnames">retry.wrap(obj, [options], [methodNames])</h3>

<p>Wrap all functions of the <code class="language-plaintext highlighter-rouge">obj</code> with retry. Optionally you can pass operation options and
an array of method names which need to be wrapped.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>retry.wrap(obj)

retry.wrap(obj, ['method1', 'method2'])

retry.wrap(obj, {retries: 3})

retry.wrap(obj, {retries: 3}, ['method1', 'method2'])
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">options</code> object can take any options that the usual call to <code class="language-plaintext highlighter-rouge">retry.operation</code> can take.</p>

<h3 id="new-retryoperationtimeouts-options">new RetryOperation(timeouts, [options])</h3>

<p>Creates a new <code class="language-plaintext highlighter-rouge">RetryOperation</code> where <code class="language-plaintext highlighter-rouge">timeouts</code> is an array where each value is
a timeout given in milliseconds.</p>

<p>Available options:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">forever</code>: Whether to retry forever, defaults to <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">unref</code>: Wether to <a href="https://nodejs.org/api/timers.html#timers_unref">unref</a> the setTimeout’s, defaults to <code class="language-plaintext highlighter-rouge">false</code>.</li>
</ul>

<p>If <code class="language-plaintext highlighter-rouge">forever</code> is true, the following changes happen:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">RetryOperation.errors()</code> will only output an array of one item: the last error.</li>
  <li><code class="language-plaintext highlighter-rouge">RetryOperation</code> will repeatedly use the <code class="language-plaintext highlighter-rouge">timeouts</code> array. Once all of its timeouts have been used up, it restarts with the first timeout, then uses the second and so on.</li>
</ul>

<h4 id="retryoperationerrors">retryOperation.errors()</h4>

<p>Returns an array of all errors that have been passed to <code class="language-plaintext highlighter-rouge">retryOperation.retry()</code> so far. The
returning array has the errors ordered chronologically based on when they were passed to
<code class="language-plaintext highlighter-rouge">retryOperation.retry()</code>, which means the first passed error is at index zero and the last is
at the last index.</p>

<h4 id="retryoperationmainerror">retryOperation.mainError()</h4>

<p>A reference to the error object that occured most frequently. Errors are
compared using the <code class="language-plaintext highlighter-rouge">error.message</code> property.</p>

<p>If multiple error messages occured the same amount of time, the last error
object with that message is returned.</p>

<p>If no errors occured so far, the value is <code class="language-plaintext highlighter-rouge">null</code>.</p>

<h4 id="retryoperationattemptfn-timeoutops">retryOperation.attempt(fn, timeoutOps)</h4>

<p>Defines the function <code class="language-plaintext highlighter-rouge">fn</code> that is to be retried and executes it for the first
time right away. The <code class="language-plaintext highlighter-rouge">fn</code> function can receive an optional <code class="language-plaintext highlighter-rouge">currentAttempt</code> callback that represents the number of attempts to execute <code class="language-plaintext highlighter-rouge">fn</code> so far.</p>

<p>Optionally defines <code class="language-plaintext highlighter-rouge">timeoutOps</code> which is an object having a property <code class="language-plaintext highlighter-rouge">timeout</code> in miliseconds and a property <code class="language-plaintext highlighter-rouge">cb</code> callback function.
Whenever your retry operation takes longer than <code class="language-plaintext highlighter-rouge">timeout</code> to execute, the timeout callback function <code class="language-plaintext highlighter-rouge">cb</code> is called.</p>

<h4 id="retryoperationtryfn">retryOperation.try(fn)</h4>

<p>This is an alias for <code class="language-plaintext highlighter-rouge">retryOperation.attempt(fn)</code>. This is deprecated. Please use <code class="language-plaintext highlighter-rouge">retryOperation.attempt(fn)</code> instead.</p>

<h4 id="retryoperationstartfn">retryOperation.start(fn)</h4>

<p>This is an alias for <code class="language-plaintext highlighter-rouge">retryOperation.attempt(fn)</code>. This is deprecated. Please use <code class="language-plaintext highlighter-rouge">retryOperation.attempt(fn)</code> instead.</p>

<h4 id="retryoperationretryerror">retryOperation.retry(error)</h4>

<p>Returns <code class="language-plaintext highlighter-rouge">false</code> when no <code class="language-plaintext highlighter-rouge">error</code> value is given, or the maximum amount of retries
has been reached.</p>

<p>Otherwise it returns <code class="language-plaintext highlighter-rouge">true</code>, and retries the operation after the timeout for
the current attempt number.</p>

<h4 id="retryoperationstop">retryOperation.stop()</h4>

<p>Allows you to stop the operation being retried. Useful for aborting the operation on a fatal error etc.</p>

<h4 id="retryoperationreset">retryOperation.reset()</h4>

<p>Resets the internal state of the operation object, so that you can call <code class="language-plaintext highlighter-rouge">attempt()</code> again as if this was a new operation object.</p>

<h4 id="retryoperationattempts">retryOperation.attempts()</h4>

<p>Returns an int representing the number of attempts it took to call <code class="language-plaintext highlighter-rouge">fn</code> before it was successful.</p>

<h2 id="license">License</h2>

<p>retry is licensed under the MIT license.</p>

<h1 id="changelog">Changelog</h1>

<p>0.10.0 Adding <code class="language-plaintext highlighter-rouge">stop</code> functionality, thanks to @maxnachlinger.</p>

<p>0.9.0 Adding <code class="language-plaintext highlighter-rouge">unref</code> functionality, thanks to @satazor.</p>

<p>0.8.0 Implementing retry.wrap.</p>

<p>0.7.0 Some bug fixes and made retry.createTimeout() public. Fixed issues <a href="https://github.com/tim-kos/node-retry/issues/10">#10</a>, <a href="https://github.com/tim-kos/node-retry/issues/12">#12</a>, and <a href="https://github.com/tim-kos/node-retry/issues/13">#13</a>.</p>

<p>0.6.0 Introduced optional timeOps parameter for the attempt() function which is an object having a property timeout in milliseconds and a property cb callback function. Whenever your retry operation takes longer than timeout to execute, the timeout callback function cb is called.</p>

<p>0.5.0 Some minor refactoring.</p>

<p>0.4.0 Changed retryOperation.try() to retryOperation.attempt(). Deprecated the aliases start() and try() for it.</p>

<p>0.3.0 Added retryOperation.start() which is an alias for retryOperation.try().</p>

<p>0.2.0 Added attempts() function and parameter to retryOperation.try() representing the number of attempts it took to call fn().</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
